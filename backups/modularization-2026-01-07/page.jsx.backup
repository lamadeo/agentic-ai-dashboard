"use client";

import React, { useState } from 'react';
import Image from 'next/image';
import { LineChart, Line, BarChart, Bar, PieChart, Pie, Cell, XAxis, YAxis, CartesianGrid, Tooltip, Legend, ResponsiveContainer, Area, AreaChart } from 'recharts';
import { Users, MessageSquare, TrendingUp, Code, Zap, DollarSign, Clock, Award, Target, ArrowUp, FileText, Download, Lightbulb, Heart, ThumbsUp, ThumbsDown, AlertCircle, Tag, Quote, Home, ChevronDown, ChevronUp, ChevronRight, Activity, Presentation, Menu, X, BarChart2, GraduationCap, Github } from 'lucide-react';
import ReactMarkdown from 'react-markdown';
import aiToolsData from './ai-tools-data.json';
import editorialContent from './claude-editorial-content.json';
import enablementPlan from './claude-enablement-plan.json';
import projectDetailsData from './ai-projects-details.json';
import AnnualPlanPresentation from './components/AnnualPlanPresentation';
import PortfolioTable from './components/PortfolioTable';
import ProjectDetail from './components/ProjectDetail';

// Use perceived value data from integrated pipeline (in ai-tools-data.json)
// Falls back to static data if not available
const perceivedValueData = aiToolsData.perceivedValue
  ? {
      perceivedValue: aiToolsData.perceivedValue,
      summary: aiToolsData.metadata?.sentimentAnalysis || {
        totalFeedbackAnalyzed: 0,
        sourceBreakdown: { slack: 0, confluence: 0, surveys: 0, interviews: 0 }
      },
      lastUpdated: aiToolsData.metadata?.sentimentAnalysis?.lastUpdated || new Date().toISOString()
    }
  : require('../docs/data/perceived-value.json'); // Fallback to static file if not in main data

const MetricCard = ({ title, value, change, changeLabel, icon: Icon, color = "blue" }) => {
  const colorClasses = {
    blue: "bg-blue-50 text-blue-600",
    green: "bg-green-50 text-green-600",
    purple: "bg-purple-50 text-purple-600",
    orange: "bg-orange-50 text-orange-600",
    indigo: "bg-indigo-50 text-indigo-600"
  };

  return (
    <div className="bg-white rounded-lg shadow-md p-6 border border-gray-100">
      <div className="flex items-center justify-between mb-4">
        <div className={`p-3 rounded-lg ${colorClasses[color]}`}>
          <Icon className="h-6 w-6" />
        </div>
        {change && (
          <div className="flex items-center text-green-600 text-sm font-medium">
            <ArrowUp className="h-4 w-4 mr-1" />
            <span>{change}</span>
          </div>
        )}
      </div>
      <h3 className="text-gray-500 text-sm font-medium mb-1">{title}</h3>
      <div className="text-3xl font-bold text-gray-900 mb-1">{value}</div>
      {changeLabel && <p className="text-xs text-gray-500">{changeLabel}</p>}
    </div>
  );
};

// Simple markdown parser for AI-generated insights
const parseMarkdown = (text) => {
  if (!text) return [];

  // Split into paragraphs
  const paragraphs = text.split('\n\n').filter(p => p.trim());

  return paragraphs.map((paragraph, idx) => {
    // Parse bold text: **text** -> <strong>text</strong>
    const parts = [];
    let remainingText = paragraph;
    let match;
    const boldRegex = /\*\*(.*?)\*\*/g;
    let lastIndex = 0;

    while ((match = boldRegex.exec(paragraph)) !== null) {
      // Add text before the match
      if (match.index > lastIndex) {
        parts.push({ type: 'text', content: paragraph.slice(lastIndex, match.index) });
      }
      // Add bold text
      parts.push({ type: 'bold', content: match[1] });
      lastIndex = match.index + match[0].length;
    }

    // Add remaining text
    if (lastIndex < paragraph.length) {
      parts.push({ type: 'text', content: paragraph.slice(lastIndex) });
    }

    return { idx, parts: parts.length > 0 ? parts : [{ type: 'text', content: paragraph }] };
  });
};

// ============================================================
// CLAUDE CODE REUSABLE COMPONENTS
// These components are used in BOTH Claude Enterprise and Claude Code tabs
// ============================================================

/**
 * ClaudeCodePowerUsersTable - Displays top Claude Code power users
 * @param {Object} props
 * @param {Array} props.powerUsers - Array of power user objects with email, name, department, linesGenerated, sessions, linesPerSession
 */
const ClaudeCodePowerUsersTable = ({ powerUsers }) => {
  return (
    <div>
      <h3 className="text-xl font-semibold text-gray-900 mb-4">Claude Code - Power User Champions (Top 12)</h3>
      <div className="bg-white rounded-lg shadow-md overflow-hidden">
        <div className="overflow-x-auto">
          <table className="min-w-full divide-y divide-gray-200">
            <thead className="bg-gray-50">
              <tr>
                <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Rank</th>
                <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Name</th>
                <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Department</th>
                <th className="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider">Lines Generated</th>
                <th className="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider">Active Months</th>
                <th className="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider">Lines/Month</th>
              </tr>
            </thead>
            <tbody className="bg-white divide-y divide-gray-200">
              {powerUsers.map((user, idx) => (
                <tr key={user.email} className={idx < 3 ? 'bg-yellow-50' : ''}>
                  <td className="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">
                    {idx === 0 && 'ü•á'} {idx === 1 && 'ü•à'} {idx === 2 && 'ü•â'} {idx + 1}
                  </td>
                  <td className="px-6 py-4 whitespace-nowrap text-sm text-gray-900">{user.name}</td>
                  <td className="px-6 py-4 whitespace-nowrap text-sm text-gray-600">{user.department}</td>
                  <td className="px-6 py-4 whitespace-nowrap text-sm text-right text-gray-900 font-medium">{user.linesGenerated.toLocaleString()}</td>
                  <td className="px-6 py-4 whitespace-nowrap text-sm text-right text-gray-600">{user.sessions}</td>
                  <td className="px-6 py-4 whitespace-nowrap text-sm text-right text-gray-900 font-semibold">{user.linesPerSession.toLocaleString()}</td>
                </tr>
              ))}
            </tbody>
          </table>
        </div>
      </div>
    </div>
  );
};

/**
 * ClaudeCodeKeyInsights - Displays Claude Code performance insights and department breakdown
 * @param {Object} props
 * @param {string} props.departmentInsight - AI-generated department performance insight text
 * @param {Array} props.departmentBreakdown - Array of department objects with users, totalLines, linesPerUser, topUser
 * @param {Array} props.topThreeUsers - Array of top 3 power users for contributor cards
 */
const ClaudeCodeKeyInsights = ({ departmentInsight, departmentBreakdown, topThreeUsers }) => {
  return (
    <div className="bg-white rounded-lg shadow-md border border-gray-100 p-6">
      <h3 className="text-xl font-semibold text-gray-900 mb-4">Key Insights: Claude Code Performance</h3>

      {/* AI-Generated Department Performance Insight */}
      {departmentInsight && (
        <div className="bg-gradient-to-r from-violet-50 to-purple-50 p-4 rounded-lg border border-violet-200 mb-6">
          <p className="text-sm text-gray-900">
            <strong>Department Performance:</strong> {departmentInsight}
          </p>
        </div>
      )}

      {/* Department Breakdown Table */}
      {departmentBreakdown && departmentBreakdown.length > 0 && (
        <div className="mb-6">
          <h4 className="text-lg font-semibold text-gray-800 mb-3">Team Performance by Department</h4>
          <div className="overflow-x-auto">
            <table className="min-w-full divide-y divide-gray-200">
              <thead className="bg-gray-50">
                <tr>
                  <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Department</th>
                  <th className="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider">Users</th>
                  <th className="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider">Total Lines</th>
                  <th className="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider">Avg Lines/User</th>
                  <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Top Performer</th>
                  <th className="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider">Top User Lines</th>
                </tr>
              </thead>
              <tbody className="bg-white divide-y divide-gray-200">
                {departmentBreakdown
                  .sort((a, b) => b.linesPerUser - a.linesPerUser)
                  .map((dept, idx) => (
                  <tr key={dept.department} className={idx === 0 ? 'bg-violet-50' : 'hover:bg-gray-50'}>
                    <td className="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">
                      {idx === 0 && 'üèÜ '}{dept.department}
                    </td>
                    <td className="px-6 py-4 whitespace-nowrap text-sm text-right text-gray-900">{dept.users}</td>
                    <td className="px-6 py-4 whitespace-nowrap text-sm text-right text-gray-600">{dept.totalLines.toLocaleString()}</td>
                    <td className="px-6 py-4 whitespace-nowrap text-sm text-right text-purple-600 font-bold">{dept.linesPerUser.toLocaleString()}</td>
                    <td className="px-6 py-4 whitespace-nowrap text-sm text-gray-700 font-medium">{dept.topUser?.username || 'N/A'}</td>
                    <td className="px-6 py-4 whitespace-nowrap text-sm text-right text-gray-900 font-medium">{dept.topUser?.lines ? dept.topUser.lines.toLocaleString() : 'N/A'}</td>
                  </tr>
                ))}
              </tbody>
            </table>
          </div>
        </div>
      )}

      {/* Top Individual Contributors */}
      <div>
        <h4 className="text-lg font-semibold text-gray-800 mb-3">Top Individual Contributors</h4>
        <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
          {topThreeUsers.map((user, idx) => (
            <div key={user.email} className={`p-4 rounded-lg border-2 ${
              idx === 0 ? 'bg-yellow-50 border-yellow-300' :
              idx === 1 ? 'bg-gray-50 border-gray-300' :
              'bg-orange-50 border-orange-300'
            }`}>
              <div className="text-2xl mb-2">{idx === 0 ? 'ü•á' : idx === 1 ? 'ü•à' : 'ü•â'}</div>
              <div className="text-lg font-bold text-gray-900">{user.name}</div>
              <div className="text-sm text-gray-600 mb-2">{user.department}</div>
              <div className="text-2xl font-bold text-purple-600">{user.linesGenerated.toLocaleString()}</div>
              <div className="text-xs text-gray-500">lines generated</div>
              <div className="mt-2 text-sm text-gray-700">
                <span className="font-semibold">{user.linesPerSession.toLocaleString()}</span> lines/month
              </div>
            </div>
          ))}
        </div>
      </div>
    </div>
  );
};

/**
 * ClaudeCodeLowEngagementUsers - Displays Claude Code users with low engagement for enablement targeting
 * @param {Object} props
 * @param {Array} props.lowEngagementUsers - Array of low engagement user objects with email, name, department, linesGenerated, sessions
 */
const ClaudeCodeLowEngagementUsers = ({ lowEngagementUsers }) => {
  return (
    <div>
      <h3 className="text-xl font-semibold text-gray-900 mb-4">Claude Code - Low Engagement Users (Enablement Targets)</h3>
      <div className="bg-white rounded-lg shadow-md overflow-hidden">
        <div className="overflow-x-auto">
          <table className="min-w-full divide-y divide-gray-200">
            <thead className="bg-gray-50">
              <tr>
                <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Name</th>
                <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Department</th>
                <th className="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider">Lines Generated</th>
                <th className="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider">Active Months</th>
              </tr>
            </thead>
            <tbody className="bg-white divide-y divide-gray-200">
              {lowEngagementUsers.map((user) => (
                <tr key={user.email} className="hover:bg-gray-50">
                  <td className="px-6 py-4 whitespace-nowrap text-sm text-gray-900">{user.name}</td>
                  <td className="px-6 py-4 whitespace-nowrap text-sm text-gray-600">{user.department}</td>
                  <td className="px-6 py-4 whitespace-nowrap text-sm text-right text-gray-600">{user.linesGenerated.toLocaleString()}</td>
                  <td className="px-6 py-4 whitespace-nowrap text-sm text-right text-gray-600">{user.sessions}</td>
                </tr>
              ))}
            </tbody>
          </table>
        </div>
      </div>
    </div>
  );
};

const Dashboard = () => {
  const [activeTab, setActiveTab] = useState('overview-home');
  const [openDropdown, setOpenDropdown] = useState(null);
  const [selectedProject, setSelectedProject] = useState(null);
  const [sidebarCollapsed, setSidebarCollapsed] = useState(false);

  // Extract data for Overview tab from ai-tools-data.json
  const { overview, expansion, claudeEnterprise, m365Copilot, orgMetrics, currentStateROI } = aiToolsData;

  // Load expansion ROI data from generated data (data-driven behavioral scoring)
  const expansionOpportunities = aiToolsData.expansion.opportunities;

  // Summary metrics from overview data for Key Metrics Grid
  const summaryMetrics = {
    claudeUsers: claudeEnterprise.activeUsers,
    claudeConversations: claudeEnterprise.totalConversations,
    claudeProjects: claudeEnterprise.totalProjects,
    claudeArtifacts: claudeEnterprise.totalArtifacts,
    claudeFilesUploaded: claudeEnterprise.totalFilesUploaded,
    claudeCodeUsers: aiToolsData.claudeCode.activeUsers,
    claudeCodeLines: aiToolsData.claudeCode.totalLines,
    adoptionRate: overview.overallAdoptionRate,
    avgConversationsPerUser: claudeEnterprise.conversationsPerUser,
  };

  // Transform monthly trends for overview chart (combine Claude + M365 data)
  const monthlyAdoption = claudeEnterprise.monthlyTrend.map((claudeMonth, idx) => {
    const m365Month = m365Copilot.monthlyTrend[idx];
    const codeMonth = aiToolsData.claudeCode.monthlyTrend.find(m => m.monthLabel === claudeMonth.monthLabel);
    return {
      month: claudeMonth.monthLabel,
      claudeUsers: claudeMonth.users,
      conversations: claudeMonth.conversations,
      linesOfCode: codeMonth ? codeMonth.totalLines : 0,
      m365Users: m365Month?.users || 0,
      m365Prompts: m365Month?.totalPrompts || 0
    };
  });

  // Monthly Output Trends - Artifacts and Lines of Code (Projects not tracked per month)
  const monthlyOutputTrends = aiToolsData.claudeEnterprise.monthlyTrend.map(month => {
    const codeMonth = aiToolsData.claudeCode.monthlyTrend.find(m => m.monthLabel === month.monthLabel);
    return {
      month: month.monthLabel,
      artifacts: month.artifacts || 0,
      linesOfCode: codeMonth ? codeMonth.totalLines : 0
    };
  });

  // Monthly Adoption Trends - Active Users only (no historical license data)
  const monthlyAdoptionTrends = aiToolsData.claudeEnterprise.monthlyTrend.map(month => ({
    month: month.monthLabel,
    activeUsers: month.users
  }));

  // MTD Business Value Scorecard - Using current month metrics only
  // Extract latest month and previous month from monthly trend data
  const monthlyTrend = claudeEnterprise.monthlyTrend || [];
  const latestMonth = monthlyTrend[monthlyTrend.length - 1] || {};
  const previousMonth = monthlyTrend[monthlyTrend.length - 2] || {};
  const latestMonthLabel = latestMonth.monthLabel || 'Current';
  const latestMonthYear = latestMonth.month ? latestMonth.month.split('-')[0] : new Date().getFullYear();

  // MTD Active Users from latest month
  const mtdActiveUsers = latestMonth.users || claudeEnterprise.activeUsers;
  const claudeLicensedUsers = claudeEnterprise.licensedUsers; // 87
  const mtdAdoptionRate = Math.round((mtdActiveUsers / claudeLicensedUsers) * 100); // 86%

  // MTD User Growth: month-over-month change (Dec 75 vs Nov 77 = -3%)
  const mtdUserGrowth = previousMonth.users
    ? Math.round(((mtdActiveUsers - previousMonth.users) / previousMonth.users) * 100)
    : 0;

  // MTD Engagement: % of active users who are "engaged" (‚â•3 prompts/day for ‚â•33% of days)
  const mtdEngagementRate = latestMonth.engagementRate || 0;
  const mtdEngagedUsers = latestMonth.engagedUsers || 0;

  // MTD Productivity Output - Lines of code + Artifacts
  const claudeCodeMonthlyTrend = aiToolsData.claudeCode?.monthlyTrend || [];
  const latestCodeMonth = claudeCodeMonthlyTrend[claudeCodeMonthlyTrend.length - 1] || {};
  const mtdLinesOfCode = latestCodeMonth.totalLines || 0;
  const mtdArtifacts = latestMonth.artifacts || 0;

  const businessValue = [
    { category: 'Adoption Rate', value: mtdAdoptionRate, color: '#3b82f6', description: `${mtdActiveUsers} active out of ${claudeLicensedUsers} licensed` },
    { category: 'User Growth', value: mtdUserGrowth, color: mtdUserGrowth >= 0 ? '#10b981' : '#ef4444', description: `${latestMonth.monthLabel} vs ${previousMonth.monthLabel}` },
    { category: 'Engagement', value: mtdEngagementRate, color: '#8b5cf6', description: `${mtdEngagedUsers} engaged users (‚â•3 prompts/day, ‚â•33% of days)` }
  ];

  // Department adoption - CORRECTED with actual usage data
  const departmentUsage = [
    { name: 'Engineering + Agentic AI', users: 18, conversations: 892, codeLines: 304175, value: 23 },
    { name: 'Product', users: 13, conversations: 520, codeLines: 0, value: 17 },
    { name: 'Marketing', users: 12, conversations: 360, codeLines: 0, value: 15 },
    { name: 'Sales (All)', users: 10, conversations: 315, codeLines: 0, value: 13 },
    { name: 'Operations/IT', users: 5, conversations: 180, codeLines: 0, value: 6 },
    { name: 'G&A/Finance/Exec', users: 5, conversations: 150, codeLines: 0, value: 6 },
    { name: 'Professional Services', users: 4, conversations: 120, codeLines: 0, value: 5 },
    { name: 'Customer Support', users: 4, conversations: 110, codeLines: 0, value: 5 },
    { name: 'Revenue Ops', users: 3, conversations: 250, codeLines: 0, value: 4 },
    { name: 'Customer Success', users: 2, conversations: 90, codeLines: 0, value: 3 },
    { name: 'Business Development', users: 2, conversations: 110, codeLines: 0, value: 3 }
  ];

  // Incremental ROI metrics - comparing Claude tools against baseline alternatives
  // Shows value of SWITCHING from GitHub Copilot/M365 Copilot to Claude tools
  const { incrementalROI } = aiToolsData;
  const ghToClaudeCode = incrementalROI.githubToClaudeCode;
  const m365ToClaudeEnt = incrementalROI.m365ToClaudeEnterprise;

  // User counts for each scenario
  const claudeCodeUsers = orgMetrics.premiumSeats; // Engineers with Claude Code Premium
  const claudeEnterpriseStandardUsers = orgMetrics.standardSeats; // Non-engineering roles

  // Incremental metrics for Overview tab (using ADDITIVE scenario - realistic cost)
  const incrementalMetrics = {
    // For Engineers (GitHub Copilot ‚Üí Claude Code Premium)
    engineersGain: {
      incrementalHours: ghToClaudeCode.incrementalHours,
      incrementalValue: ghToClaudeCode.incrementalValue,
      incrementalCost: ghToClaudeCode.additive.incrementalCost,
      roi: ghToClaudeCode.additive.incrementalROI,
      usersAffected: claudeCodeUsers,
      baseline: 'GitHub Copilot ($19/mo)',
      current: 'Claude Code Premium ($200/mo)',
      hourlyRate: ghToClaudeCode.hourlyRate
    },

    // For Other Roles (M365 Copilot ‚Üí Claude Enterprise Standard)
    otherRolesGain: {
      incrementalHours: m365ToClaudeEnt.incrementalHours,
      incrementalValue: m365ToClaudeEnt.incrementalValue,
      incrementalCost: m365ToClaudeEnt.additive.incrementalCost,
      roi: m365ToClaudeEnt.additive.incrementalROI,
      usersAffected: claudeEnterpriseStandardUsers,
      baseline: 'M365 Copilot ($30/mo)',
      current: 'Claude Enterprise Std ($40/mo)',
      industryROI: m365ToClaudeEnt.additive.industryBenchmark?.incrementalROI,
      roiDelta: m365ToClaudeEnt.additive.roiComparison?.deltaPercent,
      hourlyRate: m365ToClaudeEnt.hourlyRate
    },

    // Portfolio summary (blended across both scenarios - ADDITIVE)
    portfolio: {
      totalIncrementalValue: ghToClaudeCode.incrementalValue + m365ToClaudeEnt.incrementalValue,
      totalIncrementalCost: ghToClaudeCode.additive.incrementalCost + m365ToClaudeEnt.additive.incrementalCost,
      totalIncrementalHours: ghToClaudeCode.incrementalHours + m365ToClaudeEnt.incrementalHours,
      blendedROI: ((ghToClaudeCode.incrementalValue + m365ToClaudeEnt.incrementalValue) /
                   (ghToClaudeCode.additive.incrementalCost + m365ToClaudeEnt.additive.incrementalCost)).toFixed(1),
      totalUsers: claudeCodeUsers + claudeEnterpriseStandardUsers
    }
  };

  // AI Projects Portfolio data (from 2026 Annual Plan)
  const portfolioData = {
    methodology: {
      formula: "Q1-Q2: (0.7 √ó Multi_Factor) + (0.3 √ó ROI)",
      components: ["Financial Impact (30%)", "Strategic Alignment (25%)", "Execution Feasibility (25%)", "Time to Value (20%)", "ROI Score (30% weight)"]
    },
    projects: [
      {
        rank: 1,
        projectId: "OP-000",
        project: "OP-000: Claude Enterprise & Code Expansion",
        score: "95.6",
        tier: "TIER 0: FOUNDATION",
        tierCategory: "foundation",
        status: "Proposed",
        statusCategory: "proposed",
        value: "$4.6M",
        roi: "1,560%",
        targetKPIs: "Adoption: 92‚Üí192 seats; WAU: 62‚Üí128; Lines/mo: 622K‚Üí3M",
        dependencies: "None",
        qStart: "Q1",
        qStartDetail: "Q1 (Deploy licenses, Champions program)",
        priorityReasoning: "FOUNDATIONAL - Enables all 8+ downstream projects"
      },
      {
        rank: 2,
        projectId: "OP-011",
        project: "OP-011: Absencesoft Claude Marketplace",
        score: "81.7",
        tier: "TIER 0: FOUNDATION",
        tierCategory: "foundation",
        status: "Active",
        statusCategory: "active",
        value: "$1.7M",
        roi: "492%",
        targetKPIs: "Adoption: 150 WAU (67%); Time Saved: 3 hrs/wk/user; Plugins: 30 by EOY",
        dependencies: "OP-000 (Phase 1)",
        qStart: "Q1",
        qStartDetail: "Q1 (Launch 4 plugins, 40+ commits)",
        priorityReasoning: "Architecture foundation - enables 8+ projects, prevents $369K duplicate efforts"
      },
      {
        rank: 3,
        projectId: "OP-014",
        project: "OP-014: Open Observability Vault",
        score: "85.5",
        tier: "TIER 0: FOUNDATION",
        tierCategory: "foundation",
        status: "Planning",
        statusCategory: "planning",
        value: "TBD",
        roi: "10x+",
        targetKPIs: "Universal Metrics; Cross-System Analysis; Real-time Monitoring; ROI Tracking",
        dependencies: "None",
        qStart: "Q1",
        qStartDetail: "Q1 (8-week implementation, 5 phases)",
        priorityReasoning: "Universal platform for AI tool tracking, infrastructure monitoring, cost attribution across all systems"
      },
      {
        rank: 4,
        projectId: "OP-005",
        project: "OP-005: Lead Generation Agentic Intelligence",
        score: "86.2",
        tier: "TIER 1: REVENUE",
        tierCategory: "revenue",
        status: "Planning",
        statusCategory: "planning",
        value: "$3.1M",
        roi: "481%",
        targetKPIs: "ARR: $3.14M; Productivity: +50%; Response Rate: +7-10pts",
        dependencies: "SOFT on OP-000 (Phase 2)",
        qStart: "Q2",
        qStartDetail: "Q2 (Phase 1: Tech Stack + Champion Tracker)",
        priorityReasoning: "Highest revenue value - 6 AI agents for BDR intelligence"
      },
      {
        rank: 5,
        projectId: "OP-008",
        project: "OP-008: Law2Engine (Compliance Automation)",
        score: "68.8",
        tier: "TIER 0: FOUNDATION",
        tierCategory: "foundation",
        status: "60% Complete",
        statusCategory: "in_progress",
        value: "$1.7M",
        roi: "386%",
        targetKPIs: "Accuracy: ‚â•92%; Processing: 28-42d‚Üí3-5d (-85%); Coverage: 5‚Üí50+ laws",
        dependencies: "OP-011 + OP-014",
        qStart: "Q1",
        qStartDetail: "Q1 (Test harness, 92%+ accuracy gate)",
        priorityReasoning: "Competitive differentiation - 60% complete with proven prototype"
      },
      {
        rank: 6,
        projectId: "OP-013",
        project: "OP-013: AI-Powered Case Management",
        score: "67.3",
        tier: "TIER 0: FOUNDATION",
        tierCategory: "foundation",
        status: "In Development",
        statusCategory: "in_progress",
        value: "$2.8M",
        roi: "312%",
        targetKPIs: "Customers: 50+; ARR: $500K+; Conversion: 10%+; CSAT: 80+",
        dependencies: "OP-014",
        qStart: "Q1",
        qStartDetail: "Q1 (Forever Code product, 80% capacity)",
        priorityReasoning: "CEO COMMITTED - Hypergrowth downmarket expansion product"
      },
      {
        rank: 7,
        projectId: "OP-001",
        project: "OP-001: Sales Deal Agentic Intelligence",
        score: "76.6",
        tier: "TIER 1: REVENUE",
        tierCategory: "revenue",
        status: "Proposed",
        statusCategory: "proposed",
        value: "$5-7M",
        roi: "847%",
        targetKPIs: "Win Rate: 16%‚Üí22-24%; Sales Cycle: 180d‚Üí110-125d; Time: 4-6 hrs/wk saved",
        dependencies: "Gong MCP + Salesforce MCP (Q3-Q4)",
        qStart: "Q4",
        qStartDetail: "Q4 (if Gong+SF MCP production-ready)",
        priorityReasoning: "Highest value project - blocked by external vendor MCP maturity"
      },
      {
        rank: 8,
        projectId: "OP-012",
        project: "OP-012: Leave Planning Tool V1",
        score: "55.1",
        tier: "TIER 0: FOUNDATION",
        tierCategory: "foundation",
        status: "In Development",
        statusCategory: "in_progress",
        value: "$450K",
        roi: "173%",
        targetKPIs: "MAU: 1000+; Completion: 80%+; Leads: 50+/mo; Accuracy: 95%",
        dependencies: "None",
        qStart: "Q1",
        qStartDetail: "Q1 (Forever Code product, CEO deadline Feb)",
        priorityReasoning: "CEO COMMITTED - Hypergrowth proof point for AI-native product features"
      },
      {
        rank: 9,
        projectId: "OP-004",
        project: "OP-004: AI Proposal Generator",
        score: "77.4",
        tier: "TIER 1: REVENUE",
        tierCategory: "revenue",
        status: "Proposed",
        statusCategory: "proposed",
        value: "$1.6M",
        roi: "612%",
        targetKPIs: "Proposal Time: 8-12hrs‚Üí2-3hrs (-75%); Win Rate: +3-5pts",
        dependencies: "OP-011 (templates)",
        qStart: "Q3",
        qStartDetail: "Q3 (Pilot with 5 AEs)",
        priorityReasoning: "Sales enablement - high ROI but deferred until templates ready"
      },
      {
        rank: 10,
        projectId: "OP-002",
        project: "OP-002: Operations Knowledge Agent",
        score: "73.1",
        tier: "TIER 2: RETENTION",
        tierCategory: "retention",
        status: "Planning",
        statusCategory: "planning",
        value: "$890K",
        roi: "523%",
        targetKPIs: "Search Time: 15hrs/wk‚Üí6hrs/wk (-60%); CSAT: +5-10pts; Accuracy: >85%",
        dependencies: "OP-000 (Claude Enterprise)",
        qStart: "Q2",
        qStartDetail: "Q2 (Claude Project setup, pilot 10-15 users)",
        priorityReasoning: "Replace failed M365 agent - Ops team efficiency gains"
      },
      {
        rank: 11,
        projectId: "OP-006",
        project: "OP-006: PS Time-to-Value Accelerator",
        score: "69.7",
        tier: "TIER 2: RETENTION",
        tierCategory: "retention",
        status: "Proposed",
        statusCategory: "proposed",
        value: "$1.2M",
        roi: "445%",
        targetKPIs: "Implementation Time: -30-40%; PS Capacity: +30-40%; CSAT: +10-15pts",
        dependencies: "OP-011 (playbooks) + Product AI features",
        qStart: "Q3",
        qStartDetail: "Q3 (Pilot with 3 implementations)",
        priorityReasoning: "PS speed is product problem - depends on product AI features shipping first"
      }
    ]
  };

  const COLORS = ['#3b82f6', '#10b981', '#8b5cf6', '#f59e0b', '#ef4444', '#6366f1'];

  // Phase 1B: Navigation Structure - 6 strategic tabs with dropdowns
  const navigationStructure = [
    {
      id: 'overview',
      label: 'Overview',
      hasDropdown: false,
      tab: 'overview-home'
    },
    {
      id: 'briefings',
      label: 'Briefings',
      hasDropdown: true,
      items: [
        { id: 'briefing-leadership', label: 'Leadership Summary', tab: 'briefing-leadership' },
        { id: 'briefing-org', label: 'Organization-wide Summary', tab: 'briefing-org' }
      ]
    },
    {
      id: 'tools',
      label: 'Tool Deep Dive',
      hasDropdown: true,
      items: [
        { id: 'claude-enterprise', label: 'Claude Enterprise', tab: 'claude-enterprise' },
        { id: 'claude-code', label: 'Claude Code', tab: 'claude-code' },
        { id: 'm365', label: 'M365 Copilot', tab: 'm365' }
      ]
    },
    {
      id: 'compare',
      label: 'Compare Tools',
      hasDropdown: true,
      items: [
        { id: 'coding-tools', label: 'Coding Tools', tab: 'coding-tools' },
        { id: 'productivity-tools', label: 'Productivity Tools', tab: 'productivity-tools' }
      ]
    },
    {
      id: 'roi',
      label: 'ROI & Planning',
      hasDropdown: true,
      items: [
        { id: 'expansion-roi', label: 'Expansion ROI', tab: 'expansion' },
        { id: 'perceived-value', label: 'Perceived Value', tab: 'perceived-value' },
        { id: 'portfolio', label: 'AI Projects Portfolio', tab: 'portfolio' }
      ]
    },
    {
      id: 'enablement',
      label: 'Enablement',
      hasDropdown: false,
      tab: 'enablement'
    },
    {
      id: '2026-plan',
      label: '2026 Annual Plan',
      hasDropdown: false,
      tab: '2026-plan',
      icon: Presentation
    }
  ];

  // Phase 1C: Helper function to generate breadcrumbs based on active tab
  const getBreadcrumbs = (tab, projectId = null) => {
    const crumbs = [{ label: 'Home', tab: null }];

    // Handle project detail breadcrumbs
    if (projectId && tab === 'portfolio') {
      // Build path: Home > ROI & Planning > AI Projects Portfolio > Project Name
      for (const navItem of navigationStructure) {
        if (navItem.hasDropdown && navItem.items) {
          for (const item of navItem.items) {
            if (item.tab === 'portfolio') {
              crumbs.push({ label: navItem.label, tab: null });
              crumbs.push({
                label: item.label,
                tab: 'portfolio',
                onClick: () => setSelectedProject(null) // Clear selection on back
              });
              const project = projectDetailsData[projectId];
              crumbs.push({
                label: project?.projectName || projectId,
                tab: null
              });
              return crumbs;
            }
          }
        }
      }
    }

    // Find the navigation path for the current tab
    for (const navItem of navigationStructure) {
      if (navItem.tab === tab && !navItem.hasDropdown) {
        // Direct tab (e.g., ROI & Planning, Enablement)
        crumbs.push({ label: navItem.label, tab: navItem.tab });
        return crumbs;
      }

      if (navItem.hasDropdown && navItem.items) {
        for (const item of navItem.items) {
          if (item.hasSubmenu && item.submenu) {
            // Check submenu items
            for (const subItem of item.submenu) {
              if (subItem.tab === tab) {
                crumbs.push({ label: navItem.label, tab: null });
                crumbs.push({ label: item.label, tab: null });
                crumbs.push({ label: subItem.label, tab: subItem.tab });
                return crumbs;
              }
            }
          } else if (item.tab === tab) {
            // Regular dropdown item
            crumbs.push({ label: navItem.label, tab: null });
            crumbs.push({ label: item.label, tab: item.tab });
            return crumbs;
          }
        }
      }
    }

    return crumbs;
  };

  const breadcrumbs = getBreadcrumbs(activeTab, selectedProject);

  return (
    <div className="min-h-screen bg-gray-50">
        {/* Sidebar Navigation - Option B: Sidebar Layout */}
        <div className="flex min-h-screen">
          {/* Sidebar */}
          <aside
            className={`${
              sidebarCollapsed ? 'w-16' : 'w-64'
            } bg-white border-r border-gray-200 fixed left-0 top-0 h-full overflow-y-auto transition-all duration-300 z-40`}
          >
            {/* Sidebar Header */}
            <div className="p-4 border-b border-gray-200">
              <button
                onClick={() => setSidebarCollapsed(!sidebarCollapsed)}
                className="w-full flex items-center justify-center p-2 text-gray-600 hover:bg-gray-100 rounded-lg transition-colors"
                title={sidebarCollapsed ? 'Expand sidebar' : 'Collapse sidebar'}
              >
                {sidebarCollapsed ? <Menu className="h-5 w-5" /> : <X className="h-5 w-5" />}
              </button>
            </div>

            {/* Navigation Groups */}
            <nav className="px-2 py-4">
              {navigationStructure.map((navGroup) => (
                <div key={navGroup.id} className="mb-6">
                  {/* Group Header */}
                  {!sidebarCollapsed && (
                    <div className="px-3 mb-2 text-xs font-semibold text-gray-500 uppercase tracking-wide">
                      {navGroup.label}
                    </div>
                  )}

                  {/* Direct Tab (no dropdown) */}
                  {!navGroup.hasDropdown && (
                    <button
                      onClick={() => {
                        setActiveTab(navGroup.tab);
                        setOpenDropdown(null);
                      }}
                      className={`w-full flex items-center space-x-3 px-3 py-2 rounded-lg text-sm font-medium transition-colors ${
                        activeTab === navGroup.tab
                          ? 'bg-blue-50 text-blue-700'
                          : 'text-gray-600 hover:bg-gray-50'
                      }`}
                      title={sidebarCollapsed ? navGroup.label : undefined}
                    >
                      <Home className="h-5 w-5 flex-shrink-0" />
                      {!sidebarCollapsed && <span>{navGroup.label}</span>}
                    </button>
                  )}

                  {/* Dropdown Group */}
                  {navGroup.hasDropdown && (
                    <>
                      {/* Group Toggle Button */}
                      {!sidebarCollapsed && (
                        <button
                          onClick={() => setOpenDropdown(openDropdown === navGroup.id ? null : navGroup.id)}
                          className="w-full flex items-center justify-between px-3 py-2 text-sm font-medium text-gray-700 hover:bg-gray-50 rounded-lg transition-colors"
                        >
                          <span className="flex items-center space-x-3">
                            {navGroup.id === 'briefings' && <BarChart2 className="h-5 w-5" />}
                            {navGroup.id === 'tools' && <Code className="h-5 w-5" />}
                            {navGroup.id === 'compare' && <TrendingUp className="h-5 w-5" />}
                            {navGroup.id === 'roi' && <DollarSign className="h-5 w-5" />}
                            {navGroup.id === 'enablement' && <GraduationCap className="h-5 w-5" />}
                            {navGroup.id === 'plan' && <Presentation className="h-5 w-5" />}
                            <span>{navGroup.label}</span>
                          </span>
                          {openDropdown === navGroup.id ? (
                            <ChevronUp className="h-4 w-4" />
                          ) : (
                            <ChevronDown className="h-4 w-4" />
                          )}
                        </button>
                      )}

                      {/* Dropdown Items */}
                      {(openDropdown === navGroup.id || sidebarCollapsed) && navGroup.items && (
                        <div className={sidebarCollapsed ? '' : 'ml-3 mt-1 space-y-1'}>
                          {navGroup.items.map((item) => (
                            <div key={item.id}>
                              {item.hasSubmenu ? (
                                <>
                                  {!sidebarCollapsed && (
                                    <div className="px-3 py-2 text-xs font-semibold text-gray-600">
                                      {item.label}
                                    </div>
                                  )}
                                  {item.submenu.map((subItem) => (
                                    <button
                                      key={subItem.id}
                                      onClick={() => {
                                        setActiveTab(subItem.tab);
                                        setOpenDropdown(null);
                                      }}
                                      className={`w-full flex items-center space-x-3 px-3 py-2 rounded-lg text-sm transition-colors ${
                                        activeTab === subItem.tab
                                          ? 'bg-blue-50 text-blue-700'
                                          : 'text-gray-600 hover:bg-gray-50'
                                      } ${sidebarCollapsed ? 'justify-center' : 'pl-6'}`}
                                      title={sidebarCollapsed ? subItem.label : undefined}
                                    >
                                      <FileText className="h-4 w-4 flex-shrink-0" />
                                      {!sidebarCollapsed && <span>{subItem.label}</span>}
                                    </button>
                                  ))}
                                </>
                              ) : (
                                <button
                                  onClick={() => {
                                    setActiveTab(item.tab);
                                    setOpenDropdown(null);
                                  }}
                                  className={`w-full flex items-center space-x-3 px-3 py-2 rounded-lg text-sm transition-colors ${
                                    activeTab === item.tab
                                      ? 'bg-blue-50 text-blue-700'
                                      : 'text-gray-600 hover:bg-gray-50'
                                  } ${sidebarCollapsed ? 'justify-center' : ''}`}
                                  title={sidebarCollapsed ? item.label : undefined}
                                >
                                  {item.id === 'claude-enterprise' && <MessageSquare className="h-4 w-4 flex-shrink-0" />}
                                  {item.id === 'claude-code' && <Code className="h-4 w-4 flex-shrink-0" />}
                                  {item.id === 'm365' && <Users className="h-4 w-4 flex-shrink-0" />}
                                  {item.id === 'coding-tools' && <Code className="h-4 w-4 flex-shrink-0" />}
                                  {item.id === 'productivity-tools' && <MessageSquare className="h-4 w-4 flex-shrink-0" />}
                                  {item.id === 'expansion-roi' && <DollarSign className="h-4 w-4 flex-shrink-0" />}
                                  {item.id === 'perceived-value' && <Heart className="h-4 w-4 flex-shrink-0" />}
                                  {item.id === 'portfolio' && <Target className="h-4 w-4 flex-shrink-0" />}
                                  {item.id === 'enablement' && <GraduationCap className="h-4 w-4 flex-shrink-0" />}
                                  {item.id === 'annual-plan' && <Presentation className="h-4 w-4 flex-shrink-0" />}
                                  {!sidebarCollapsed && <span>{item.label}</span>}
                                </button>
                              )}
                            </div>
                          ))}
                        </div>
                      )}
                    </>
                  )}
                </div>
              ))}
            </nav>
          </aside>

          {/* Main Content Area */}
          <main
            className={`${
              sidebarCollapsed ? 'ml-16' : 'ml-64'
            } flex-1 transition-all duration-300 p-6`}
          >
            {/* Simplified Persistent Header - Phase 1A */}
            <div className="mb-8 flex items-center justify-between max-w-7xl">
              <div>
                <h1 className="text-3xl font-bold text-gray-900 mb-1 flex items-center">
                  <Image
                    src="/assets/absencesoft-logo.svg"
                    alt="AbsenceSoft Logo"
                    width={32}
                    height={32}
                    className="mr-3"
                  />
                  <Image
                    src="/assets/ai-icon.png"
                    alt="AI Icon"
                    width={32}
                    height={32}
                    className="mr-3"
                  />
                  Agentic AI Dashboard
                </h1>
                <p className="text-gray-600">Analytics & Optimization Insights</p>
              </div>
              <div className="flex items-center space-x-4">
                <div className="flex items-center text-sm text-gray-500">
                  <Clock className="h-4 w-4 mr-1" />
                  <span>Last updated: {latestMonthLabel} {latestMonthYear}</span>
                </div>
                <a
                  href="https://github.com/absencesoft/as-ai-dashboard/blob/main/CONTRIBUTING.md"
                  target="_blank"
                  rel="noopener noreferrer"
                  className="flex items-center text-sm text-blue-600 hover:text-blue-800 transition-colors group"
                  title="Contribute to this dashboard"
                >
                  <Github className="h-4 w-4 mr-1" />
                  <span className="group-hover:underline">Contribute</span>
                </a>
              </div>
            </div>

            <div className="bg-white rounded-lg shadow-md mb-6 max-w-7xl">
              {/* Breadcrumb Navigation */}
              <div className="px-6 py-3 bg-gray-50 border-b border-gray-200">
                <nav className="flex items-center space-x-2 text-sm">
                  {breadcrumbs.map((crumb, index) => (
                    <div key={index} className="flex items-center">
                      {index > 0 && (
                        <ChevronRight className="h-4 w-4 text-gray-400 mx-2" />
                      )}
                      {crumb.tab || crumb.onClick ? (
                        <button
                          onClick={() => crumb.onClick ? crumb.onClick() : setActiveTab(crumb.tab)}
                          className="text-blue-600 hover:text-blue-800 hover:underline transition-colors"
                        >
                          {crumb.label}
                        </button>
                      ) : (
                        <span className={index === breadcrumbs.length - 1 ? 'text-gray-900 font-medium' : 'text-gray-500'}>
                          {crumb.label}
                        </span>
                      )}
                    </div>
                  ))}
                </nav>
              </div>

              {/* Tab Content */}
              <div className="p-6">

            {/* Claude Enterprise Tab - Comprehensive View */}
            {activeTab === 'claude-enterprise' && (
              <div className="space-y-6">
                {/* SECTION 1: Phase 1A - Key Metrics Grid */}
                <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
                  {/* Card 1: Licensed Users */}
                  <div className="bg-white rounded-lg shadow-md p-6">
                    <div className="flex items-center justify-between">
                      <div>
                        <p className="text-sm text-gray-600 mb-1">Licensed Users</p>
                        <p className="text-3xl font-bold text-blue-600">{claudeLicensedUsers}</p>
                        <p className="text-xs text-gray-500 mt-1">Total Claude Enterprise seats</p>
                      </div>
                      <Users className="w-12 h-12 text-blue-600 opacity-20" />
                    </div>
                  </div>

                  {/* Card 2: Active Users */}
                  <div className="bg-white rounded-lg shadow-md p-6">
                    <div className="flex items-center justify-between">
                      <div>
                        <p className="text-sm text-gray-600 mb-1">Active Users (MTD)</p>
                        <p className="text-3xl font-bold text-green-600">{mtdActiveUsers}</p>
                        <p className="text-xs text-gray-500 mt-1">Users active this month</p>
                      </div>
                      <Activity className="w-12 h-12 text-green-600 opacity-20" />
                    </div>
                  </div>

                  {/* Card 3: Adoption Rate */}
                  <div className="bg-white rounded-lg shadow-md p-6">
                    <div className="flex items-center justify-between">
                      <div>
                        <p className="text-sm text-gray-600 mb-1">Adoption Rate</p>
                        <p className="text-3xl font-bold text-purple-600">{mtdAdoptionRate}%</p>
                        <p className="text-xs text-gray-500 mt-1">{mtdActiveUsers} of {claudeLicensedUsers} users</p>
                      </div>
                      <TrendingUp className="w-12 h-12 text-purple-600 opacity-20" />
                    </div>
                  </div>

                  {/* Card 4: Total Messages */}
                  <div className="bg-white rounded-lg shadow-md p-6">
                    <div className="flex items-center justify-between">
                      <div>
                        <p className="text-sm text-gray-600 mb-1">Total Messages</p>
                        <p className="text-3xl font-bold text-indigo-600">
                          {(latestMonth.messages || 0).toLocaleString()}
                        </p>
                        <p className="text-xs text-gray-500 mt-1">Messages this month</p>
                      </div>
                      <MessageSquare className="w-12 h-12 text-indigo-600 opacity-20" />
                    </div>
                  </div>
                </div>

                {/* SECTION 2: Phase 1A - ROI Highlights */}
                <div className="bg-gradient-to-r from-blue-600 to-purple-600 rounded-lg shadow-lg p-8 text-white">
                  <h2 className="text-2xl font-bold mb-6 flex items-center">
                    <DollarSign className="h-8 w-8 mr-3" />
                    Claude Enterprise Business Value & ROI
                  </h2>
                  <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
                    <div>
                      <p className="text-blue-100 text-sm mb-2">Incremental Hours Gained</p>
                      <p className="text-3xl font-bold">{incrementalMetrics.portfolio.totalIncrementalHours.toLocaleString()} hrs</p>
                      <p className="text-sm text-blue-100 mt-1">vs GitHub Copilot + M365 Copilot</p>
                    </div>
                    <div>
                      <p className="text-blue-100 text-sm mb-2">Incremental Value Generated</p>
                      <p className="text-3xl font-bold">${incrementalMetrics.portfolio.totalIncrementalValue.toLocaleString()}</p>
                      <p className="text-sm text-blue-100 mt-1">Additional value from switching</p>
                    </div>
                    <div>
                      <p className="text-blue-100 text-sm mb-2">Incremental Cost (Tool Switch)</p>
                      <p className="text-3xl font-bold">${incrementalMetrics.portfolio.totalIncrementalCost.toLocaleString()}</p>
                      <p className="text-sm text-blue-100 mt-1">Extra cost vs baseline tools</p>
                    </div>
                    <div>
                      <p className="text-blue-100 text-sm mb-2">Blended Portfolio ROI</p>
                      <p className="text-3xl font-bold">{incrementalMetrics.portfolio.blendedROI}x</p>
                      <p className="text-sm text-blue-100 mt-1">Across {incrementalMetrics.portfolio.totalUsers} users</p>
                    </div>
                  </div>
                </div>

                {/* SECTION 3: Phase 1A - Key Insights - KPI Metrics */}
                {aiToolsData.insights && aiToolsData.insights.overviewKpiMetrics && (
                  <div className="bg-gradient-to-br from-amber-50 to-orange-50 border border-amber-200 rounded-lg p-6">
                    <h3 className="text-xl font-semibold text-gray-900 mb-4 flex items-center">
                      <Target className="h-6 w-6 mr-2 text-amber-600" />
                      Key Insights
                    </h3>
                    <div className="bg-white rounded-lg p-4 shadow-sm">
                      <p className="text-gray-700 text-sm leading-relaxed whitespace-pre-line">{aiToolsData.insights.overviewKpiMetrics}</p>
                    </div>
                  </div>
                )}

                {/* SECTION 4: Overview - Monthly Growth Trends */}
                <div>
                  <h3 className="text-xl font-semibold text-gray-900 mb-4">Monthly Growth Trends</h3>
                  <div className="h-80">
                    <ResponsiveContainer width="100%" height="100%">
                      <AreaChart data={monthlyAdoption}>
                        <defs>
                          <linearGradient id="colorUsers" x1="0" y1="0" x2="0" y2="1">
                            <stop offset="5%" stopColor="#3b82f6" stopOpacity={0.8}/>
                            <stop offset="95%" stopColor="#3b82f6" stopOpacity={0}/>
                          </linearGradient>
                          <linearGradient id="colorConv" x1="0" y1="0" x2="0" y2="1">
                            <stop offset="5%" stopColor="#10b981" stopOpacity={0.8}/>
                            <stop offset="95%" stopColor="#10b981" stopOpacity={0}/>
                          </linearGradient>
                          <linearGradient id="colorLinesOfCode" x1="0" y1="0" x2="0" y2="1">
                            <stop offset="5%" stopColor="#8b5cf6" stopOpacity={0.8}/>
                            <stop offset="95%" stopColor="#8b5cf6" stopOpacity={0}/>
                          </linearGradient>
                        </defs>
                        <CartesianGrid strokeDasharray="3 3" />
                        <XAxis dataKey="month" />
                        <YAxis yAxisId="left" />
                        <YAxis yAxisId="right" orientation="right" />
                        <Tooltip />
                        <Legend />
                        <Area yAxisId="left" type="monotone" dataKey="claudeUsers" stroke="#3b82f6" fillOpacity={1} fill="url(#colorUsers)" name="Active Users" />
                        <Area yAxisId="left" type="monotone" dataKey="conversations" stroke="#10b981" fillOpacity={1} fill="url(#colorConv)" name="Conversations" />
                        <Area yAxisId="right" type="monotone" dataKey="linesOfCode" stroke="#8b5cf6" fillOpacity={1} fill="url(#colorLinesOfCode)" name="Lines of Code" />
                      </AreaChart>
                    </ResponsiveContainer>
                  </div>
                </div>

                {/* Key Insights - Monthly Growth Chart */}
                {aiToolsData.insights && aiToolsData.insights.monthlyGrowthChart && (
                  <div className="bg-gradient-to-br from-amber-50 to-orange-50 border border-amber-200 rounded-lg p-6 mb-6">
                    <h3 className="text-xl font-semibold text-gray-900 mb-4 flex items-center">
                      <Target className="h-6 w-6 mr-2 text-amber-600" />
                      Key Insights
                    </h3>
                    <div className="bg-white rounded-lg p-4 shadow-sm">
                      <p className="text-gray-700 text-sm leading-relaxed whitespace-pre-line">{aiToolsData.insights.monthlyGrowthChart}</p>
                    </div>
                  </div>
                )}

                {/* SECTION 5: Overview - Tool Replacement Value Analysis */}
                <div className="bg-white border border-gray-200 rounded-lg p-6">
                  <h3 className="text-xl font-semibold text-gray-900 mb-4">Tool Replacement Value Analysis</h3>
                  <p className="text-sm text-gray-600 mb-6">Incremental value from switching to Claude tools vs. baseline alternatives</p>

                  <div className="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
                    {/* Engineers: GitHub Copilot ‚Üí Claude Code Premium */}
                    <div className="border border-blue-200 rounded-lg p-5 bg-gradient-to-br from-blue-50 to-white">
                      <div className="flex items-center justify-between mb-4">
                        <h4 className="text-sm font-semibold text-gray-900">Engineers ({incrementalMetrics.engineersGain.usersAffected} users)</h4>
                        <div className="flex flex-col items-end gap-1">
                          <span className="px-3 py-1 bg-blue-100 text-blue-800 text-xs font-semibold rounded-full">{incrementalMetrics.engineersGain.roi.toFixed(1)}x ROI</span>
                          {aiToolsData.incrementalROI.githubToClaudeCode.additive.roiComparison?.deltaPercent !== null && aiToolsData.incrementalROI.githubToClaudeCode.additive.roiComparison?.deltaPercent !== undefined && (
                            <span className={`px-2 py-0.5 text-xs font-medium rounded ${aiToolsData.incrementalROI.githubToClaudeCode.additive.roiComparison.deltaPercent >= 0 ? 'bg-green-100 text-green-700' : 'bg-red-100 text-red-700'}`}>
                              {aiToolsData.incrementalROI.githubToClaudeCode.additive.roiComparison.deltaPercent >= 0 ? '+' : ''}{aiToolsData.incrementalROI.githubToClaudeCode.additive.roiComparison.deltaPercent}% vs benchmark
                            </span>
                          )}
                        </div>
                      </div>
                      <div className="space-y-3">
                        <div className="flex items-center justify-between text-sm">
                          <span className="text-gray-600">Baseline Tool:</span>
                          <span className="font-medium text-gray-900">{incrementalMetrics.engineersGain.baseline}</span>
                        </div>
                        <div className="flex items-center justify-between text-sm">
                          <span className="text-gray-600">New Tool:</span>
                          <span className="font-medium text-gray-900">{incrementalMetrics.engineersGain.current}</span>
                        </div>
                        <div className="border-t border-gray-200 pt-3 mt-3">
                          <div className="flex justify-between items-center mb-2">
                            <span className="text-xs text-gray-500">Incremental Hours:</span>
                            <span className="text-sm font-semibold text-gray-900">{incrementalMetrics.engineersGain.incrementalHours} hrs/mo</span>
                          </div>
                          <div className="flex justify-between items-center mb-2">
                            <span className="text-xs text-gray-500">Incremental Value:</span>
                            <span className="text-sm font-semibold text-green-600">${incrementalMetrics.engineersGain.incrementalValue.toLocaleString()}/mo</span>
                          </div>
                          <div className="flex justify-between items-center mb-2">
                            <span className="text-xs text-gray-500">Incremental Cost:</span>
                            <span className="text-sm font-semibold text-gray-900">${incrementalMetrics.engineersGain.incrementalCost.toLocaleString()}/mo</span>
                          </div>
                          <div className="flex justify-between items-center pt-2 border-t border-gray-200">
                            <span className="text-xs font-semibold text-gray-700">Net Gain:</span>
                            <span className="text-sm font-bold text-green-600">${(incrementalMetrics.engineersGain.incrementalValue - incrementalMetrics.engineersGain.incrementalCost).toLocaleString()}/mo</span>
                          </div>
                        </div>
                      </div>
                    </div>

                    {/* Other Roles: M365 Copilot ‚Üí Claude Enterprise Standard */}
                    <div className="border border-purple-200 rounded-lg p-5 bg-gradient-to-br from-purple-50 to-white">
                      <div className="flex items-center justify-between mb-4">
                        <h4 className="text-sm font-semibold text-gray-900">Other Roles ({incrementalMetrics.otherRolesGain.usersAffected} users)</h4>
                        <div className="flex flex-col items-end gap-1">
                          <span className="px-3 py-1 bg-purple-100 text-purple-800 text-xs font-semibold rounded-full">{incrementalMetrics.otherRolesGain.roi.toFixed(1)}x ROI</span>
                          {aiToolsData.incrementalROI.m365ToClaudeEnterprise.additive.roiComparison?.deltaPercent !== null && aiToolsData.incrementalROI.m365ToClaudeEnterprise.additive.roiComparison?.deltaPercent !== undefined && (
                            <span className={`px-2 py-0.5 text-xs font-medium rounded ${aiToolsData.incrementalROI.m365ToClaudeEnterprise.additive.roiComparison.deltaPercent >= 0 ? 'bg-green-100 text-green-700' : 'bg-red-100 text-red-700'}`}>
                              {aiToolsData.incrementalROI.m365ToClaudeEnterprise.additive.roiComparison.deltaPercent >= 0 ? '+' : ''}{aiToolsData.incrementalROI.m365ToClaudeEnterprise.additive.roiComparison.deltaPercent}% vs benchmark
                            </span>
                          )}
                        </div>
                      </div>
                      <div className="space-y-3">
                        <div className="flex items-center justify-between text-sm">
                          <span className="text-gray-600">Baseline Tool:</span>
                          <span className="font-medium text-gray-900">{incrementalMetrics.otherRolesGain.baseline}</span>
                        </div>
                        <div className="flex items-center justify-between text-sm">
                          <span className="text-gray-600">New Tool:</span>
                          <span className="font-medium text-gray-900">{incrementalMetrics.otherRolesGain.current}</span>
                        </div>
                        <div className="border-t border-gray-200 pt-3 mt-3">
                          <div className="flex justify-between items-center mb-2">
                            <span className="text-xs text-gray-500">Incremental Hours:</span>
                            <span className="text-sm font-semibold text-gray-900">{incrementalMetrics.otherRolesGain.incrementalHours} hrs/mo</span>
                          </div>
                          <div className="flex justify-between items-center mb-2">
                            <span className="text-xs text-gray-500">Incremental Value:</span>
                            <span className="text-sm font-semibold text-green-600">${incrementalMetrics.otherRolesGain.incrementalValue.toLocaleString()}/mo</span>
                          </div>
                          <div className="flex justify-between items-center mb-2">
                            <span className="text-xs text-gray-500">Incremental Cost:</span>
                            <span className="text-sm font-semibold text-gray-900">${incrementalMetrics.otherRolesGain.incrementalCost.toLocaleString()}/mo</span>
                          </div>
                          <div className="flex justify-between items-center pt-2 border-t border-gray-200">
                            <span className="text-xs font-semibold text-gray-700">Net Gain:</span>
                            <span className="text-sm font-bold text-green-600">${(incrementalMetrics.otherRolesGain.incrementalValue - incrementalMetrics.otherRolesGain.incrementalCost).toLocaleString()}/mo</span>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>

                  {/* Portfolio Summary */}
                  <div className="mt-6 p-4 bg-gradient-to-r from-green-50 to-blue-50 rounded-lg border border-green-200">
                    <div className="flex items-center justify-between">
                      <div>
                        <p className="text-sm font-medium text-gray-700 mb-1">Portfolio-Wide Incremental ROI</p>
                        <p className="text-xs text-gray-600">Blended return across {incrementalMetrics.portfolio.totalUsers} users switching to Claude tools</p>
                        <p className="text-xs text-gray-500 mt-1">${incrementalMetrics.portfolio.totalIncrementalValue.toLocaleString()} value / ${incrementalMetrics.portfolio.totalIncrementalCost.toLocaleString()} extra cost</p>
                      </div>
                      <div className="text-right">
                        <p className="text-4xl font-bold text-green-600">{incrementalMetrics.portfolio.blendedROI}x</p>
                        <p className="text-xs text-gray-600 mt-1">Incremental ROI</p>
                      </div>
                    </div>
                  </div>
                </div>

                {/* SECTION 6: Overview - MTD Business Value Scorecard */}
                <div>
                  <h3 className="text-xl font-semibold text-gray-900 mb-4">MTD Business Value Scorecard</h3>
                  <p className="text-sm text-gray-600 mb-4">Month-to-Date metrics for {latestMonth.monthLabel || 'current month'}</p>
                  <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                    {businessValue.map((item, idx) => (
                      <div key={idx} className="bg-gray-50 p-4 rounded-lg border border-gray-200">
                        <div className="flex items-center justify-between mb-2">
                          <span className="text-sm font-medium text-gray-600">{item.category}</span>
                          <Target className="h-4 w-4 text-gray-400" />
                        </div>
                        <div className="text-3xl font-bold mb-1" style={{ color: item.color }}>
                          {item.value}%
                        </div>
                        <p className="text-xs text-gray-500">{item.description}</p>
                      </div>
                    ))}
                  </div>
                </div>

                {/* SECTION 7: Overview - MTD Productivity Output */}
                <div>
                  <h3 className="text-xl font-semibold text-gray-900 mb-4">MTD Productivity Output</h3>
                  <p className="text-sm text-gray-600 mb-4">Combined output for {latestMonth.monthLabel || 'current month'}</p>
                  <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div className="bg-gradient-to-br from-purple-50 to-purple-100 p-6 rounded-lg border border-purple-200">
                      <div className="flex items-center justify-between mb-2">
                        <span className="text-sm font-medium text-purple-700">Lines of Code</span>
                        <Code className="h-5 w-5 text-purple-500" />
                      </div>
                      <div className="text-4xl font-bold text-purple-900 mb-1">
                        {(mtdLinesOfCode / 1000).toFixed(0)}K
                      </div>
                      <p className="text-xs text-purple-600">
                        Generated by {latestCodeMonth.users || 0} Claude Code users
                      </p>
                    </div>
                    <div className="bg-gradient-to-br from-blue-50 to-blue-100 p-6 rounded-lg border border-blue-200">
                      <div className="flex items-center justify-between mb-2">
                        <span className="text-sm font-medium text-blue-700">Artifacts / Content Generated</span>
                        <FileText className="h-5 w-5 text-blue-500" />
                      </div>
                      <div className="text-4xl font-bold text-blue-900 mb-1">
                        {mtdArtifacts}
                      </div>
                      <p className="text-xs text-blue-600">
                        Generated by {mtdActiveUsers} Claude Enterprise users
                      </p>
                    </div>
                  </div>
                </div>

                {/* SECTION 8: Adoption - Monthly Output & Adoption Trends */}
                <div className="grid grid-cols-1 lg:grid-cols-2 gap-6">
                  {/* Monthly Output Trend */}
                  <div>
                    <h3 className="text-xl font-semibold text-gray-900 mb-4">Monthly Output Trend</h3>
                    <div className="h-80">
                      <ResponsiveContainer width="100%" height="100%">
                        <AreaChart data={monthlyOutputTrends}>
                          <defs>
                            <linearGradient id="colorArtifacts" x1="0" y1="0" x2="0" y2="1">
                              <stop offset="5%" stopColor="#f59e0b" stopOpacity={0.8}/>
                              <stop offset="95%" stopColor="#f59e0b" stopOpacity={0.1}/>
                            </linearGradient>
                            <linearGradient id="colorLinesOfCode" x1="0" y1="0" x2="0" y2="1">
                              <stop offset="5%" stopColor="#8b5cf6" stopOpacity={0.8}/>
                              <stop offset="95%" stopColor="#8b5cf6" stopOpacity={0.1}/>
                            </linearGradient>
                          </defs>
                          <CartesianGrid strokeDasharray="3 3" />
                          <XAxis dataKey="month" />
                          <YAxis yAxisId="left" />
                          <YAxis yAxisId="right" orientation="right" />
                          <Tooltip />
                          <Legend />
                          <Area
                            yAxisId="left"
                            type="monotone"
                            dataKey="artifacts"
                            stroke="#f59e0b"
                            strokeWidth={2}
                            fillOpacity={1}
                            fill="url(#colorArtifacts)"
                            name="Artifacts"
                          />
                          <Area
                            yAxisId="right"
                            type="monotone"
                            dataKey="linesOfCode"
                            stroke="#8b5cf6"
                            strokeWidth={2}
                            fillOpacity={1}
                            fill="url(#colorLinesOfCode)"
                            name="Lines of Code"
                          />
                        </AreaChart>
                      </ResponsiveContainer>
                    </div>
                  </div>

                  {/* Monthly Adoption Trend */}
                  <div>
                    <h3 className="text-xl font-semibold text-gray-900 mb-4">Monthly Adoption Trend</h3>
                    <div className="h-80">
                      <ResponsiveContainer width="100%" height="100%">
                        <AreaChart data={monthlyAdoptionTrends}>
                          <defs>
                            <linearGradient id="colorActiveUsers" x1="0" y1="0" x2="0" y2="1">
                              <stop offset="5%" stopColor="#3b82f6" stopOpacity={0.8}/>
                              <stop offset="95%" stopColor="#3b82f6" stopOpacity={0.1}/>
                            </linearGradient>
                          </defs>
                          <CartesianGrid strokeDasharray="3 3" />
                          <XAxis dataKey="month" />
                          <YAxis />
                          <Tooltip />
                          <Legend />
                          <Area
                            type="monotone"
                            dataKey="activeUsers"
                            stroke="#3b82f6"
                            strokeWidth={2}
                            fillOpacity={1}
                            fill="url(#colorActiveUsers)"
                            name="Active Users"
                          />
                        </AreaChart>
                      </ResponsiveContainer>
                    </div>
                  </div>
                </div>

                {/* AI-Generated Combined Insight */}
                {aiToolsData.insights?.adoptionOutputTrends && (
                  <div className="bg-gradient-to-r from-blue-50 to-purple-50 p-6 rounded-lg border border-blue-200">
                    <p className="text-sm text-gray-900">
                      <strong className="text-lg">Adoption & Output Analysis:</strong> {aiToolsData.insights.adoptionOutputTrends}
                    </p>
                  </div>
                )}

                {/* SECTION 9: Adoption - Summary Metrics */}
                <div className="grid grid-cols-1 md:grid-cols-3 gap-6">
                  <div className="bg-white border border-gray-200 rounded-lg p-4">
                    <h4 className="text-sm font-medium text-gray-600 mb-2">Avg Conversations/User</h4>
                    <p className="text-3xl font-bold text-gray-900">{summaryMetrics.avgConversationsPerUser}</p>
                    <p className="text-xs text-gray-500 mt-1">Indicates deep engagement</p>
                  </div>
                  <div className="bg-white border border-gray-200 rounded-lg p-4">
                    <h4 className="text-sm font-medium text-gray-600 mb-2">Projects Created</h4>
                    <p className="text-3xl font-bold text-gray-900">{summaryMetrics.claudeProjects}</p>
                    <p className="text-xs text-gray-500 mt-1">Structured workflows</p>
                  </div>
                  <div className="bg-white border border-gray-200 rounded-lg p-4">
                    <h4 className="text-sm font-medium text-gray-600 mb-2">Artifacts Generated</h4>
                    <p className="text-3xl font-bold text-gray-900">{summaryMetrics.claudeArtifacts}</p>
                    <p className="text-xs text-gray-500 mt-1">Documents & code outputs</p>
                  </div>
                </div>

                {/* SECTION 10: Adoption - Claude Enterprise Power Users Table */}
                <div>
                  <h3 className="text-xl font-semibold text-gray-900 mb-2">Claude Enterprise - Power User Champions (Top 15)</h3>
                  <p className="text-sm text-gray-600 mb-4 bg-blue-50 border border-blue-200 rounded-lg p-3">
                    <strong>Power User Scoring:</strong> Ranked by composite score emphasizing outcomes over volume.
                    Score = Artifacts Generated (√ó50) + Files Integrated (√ó10) + Active Usage (√ó2) + Efficiency Bonuses (up to +300).
                    This identifies users producing deliverables and effectively integrating Claude into their workflow.
                  </p>
                  <div className="bg-white rounded-lg shadow-md overflow-hidden">
                    <div className="overflow-x-auto">
                      <table className="min-w-full divide-y divide-gray-200">
                        <thead className="bg-gray-50">
                          <tr>
                            <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Rank</th>
                            <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Name</th>
                            <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Department</th>
                            <th className="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider">Score</th>
                            <th className="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider">Artifacts</th>
                            <th className="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider">Files</th>
                            <th className="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider">Convs</th>
                            <th className="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider">Days Active</th>
                          </tr>
                        </thead>
                        <tbody className="bg-white divide-y divide-gray-200">
                          {aiToolsData.claudeEnterprise.powerUsers.map((user, idx) => (
                            <tr key={user.email} className={idx < 3 ? 'bg-yellow-50' : ''}>
                              <td className="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">
                                {idx === 0 && 'ü•á'} {idx === 1 && 'ü•à'} {idx === 2 && 'ü•â'} {idx + 1}
                              </td>
                              <td className="px-6 py-4 whitespace-nowrap text-sm text-gray-900">{user.name}</td>
                              <td className="px-6 py-4 whitespace-nowrap text-sm text-gray-600">{user.department}</td>
                              <td className="px-6 py-4 whitespace-nowrap text-sm text-right text-blue-600 font-bold">{user.powerUserScore.toLocaleString()}</td>
                              <td className="px-6 py-4 whitespace-nowrap text-sm text-right text-gray-900 font-semibold">{user.artifacts}</td>
                              <td className="px-6 py-4 whitespace-nowrap text-sm text-right text-gray-600">{user.filesUploaded}</td>
                              <td className="px-6 py-4 whitespace-nowrap text-sm text-right text-gray-600">{user.conversations}</td>
                              <td className="px-6 py-4 whitespace-nowrap text-sm text-right text-gray-600">{user.daysSinceLastActivity}</td>
                            </tr>
                          ))}
                        </tbody>
                      </table>
                    </div>
                  </div>
                </div>

                {/* SECTION 11: Adoption - Claude Enterprise Low Engagement Users Table */}
                <div>
                  <h3 className="text-xl font-semibold text-gray-900 mb-4">Claude Enterprise - Low Engagement Users (Enablement Targets)</h3>
                  <div className="bg-white rounded-lg shadow-md overflow-hidden">
                    <div className="overflow-x-auto">
                      <table className="min-w-full divide-y divide-gray-200">
                        <thead className="bg-gray-50">
                          <tr>
                            <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Name</th>
                            <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Department</th>
                            <th className="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider">Messages</th>
                            <th className="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider">Conversations</th>
                            <th className="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider">Days Since Active</th>
                          </tr>
                        </thead>
                        <tbody className="bg-white divide-y divide-gray-200">
                          {aiToolsData.claudeEnterprise.lowEngagementUsers.map((user) => (
                            <tr key={user.email} className="hover:bg-gray-50">
                              <td className="px-6 py-4 whitespace-nowrap text-sm text-gray-900">{user.name}</td>
                              <td className="px-6 py-4 whitespace-nowrap text-sm text-gray-600">{user.department}</td>
                              <td className="px-6 py-4 whitespace-nowrap text-sm text-right text-gray-600">{user.messages}</td>
                              <td className="px-6 py-4 whitespace-nowrap text-sm text-right text-gray-600">{user.conversations}</td>
                              <td className="px-6 py-4 whitespace-nowrap text-sm text-right text-gray-600">{user.daysSinceLastActivity}</td>
                            </tr>
                          ))}
                        </tbody>
                      </table>
                    </div>
                  </div>
                </div>

                {/* SECTION 12: Adoption - Claude Enterprise Department Insights */}
                {aiToolsData.claudeEnterprise.departmentBreakdown && aiToolsData.claudeEnterprise.departmentBreakdown.length > 0 && (
                  <div className="bg-white rounded-lg shadow-md border border-gray-100 p-6">
                    <h3 className="text-xl font-semibold text-gray-900 mb-4">Key Insights: Claude Enterprise by Department</h3>

                    {/* AI-Generated Insight */}
                    {aiToolsData.insights?.claudeEnterpriseDepartmentPerformance && (
                      <div className="bg-gradient-to-r from-purple-50 to-blue-50 p-4 rounded-lg border border-purple-200 mb-6">
                        <p className="text-sm text-gray-900">
                          <strong>Department Performance Analysis:</strong> {aiToolsData.insights.claudeEnterpriseDepartmentPerformance}
                        </p>
                      </div>
                    )}

                    {/* Department Breakdown Table */}
                    <div className="overflow-x-auto">
                      <table className="min-w-full divide-y divide-gray-200">
                        <thead className="bg-gray-50">
                          <tr>
                            <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Department</th>
                            <th className="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider">Users</th>
                            <th className="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider">Conversations</th>
                            <th className="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider">Messages</th>
                            <th className="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider">Artifacts</th>
                            <th className="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider">Avg Convs/User</th>
                            <th className="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider">Avg Msgs/User</th>
                            <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Top User</th>
                          </tr>
                        </thead>
                        <tbody className="bg-white divide-y divide-gray-200">
                          {aiToolsData.claudeEnterprise.departmentBreakdown
                            .sort((a, b) => b.avgMessagesPerUser - a.avgMessagesPerUser)
                            .map((dept, idx) => (
                            <tr key={dept.department} className={idx === 0 ? 'bg-purple-50' : 'hover:bg-gray-50'}>
                              <td className="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">{dept.department}</td>
                              <td className="px-6 py-4 whitespace-nowrap text-sm text-right text-gray-900">{dept.users}</td>
                              <td className="px-6 py-4 whitespace-nowrap text-sm text-right text-gray-600">{dept.conversations.toLocaleString()}</td>
                              <td className="px-6 py-4 whitespace-nowrap text-sm text-right text-gray-600">{dept.messages.toLocaleString()}</td>
                              <td className="px-6 py-4 whitespace-nowrap text-sm text-right text-gray-600">{dept.artifacts}</td>
                              <td className="px-6 py-4 whitespace-nowrap text-sm text-right text-gray-900 font-medium">{dept.avgConversationsPerUser}</td>
                              <td className="px-6 py-4 whitespace-nowrap text-sm text-right text-blue-600 font-semibold">{dept.avgMessagesPerUser}</td>
                              <td className="px-6 py-4 whitespace-nowrap text-sm text-gray-600">{dept.topUser?.name || 'N/A'}</td>
                            </tr>
                          ))}
                        </tbody>
                      </table>
                    </div>
                  </div>
                )}

                {/* SECTION 13: Adoption - Claude Code Power Users Table */}
                <ClaudeCodePowerUsersTable powerUsers={aiToolsData.claudeCode.powerUsers} />

                {/* SECTION 14: Adoption - Claude Code Key Insights */}
                <ClaudeCodeKeyInsights
                  departmentInsight={aiToolsData.insights?.claudeCodeDepartmentPerformance}
                  departmentBreakdown={aiToolsData.claudeCode.departmentBreakdown}
                  topThreeUsers={aiToolsData.claudeCode.powerUsers.slice(0, 3)}
                />

                {/* SECTION 15: Adoption - Claude Code Low Engagement Users Table */}
                <ClaudeCodeLowEngagementUsers lowEngagementUsers={aiToolsData.claudeCode.lowEngagementUsers} />

                {/* SECTION 17: Productivity - Quantified Time Savings */}
                <div className="bg-gradient-to-r from-green-50 to-blue-50 p-6 rounded-lg border border-green-200">
                  <h3 className="text-xl font-semibold text-gray-900 mb-4 flex items-center">
                    <Zap className="h-6 w-6 mr-2 text-green-600" />
                    Claude Enterprise: Quantified Time Savings
                  </h3>
                  <div className="space-y-4">
                    {editorialContent.productivityMetrics.map((item, idx) => (
                      <div key={idx} className="bg-white p-4 rounded-lg shadow-sm border border-gray-200">
                        <div className="flex items-start justify-between mb-2">
                          <h4 className="font-semibold text-gray-900">{item.metric}</h4>
                          <span className="bg-green-100 text-green-800 px-3 py-1 rounded-full text-sm font-semibold">
                            {item.savings}
                          </span>
                        </div>
                        <div className="grid grid-cols-2 gap-4 mb-2">
                          <div>
                            <p className="text-xs text-gray-500 mb-1">Before Claude</p>
                            <p className="font-medium text-gray-700">{item.before}</p>
                          </div>
                          <div>
                            <p className="text-xs text-gray-500 mb-1">With Claude</p>
                            <p className="font-medium text-gray-700">{item.after}</p>
                          </div>
                        </div>
                        <p className="text-xs text-gray-500 italic">{item.source}</p>
                      </div>
                    ))}
                  </div>
                </div>

                {/* SECTION 18: Productivity - Use Cases by Category */}
                <div>
                  <h3 className="text-xl font-semibold text-gray-900 mb-4">Use Cases by Category</h3>
                  <div className="space-y-3">
                    {editorialContent.useCasesByCategory.map((item, idx) => (
                      <div key={idx} className="flex items-center justify-between bg-white p-4 rounded-lg border border-gray-200 hover:shadow-md transition-shadow">
                        <div>
                          <h4 className="font-medium text-gray-900">{item.category}</h4>
                          <p className="text-sm text-gray-500">{item.count} documented use cases</p>
                        </div>
                        <div className="flex items-center">
                          <span className={`px-3 py-1 rounded-full text-sm font-medium ${
                            item.impact === 'High' ? 'bg-red-100 text-red-800' : 'bg-yellow-100 text-yellow-800'
                          }`}>
                            {item.impact} Impact
                          </span>
                        </div>
                      </div>
                    ))}
                  </div>
                </div>

                {/* SECTION 19: Productivity - Productivity Highlights */}
                <div className="bg-purple-50 p-6 rounded-lg border border-purple-200">
                  <h3 className="text-lg font-semibold text-gray-900 mb-3">Claude Enterprise Productivity Highlights</h3>
                  <ul className="space-y-2">
                    {editorialContent.productivityHighlights.map((highlight, idx) => (
                      <li key={idx} className="flex items-start">
                        <Award className="h-5 w-5 text-purple-600 mr-2 mt-0.5 flex-shrink-0" />
                        <span className="text-gray-700" dangerouslySetInnerHTML={{ __html: highlight.text }} />
                      </li>
                    ))}
                  </ul>
                </div>

                {/* SECTION 20: Departments - Department Adoption & Usage */}
                {(() => {
                  // Aggregate ALL-TIME department data from Claude Enterprise conversations and Claude Code lines
                  const deptMap = {};

                  // No normalization - keep Engineering and AI & Data separate
                  const normalizeDeptName = (name) => name;

                  // Aggregate Claude Enterprise conversations across ALL months
                  aiToolsData.claudeEnterprise.monthlyTrend.forEach(month => {
                    if (month?.byDept) {
                      month.byDept.forEach(dept => {
                        const deptName = normalizeDeptName(dept.department);
                        if (!deptMap[deptName]) {
                          deptMap[deptName] = { name: deptName, users: 0, conversations: 0, codeLines: 0 };
                        }
                        deptMap[deptName].users = Math.max(deptMap[deptName].users, dept.users || 0);
                        deptMap[deptName].conversations += dept.conversations || 0;
                      });
                    }
                  });

                  // Aggregate Claude Code lines across ALL months
                  aiToolsData.claudeCode.monthlyTrend.forEach(month => {
                    if (month?.byDept) {
                      month.byDept.forEach(dept => {
                        const deptName = normalizeDeptName(dept.department);
                        if (!deptMap[deptName]) {
                          deptMap[deptName] = { name: deptName, users: 0, conversations: 0, codeLines: 0 };
                        }
                        deptMap[deptName].codeLines += dept.lines || 0;
                        deptMap[deptName].users = Math.max(deptMap[deptName].users, dept.users || 0);
                      });
                    }
                  });

                  // Calculate engagement score for sorting
                  const getEngagementScore = (dept) => {
                    const avgConvPerUser = dept.users > 0 ? dept.conversations / dept.users : 0;
                    const avgLocPerUser = dept.users > 0 ? dept.codeLines / dept.users : 0;

                    // Assign numeric scores: High=3, Medium=2, Growing=1, None=0
                    const convScore = avgConvPerUser > 30 ? 3 : avgConvPerUser > 20 ? 2 : avgConvPerUser > 0 ? 1 : 0;
                    const locScore = avgLocPerUser > 20000 ? 3 : avgLocPerUser > 10000 ? 2 : avgLocPerUser > 0 ? 1 : 0;

                    // Combined score: conversations * 10 + code (prioritizes conversations first)
                    return convScore * 10 + locScore;
                  };

                  // Convert to array and add value for pie chart
                  const departmentUsageData = Object.values(deptMap)
                    .filter(dept => dept.users > 0) // Only departments with users
                    .sort((a, b) => {
                      const scoreA = getEngagementScore(a);
                      const scoreB = getEngagementScore(b);
                      // Sort by engagement score (High+High first, None+None last)
                      if (scoreB !== scoreA) return scoreB - scoreA;
                      // If same engagement, sort by user count
                      return b.users - a.users;
                    })
                    .map(dept => ({
                      ...dept,
                      value: dept.users // For pie chart
                    }));

                  return (
                  <>
                    <div>
                      <h3 className="text-xl font-semibold text-gray-900 mb-4">Department Adoption & Usage</h3>
                      <div className="grid grid-cols-1 lg:grid-cols-2 gap-6">
                        <div className="h-80">
                          <ResponsiveContainer width="100%" height="100%">
                            <BarChart data={departmentUsageData}>
                              <CartesianGrid strokeDasharray="3 3" />
                              <XAxis dataKey="name" angle={-45} textAnchor="end" height={100} />
                              <YAxis yAxisId="left" />
                              <YAxis yAxisId="right" orientation="right" />
                              <Tooltip />
                              <Legend />
                              <Bar yAxisId="left" dataKey="conversations" fill="#10b981" name="Conversations (Claude Enterprise)" />
                              <Bar yAxisId="right" dataKey="codeLines" fill="#8b5cf6" name="Lines of Code (Claude Code)" />
                            </BarChart>
                          </ResponsiveContainer>
                        </div>
                        <div className="h-80">
                          <ResponsiveContainer width="100%" height="100%">
                            <PieChart>
                              <Pie
                                data={departmentUsageData}
                                cx="50%"
                                cy="50%"
                                labelLine={false}
                                label={({ name, percent }) => `${name} ${(percent * 100).toFixed(0)}%`}
                                outerRadius={100}
                                fill="#8884d8"
                                dataKey="value"
                              >
                                {departmentUsageData.map((entry, index) => (
                                  <Cell key={`cell-${index}`} fill={COLORS[index % COLORS.length]} />
                                ))}
                              </Pie>
                              <Tooltip />
                            </PieChart>
                          </ResponsiveContainer>
                        </div>
                      </div>
                    </div>

                    <div>
                      <h3 className="text-xl font-semibold text-gray-900 mb-4">Department Breakdown</h3>
                      <div className="overflow-x-auto">
                        <table className="w-full text-sm text-left">
                          <thead className="text-xs text-gray-700 uppercase bg-gray-50">
                            <tr>
                              <th className="px-4 py-3">Department</th>
                              <th className="px-4 py-3">Active Users</th>
                              <th className="px-4 py-3 bg-green-50">Conversations<br/>(Claude Web/Desktop)</th>
                              <th className="px-4 py-3 bg-green-50">Avg Conv/User</th>
                              <th className="px-4 py-3 bg-green-50">Engagement Level<br/>(Claude Web/Desktop)</th>
                              <th className="px-4 py-3 bg-purple-50">LoC<br/>(Claude Code)</th>
                              <th className="px-4 py-3 bg-purple-50">Avg LoC/User</th>
                              <th className="px-4 py-3 bg-purple-50">Engagement Level<br/>(Claude Code)</th>
                            </tr>
                          </thead>
                          <tbody>
                            {departmentUsageData.map((dept, idx) => {
                              const avgConvPerUser = dept.users > 0 ? (dept.conversations / dept.users).toFixed(1) : 0;
                              const avgLocPerUser = dept.users > 0 ? Math.round(dept.codeLines / dept.users) : 0;

                              // Engagement levels
                              const convEngagement = avgConvPerUser > 30 ? 'High' : avgConvPerUser > 20 ? 'Medium' : avgConvPerUser > 0 ? 'Growing' : 'None';
                              const convEngagementColor = avgConvPerUser > 30
                                ? 'bg-green-100 text-green-800'
                                : avgConvPerUser > 20
                                ? 'bg-yellow-100 text-yellow-800'
                                : avgConvPerUser > 0
                                ? 'bg-gray-100 text-gray-800'
                                : 'bg-gray-50 text-gray-500';

                              const locEngagement = avgLocPerUser > 20000 ? 'High' : avgLocPerUser > 10000 ? 'Medium' : avgLocPerUser > 0 ? 'Growing' : 'None';
                              const locEngagementColor = avgLocPerUser > 20000
                                ? 'bg-purple-100 text-purple-800'
                                : avgLocPerUser > 10000
                                ? 'bg-indigo-100 text-indigo-800'
                                : avgLocPerUser > 0
                                ? 'bg-gray-100 text-gray-800'
                                : 'bg-gray-50 text-gray-500';

                              return (
                                <tr key={idx} className="bg-white border-b hover:bg-gray-50">
                                  <td className="px-4 py-4 font-medium text-gray-900">{dept.name}</td>
                                  <td className="px-4 py-4">{dept.users}</td>
                                  <td className="px-4 py-4 bg-green-50">{dept.conversations.toLocaleString()}</td>
                                  <td className="px-4 py-4 bg-green-50">{avgConvPerUser}</td>
                                  <td className="px-4 py-4 bg-green-50">
                                    <span className={`px-2 py-1 rounded text-xs font-medium ${convEngagementColor}`}>
                                      {convEngagement}
                                    </span>
                                  </td>
                                  <td className="px-4 py-4 bg-purple-50">{dept.codeLines.toLocaleString()}</td>
                                  <td className="px-4 py-4 bg-purple-50">{avgLocPerUser.toLocaleString()}</td>
                                  <td className="px-4 py-4 bg-purple-50">
                                    <span className={`px-2 py-1 rounded text-xs font-medium ${locEngagementColor}`}>
                                      {locEngagement}
                                    </span>
                                  </td>
                                </tr>
                              );
                            })}
                          </tbody>
                        </table>
                      </div>
                    </div>

                    {/* Key Insights Section */}
                    {aiToolsData.insights?.departmentInsights && (
                      <div className="mt-8">
                        <h3 className="text-xl font-semibold text-gray-900 mb-4">Key Insights</h3>
                        <div className="bg-gradient-to-br from-purple-50 to-blue-50 rounded-lg p-6 border border-purple-200">
                          <div className="space-y-4 text-gray-700 leading-relaxed">
                            {aiToolsData.insights.departmentInsights.split('\n\n').map((paragraph, idx) => (
                              <p key={idx} className="text-sm">
                                {paragraph}
                              </p>
                            ))}
                          </div>
                          <div className="mt-4 pt-4 border-t border-purple-200">
                            <p className="text-xs text-gray-500 italic">
                              AI-generated insights based on current department adoption data and industry benchmarks
                            </p>
                          </div>
                        </div>
                      </div>
                    )}
                  </>
                  );
                })()}
              </div>
            )}

            {/* Claude Code Tab */}
            {activeTab === 'claude-code' && (
              <div className="space-y-6">
                <div className="bg-gradient-to-r from-indigo-50 to-purple-50 p-6 rounded-lg border border-indigo-200">
                  <h3 className="text-xl font-semibold text-gray-900 mb-4">Claude Code Developer Impact</h3>
                  <div className="grid grid-cols-1 md:grid-cols-4 gap-4 mb-4">
                    <div className="bg-white p-4 rounded-lg shadow-sm">
                      <p className="text-sm text-gray-600 mb-1">Total Lines Generated</p>
                      <p className="text-3xl font-bold text-indigo-600">{(aiToolsData.claudeCode.totalLines / 1000).toFixed(0)}K</p>
                      <p className="text-xs text-gray-500">All time</p>
                    </div>
                    <div className="bg-white p-4 rounded-lg shadow-sm">
                      <p className="text-sm text-gray-600 mb-1">Total Adoption</p>
                      <p className="text-3xl font-bold text-purple-600">
                        {(() => {
                          const latestMonth = aiToolsData.claudeCode.monthlyTrend[aiToolsData.claudeCode.monthlyTrend.length - 1];
                          const activeUsers = latestMonth ? latestMonth.users : 0;
                          const licensedUsers = aiToolsData.claudeCode.licensedUsers;
                          return Math.round((activeUsers / licensedUsers) * 100);
                        })()}%
                      </p>
                      <p className="text-xs text-gray-500">
                        {(() => {
                          const latestMonth = aiToolsData.claudeCode.monthlyTrend[aiToolsData.claudeCode.monthlyTrend.length - 1];
                          return latestMonth ? `${latestMonth.users} of ${aiToolsData.claudeCode.licensedUsers} licensed (${latestMonth.monthLabel})` : 'No data';
                        })()}
                      </p>
                    </div>
                    <div className="bg-white p-4 rounded-lg shadow-sm">
                      <p className="text-sm text-gray-600 mb-1">Avg Lines/Developer</p>
                      <p className="text-3xl font-bold text-blue-600">{aiToolsData.claudeCode.linesPerUser.toLocaleString()}</p>
                      <p className="text-xs text-gray-500">All time average</p>
                    </div>
                    <div className="bg-white p-4 rounded-lg shadow-sm">
                      <p className="text-sm text-gray-600 mb-1">Engineering Coverage</p>
                      <p className="text-3xl font-bold text-green-600">{Math.round((aiToolsData.claudeCode.licensedUsers / aiToolsData.claudeCode.totalEngineeringEmployees) * 100)}%</p>
                      <p className="text-xs text-gray-500">{aiToolsData.claudeCode.licensedUsers} of {aiToolsData.claudeCode.totalEngineeringEmployees} engineers</p>
                    </div>
                  </div>
                </div>

                <div>
                  <h3 className="text-xl font-semibold text-gray-900 mb-4">Code Generation Trends</h3>
                  <div className="h-80">
                    <ResponsiveContainer width="100%" height="100%">
                      <BarChart data={aiToolsData.claudeCode.monthlyTrend.map(m => ({
                        month: m.monthLabel,
                        users: m.users,
                        lines: m.totalLines,
                        avgPerUser: m.linesPerUser
                      }))}>
                        <CartesianGrid strokeDasharray="3 3" />
                        <XAxis dataKey="month" />
                        <YAxis yAxisId="left" />
                        <YAxis yAxisId="right" orientation="right" />
                        <Tooltip />
                        <Legend />
                        <Bar yAxisId="left" dataKey="lines" fill="#8b5cf6" name="Total Lines" />
                        <Bar yAxisId="right" dataKey="users" fill="#3b82f6" name="Active Users" />
                      </BarChart>
                    </ResponsiveContainer>
                  </div>
                </div>

                {/* Claude Code Power Users - Reusable Component */}
                <ClaudeCodePowerUsersTable powerUsers={aiToolsData.claudeCode.powerUsers} />

                {/* Claude Code Key Insights - Reusable Component */}
                <ClaudeCodeKeyInsights
                  departmentInsight={aiToolsData.insights?.claudeCodeDepartmentPerformance}
                  departmentBreakdown={aiToolsData.claudeCode.departmentBreakdown}
                  topThreeUsers={aiToolsData.claudeCode.powerUsers.slice(0, 3)}
                />

                {/* Claude Code Low Engagement Users - Reusable Component */}
                <ClaudeCodeLowEngagementUsers lowEngagementUsers={aiToolsData.claudeCode.lowEngagementUsers} />

                <div className="bg-green-50 p-6 rounded-lg border border-green-200">
                  <h3 className="text-lg font-semibold text-gray-900 mb-3">Claude Code Success Stories</h3>
                  <div className="space-y-3">
                    <div className="bg-white p-4 rounded-lg">
                      <h4 className="font-semibold text-gray-900 mb-2">Large-Scale Refactoring</h4>
                      <p className="text-sm text-gray-700 mb-2">
                        Roger Hampton used Claude Code to plan extraction of complex calculations module with comprehensive test generation
                      </p>
                      <span className="text-xs text-green-700 font-medium">Impact: Risk reduction + weeks of manual test writing saved</span>
                    </div>
                    <div className="bg-white p-4 rounded-lg">
                      <h4 className="font-semibold text-gray-900 mb-2">Automated Code Review</h4>
                      <p className="text-sm text-gray-700 mb-2">
                        Sean Martin developed comprehensive review prompts covering security, performance, and standards compliance
                      </p>
                      <span className="text-xs text-green-700 font-medium">Impact: Consistent reviews + early bug detection</span>
                    </div>
                    <div className="bg-white p-4 rounded-lg">
                      <h4 className="font-semibold text-gray-900 mb-2">Internal Plugin Marketplace</h4>
                      <p className="text-sm text-gray-700 mb-2">
                        Yassel Piloto created marketplace with Datadog operations automation and deployment analysis tools
                      </p>
                      <span className="text-xs text-green-700 font-medium">Impact: Team productivity multiplier + knowledge sharing</span>
                    </div>
                  </div>
                </div>

                <div className="bg-blue-50 p-6 rounded-lg border border-blue-200">
                  <h3 className="text-lg font-semibold text-gray-900 mb-3">Developer Testimonial</h3>
                  <blockquote className="italic text-gray-700 mb-2">
                    "We have noticed significant increase in performance and output. Claude code is a very valuable and extremely expensive tool used well it will make your life a lot easier."
                  </blockquote>
                  <p className="text-sm text-gray-600">‚Äî Jeff Rivero, Principal AI Architect</p>
                </div>
              </div>
            )}

            {/* Enablement Tab */}
            {activeTab === 'enablement' && (
              <div className="space-y-6">
                <div className="bg-gradient-to-r from-green-50 to-blue-50 p-6 rounded-lg border border-green-200">
                  <h3 className="text-xl font-semibold mb-4">{enablementPlan.programTitle}</h3>
                  <div className="grid grid-cols-3 gap-4">
                    {enablementPlan.budgetBreakdown.map((item, idx) => (
                      <div key={idx} className={`bg-white p-4 rounded shadow-sm border-2 ${item.borderColor}`}>
                        <p className="text-sm text-gray-600 mb-1">{item.role}</p>
                        <p className={`text-2xl font-bold ${item.textColor}`}>${(item.cost / 1000).toFixed(0)}K</p>
                        <p className="text-xs text-gray-500 mt-1">{item.description}</p>
                      </div>
                    ))}
                  </div>
                </div>

                <div className="grid grid-cols-2 gap-6">
                  <div className="bg-white border border-gray-200 rounded-lg p-5">
                    <h4 className="font-semibold mb-3">Key Deliverables</h4>
                    <ul className="text-sm text-gray-700 space-y-2">
                      {enablementPlan.keyDeliverables.map((deliverable, idx) => (
                        <li key={idx}>‚Ä¢ {deliverable}</li>
                      ))}
                    </ul>
                  </div>
                  <div className="bg-white border border-gray-200 rounded-lg p-5">
                    <h4 className="font-semibold mb-3">Expected Impact</h4>
                    <div className="space-y-3">
                      <div className="p-3 bg-blue-50 rounded">
                        <p className="text-xs text-gray-600">{enablementPlan.expectedImpact.dailyActiveRate.label}</p>
                        <p className="text-xl font-bold text-blue-600">{enablementPlan.expectedImpact.dailyActiveRate.current} ‚Üí {enablementPlan.expectedImpact.dailyActiveRate.target}</p>
                      </div>
                      <div className="p-3 bg-green-50 rounded">
                        <p className="text-xs text-gray-600">{enablementPlan.expectedImpact.annualValue.label}</p>
                        <p className="text-xl font-bold text-green-600">{enablementPlan.expectedImpact.annualValue.range}</p>
                      </div>
                      <div className="p-3 bg-purple-50 rounded border border-purple-300">
                        <p className="text-xs text-gray-600">{enablementPlan.expectedImpact.programROI.label}</p>
                        <p className="text-xl font-bold text-purple-600">{enablementPlan.expectedImpact.programROI.yearOne}</p>
                        <p className="text-xs text-gray-500 mt-1">Year 1 | {enablementPlan.expectedImpact.programROI.ongoing}</p>
                      </div>
                    </div>
                  </div>
                </div>

                <div className="bg-yellow-50 p-4 rounded border border-yellow-300">
                  <p className="text-sm text-yellow-900">
                    <strong>Foundation:</strong> {enablementPlan.foundationNote}
                  </p>
                </div>
              </div>
            )}

            {/* 2026 Annual Plan Presentation */}
            {activeTab === '2026-plan' && (
              <div className="h-[calc(100vh-12rem)]">
                <AnnualPlanPresentation aiToolsData={aiToolsData} />
              </div>
            )}

            {/* Coding Tools Comparison Tab */}
            {activeTab === 'coding-tools' && (
              <div className="space-y-6">
                <div>
                  <h3 className="text-2xl font-bold text-gray-900 mb-2">Coding Tools Comparison</h3>
                  <p className="text-gray-600">GitHub Copilot vs Claude Code productivity and usage analysis</p>
                </div>

                {/* Key Metrics Comparison */}
                <div className="grid grid-cols-1 md:grid-cols-3 gap-6">
                  <MetricCard
                    title="GitHub Copilot Users"
                    value={aiToolsData.githubCopilot.activeUsers}
                    icon={Users}
                    color="blue"
                  />
                  <MetricCard
                    title="Claude Code Users"
                    value={aiToolsData.claudeCode.activeUsers}
                    icon={Users}
                    color="purple"
                  />
                  <MetricCard
                    title="Productivity Advantage"
                    value={`${aiToolsData.codingProductivityMultiplier}x`}
                    icon={TrendingUp}
                    color="green"
                    changeLabel="Claude Code vs GitHub Copilot"
                  />
                </div>

                {/* Engineering Adoption Metrics */}
                <div className="bg-gradient-to-br from-blue-50 to-purple-50 rounded-lg shadow-md border border-blue-100 p-6">
                  <h4 className="text-lg font-semibold text-gray-900 mb-4">Engineering Organization Adoption</h4>
                  <div className="grid grid-cols-1 md:grid-cols-3 gap-6">
                    <div className="bg-white rounded-lg p-4 border border-gray-200">
                      <div className="flex items-center justify-between mb-2">
                        <p className="text-sm font-medium text-gray-600">GitHub Copilot</p>
                        <div className="text-2xl">üë®‚Äçüíª</div>
                      </div>
                      <p className="text-3xl font-bold text-blue-600">{aiToolsData.githubCopilot.engineeringAdoptionRate}%</p>
                      <p className="text-xs text-gray-500 mt-1">{aiToolsData.githubCopilot.activeUsers} active of {aiToolsData.githubCopilot.totalEngineeringEmployees} total</p>
                      <p className="text-[10px] text-gray-400">Engineering + Agentic AI</p>
                    </div>
                    <div className="bg-white rounded-lg p-4 border border-gray-200">
                      <div className="flex items-center justify-between mb-2">
                        <p className="text-sm font-medium text-gray-600">Claude Code</p>
                        <div className="text-2xl">üöÄ</div>
                      </div>
                      <p className="text-3xl font-bold text-purple-600">{aiToolsData.claudeCode.engineeringAdoptionRate}%</p>
                      <p className="text-xs text-gray-500 mt-1">{aiToolsData.claudeCode.activeUsers} active of {aiToolsData.claudeCode.totalEngineeringEmployees} total</p>
                      <p className="text-[10px] text-gray-400">{aiToolsData.claudeCode.licensedUsers} licensed ‚Ä¢ Engineering + Agentic AI</p>
                    </div>
                    <div className="bg-white rounded-lg p-4 border border-gray-200">
                      <div className="flex items-center justify-between mb-2">
                        <p className="text-sm font-medium text-gray-600">Combined Adoption</p>
                        <div className="text-2xl">‚ú®</div>
                      </div>
                      <p className="text-3xl font-bold text-green-600">{aiToolsData.claudeCode.combinedCodingToolsAdoption}%</p>
                      <p className="text-xs text-gray-500 mt-1">{aiToolsData.claudeCode.combinedCodingToolsUsers} engineers using AI coding tools</p>
                    </div>
                  </div>
                  <div className="mt-4 p-4 bg-blue-50 border border-blue-200 rounded-lg">
                    <p className="text-sm text-blue-800">
                      <strong>Note:</strong> Combined adoption represents the percentage of Engineering + Agentic AI employees ({aiToolsData.claudeCode.totalEngineeringEmployees} total) using either GitHub Copilot, Claude Code, or both for AI-assisted coding. This shows {aiToolsData.claudeCode.combinedCodingToolsAdoption}% of engineers are actively leveraging AI coding assistants.
                    </p>
                  </div>
                </div>

                {/* Total Lines of Code Over Time */}
                <div className="bg-white rounded-lg shadow-md border border-gray-100 p-6">
                  <h4 className="text-lg font-semibold text-gray-900 mb-4">Total Lines of Code Generated Over Time (Monthly)</h4>
                  <div className="h-80">
                    <ResponsiveContainer width="100%" height="100%">
                      <AreaChart data={(() => {
                        // Merge GitHub Copilot and Claude Code monthly data
                        const dataMap = new Map();

                        // Add GitHub Copilot monthly data
                        aiToolsData.githubCopilot.monthlyTrend.forEach(m => {
                          dataMap.set(m.month, {
                            month: m.month,
                            monthLabel: m.monthLabel,
                            copilotLines: m.totalLines,
                            claudeCodeLines: null
                          });
                        });

                        // Add Claude Code monthly data
                        aiToolsData.claudeCode.monthlyTrend.forEach(m => {
                          if (dataMap.has(m.month)) {
                            dataMap.get(m.month).claudeCodeLines = m.totalLines;
                          } else {
                            dataMap.set(m.month, {
                              month: m.month,
                              monthLabel: m.monthLabel,
                              copilotLines: null,
                              claudeCodeLines: m.totalLines
                            });
                          }
                        });

                        return Array.from(dataMap.values()).sort((a, b) => a.month.localeCompare(b.month));
                      })()}>
                        <defs>
                          <linearGradient id="colorCopilotLines" x1="0" y1="0" x2="0" y2="1">
                            <stop offset="5%" stopColor="#3b82f6" stopOpacity={0.8}/>
                            <stop offset="95%" stopColor="#3b82f6" stopOpacity={0}/>
                          </linearGradient>
                          <linearGradient id="colorClaudeCodeLines" x1="0" y1="0" x2="0" y2="1">
                            <stop offset="5%" stopColor="#8b5cf6" stopOpacity={0.8}/>
                            <stop offset="95%" stopColor="#8b5cf6" stopOpacity={0}/>
                          </linearGradient>
                        </defs>
                        <CartesianGrid strokeDasharray="3 3" />
                        <XAxis dataKey="monthLabel" />
                        <YAxis label={{ value: 'Lines of Code', angle: -90, position: 'insideLeft' }} />
                        <Tooltip formatter={(value) => value ? value.toLocaleString() : 'N/A'} />
                        <Legend />
                        <Area
                          type="monotone"
                          dataKey="copilotLines"
                          stroke="#3b82f6"
                          fillOpacity={1}
                          fill="url(#colorCopilotLines)"
                          name="GitHub Copilot"
                          connectNulls={true}
                        />
                        <Area
                          type="monotone"
                          dataKey="claudeCodeLines"
                          stroke="#8b5cf6"
                          fillOpacity={1}
                          fill="url(#colorClaudeCodeLines)"
                          name="Claude Code"
                          connectNulls={true}
                        />
                      </AreaChart>
                    </ResponsiveContainer>
                  </div>
                  <div className="mt-4 p-4 bg-purple-50 border border-purple-200 rounded-lg">
                    <p className="text-sm text-purple-800">
                      <strong>Key Insight:</strong> {aiToolsData.insights?.codingToolsBusinessQuestion || `Track the total code generation volume across both tools to understand overall productivity impact and adoption patterns.`}
                    </p>
                  </div>
                </div>

                {/* Lines of Code Comparison */}
                <div className="bg-white rounded-lg shadow-md border border-gray-100 p-6">
                  <h4 className="text-lg font-semibold text-gray-900 mb-4">Lines of Code Generated Per User</h4>
                  <div className="h-80">
                    <ResponsiveContainer width="100%" height="100%">
                      <BarChart data={[
                        { tool: 'GitHub Copilot', linesPerUser: aiToolsData.githubCopilot.linesPerUser, fill: '#3b82f6' },
                        { tool: 'Claude Code', linesPerUser: aiToolsData.claudeCode.linesPerUser, fill: '#8b5cf6' }
                      ]}>
                        <CartesianGrid strokeDasharray="3 3" />
                        <XAxis dataKey="tool" />
                        <YAxis />
                        <Tooltip formatter={(value) => value.toLocaleString()} />
                        <Bar dataKey="linesPerUser" fill="#8b5cf6">
                          {[0, 1].map((entry, index) => (
                            <Cell key={`cell-${index}`} fill={index === 0 ? '#3b82f6' : '#8b5cf6'} />
                          ))}
                        </Bar>
                      </BarChart>
                    </ResponsiveContainer>
                  </div>
                  <div className="mt-4 p-4 bg-green-50 border border-green-200 rounded-lg">
                    <p className="text-sm text-green-800">
                      <strong>Key Insight:</strong> {aiToolsData.insights?.productivityComparison || `Claude Code users generate **${aiToolsData.codingProductivityMultiplier}x more lines of code** per user compared to GitHub Copilot (${aiToolsData.claudeCode.linesPerUser.toLocaleString()} vs ${aiToolsData.githubCopilot.linesPerUser.toLocaleString()} lines/user).`}
                    </p>
                  </div>
                </div>

                {/* Lines Per User Trend Over Time */}
                <div className="bg-white rounded-lg shadow-md border border-gray-100 p-6">
                  <h4 className="text-lg font-semibold text-gray-900 mb-4">Lines Per User Trend Over Time (Monthly)</h4>
                  <div className="h-80">
                    <ResponsiveContainer width="100%" height="100%">
                      <AreaChart data={(() => {
                        // Merge GitHub Copilot and Claude Code monthly data
                        const dataMap = new Map();

                        // Add GitHub Copilot monthly data
                        aiToolsData.githubCopilot.monthlyTrend.forEach(m => {
                          dataMap.set(m.month, {
                            month: m.month,
                            monthLabel: m.monthLabel,
                            githubCopilot: m.linesPerUser,
                            claudeCode: null
                          });
                        });

                        // Add Claude Code monthly data
                        aiToolsData.claudeCode.monthlyTrend.forEach(m => {
                          if (dataMap.has(m.month)) {
                            dataMap.get(m.month).claudeCode = m.linesPerUser;
                          } else {
                            dataMap.set(m.month, {
                              month: m.month,
                              monthLabel: m.monthLabel,
                              githubCopilot: null,
                              claudeCode: m.linesPerUser
                            });
                          }
                        });

                        return Array.from(dataMap.values()).sort((a, b) => a.month.localeCompare(b.month));
                      })()}>
                        <defs>
                          <linearGradient id="colorGithubCopilotLines" x1="0" y1="0" x2="0" y2="1">
                            <stop offset="5%" stopColor="#3b82f6" stopOpacity={0.8}/>
                            <stop offset="95%" stopColor="#3b82f6" stopOpacity={0}/>
                          </linearGradient>
                          <linearGradient id="colorClaudeCodeTrend" x1="0" y1="0" x2="0" y2="1">
                            <stop offset="5%" stopColor="#8b5cf6" stopOpacity={0.8}/>
                            <stop offset="95%" stopColor="#8b5cf6" stopOpacity={0}/>
                          </linearGradient>
                        </defs>
                        <CartesianGrid strokeDasharray="3 3" />
                        <XAxis dataKey="monthLabel" />
                        <YAxis label={{ value: 'Lines per User', angle: -90, position: 'insideLeft' }} />
                        <Tooltip formatter={(value) => value ? value.toLocaleString() : 'N/A'} />
                        <Legend />
                        <Area
                          type="monotone"
                          dataKey="githubCopilot"
                          stroke="#3b82f6"
                          fillOpacity={1}
                          fill="url(#colorGithubCopilotLines)"
                          name="GitHub Copilot"
                          connectNulls={true}
                        />
                        <Area
                          type="monotone"
                          dataKey="claudeCode"
                          stroke="#8b5cf6"
                          fillOpacity={1}
                          fill="url(#colorClaudeCodeTrend)"
                          name="Claude Code"
                          connectNulls={true}
                        />
                      </AreaChart>
                    </ResponsiveContainer>
                  </div>
                  <div className="mt-4 p-4 bg-blue-50 border border-blue-200 rounded-lg">
                    <p className="text-sm text-blue-800">
                      <strong>Trend Analysis:</strong> {aiToolsData.insights?.linesPerUserTrend || `Both tools show monthly productivity trends, with Claude Code maintaining consistently higher lines per user compared to GitHub Copilot across ${aiToolsData.claudeCode.monthlyTrend.length} months.`}
                    </p>
                  </div>
                </div>

                {/* Model Preferences in GitHub Copilot */}
                <div className="bg-white rounded-lg shadow-md border border-gray-100 p-6">
                  <h4 className="text-lg font-semibold text-gray-900 mb-4">GitHub Copilot: Model Preference Analysis</h4>
                  <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div className="h-64">
                      <ResponsiveContainer width="100%" height="100%">
                        <PieChart>
                          <Pie
                            data={aiToolsData.githubCopilot.modelPreferences}
                            cx="50%"
                            cy="50%"
                            labelLine={false}
                            label={({model, percentage}) => `${model} ${percentage}%`}
                            outerRadius={80}
                            fill="#8884d8"
                            dataKey="percentage"
                          >
                            {aiToolsData.githubCopilot.modelPreferences.map((entry, index) => (
                              <Cell key={`cell-${index}`} fill={['#8b5cf6', '#94a3b8', '#3b82f6', '#10b981'][index % 4]} />
                            ))}
                          </Pie>
                          <Tooltip />
                        </PieChart>
                      </ResponsiveContainer>
                    </div>
                    <div className="space-y-3">
                      {aiToolsData.githubCopilot.modelPreferences.map((pref, index) => (
                        <div key={index} className="flex items-center justify-between p-3 bg-gray-50 rounded-lg">
                          <span className="font-medium text-gray-900">{pref.model}</span>
                          <div className="text-right">
                            <div className="text-lg font-bold text-gray-900">{pref.percentage}%</div>
                            <div className="text-xs text-gray-500">{pref.lines.toLocaleString()} lines</div>
                          </div>
                        </div>
                      ))}
                    </div>
                  </div>
                  <div className="mt-4 p-4 bg-purple-50 border border-purple-200 rounded-lg">
                    <p className="text-sm text-purple-800">
                      <strong>Key Insight:</strong> {aiToolsData.insights?.modelPreference || `Engineers choose Claude models **72% of the time** when using GitHub Copilot's multi-model choice feature, demonstrating a strong preference for Claude's code generation capabilities.`}
                    </p>
                  </div>
                </div>

                {/* Cost Analysis */}
                <div className="bg-white rounded-lg shadow-md border border-gray-100 p-6">
                  <h4 className="text-lg font-semibold text-gray-900 mb-4">Cost & ROI Analysis</h4>
                  <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div className="p-4 bg-blue-50 rounded-lg">
                      <h5 className="font-semibold text-blue-900 mb-2">GitHub Copilot</h5>
                      <div className="space-y-2 text-sm">
                        <div className="flex justify-between">
                          <span className="text-blue-700">Cost per user:</span>
                          <span className="font-bold text-blue-900">$19/month</span>
                        </div>
                        <div className="flex justify-between">
                          <span className="text-blue-700">Active users:</span>
                          <span className="font-bold text-blue-900">{aiToolsData.githubCopilot.activeUsers}</span>
                        </div>
                        <div className="flex justify-between border-t border-blue-200 pt-2">
                          <span className="text-blue-700">Monthly cost:</span>
                          <span className="font-bold text-blue-900">${(aiToolsData.githubCopilot.activeUsers * 19).toLocaleString()}</span>
                        </div>
                        <div className="flex justify-between">
                          <span className="text-blue-700">Annual cost:</span>
                          <span className="font-bold text-blue-900">${(aiToolsData.githubCopilot.activeUsers * 19 * 12).toLocaleString()}</span>
                        </div>
                      </div>
                    </div>
                    <div className="p-4 bg-purple-50 rounded-lg">
                      <h5 className="font-semibold text-purple-900 mb-2">Claude Code Premium</h5>
                      <div className="space-y-2 text-sm">
                        <div className="flex justify-between">
                          <span className="text-purple-700">Cost per user:</span>
                          <span className="font-bold text-purple-900">$200/month</span>
                        </div>
                        <div className="flex justify-between">
                          <span className="text-purple-700">Active users:</span>
                          <span className="font-bold text-purple-900">{aiToolsData.claudeCode.activeUsers}</span>
                        </div>
                        <div className="flex justify-between border-t border-purple-200 pt-2">
                          <span className="text-purple-700">Monthly cost:</span>
                          <span className="font-bold text-purple-900">${(aiToolsData.claudeCode.activeUsers * 200).toLocaleString()}</span>
                        </div>
                        <div className="flex justify-between">
                          <span className="text-purple-700">Annual cost:</span>
                          <span className="font-bold text-purple-900">${(aiToolsData.claudeCode.activeUsers * 200 * 12).toLocaleString()}</span>
                        </div>
                      </div>
                    </div>
                  </div>
                  <div className="mt-4 p-4 bg-amber-50 border border-amber-200 rounded-lg">
                    <p className="text-sm text-amber-800">
                      <strong>Business Question:</strong> {aiToolsData.insights?.codingToolsBusinessQuestion || `With ${aiToolsData.codingProductivityMultiplier}x productivity advantage and 72% Claude preference in Copilot, should we consolidate to Claude Code? GitHub Copilot contract expires March 2026.`}
                    </p>
                  </div>
                </div>

                {/* Claude Code: Lines of Code by Department Over Time */}
                <div className="bg-white rounded-lg shadow-md border border-gray-100 p-6">
                  <h4 className="text-lg font-semibold text-gray-900 mb-4">Claude Code: Lines of Code Generated by Department</h4>
                  <div className="h-80">
                    <ResponsiveContainer width="100%" height="100%">
                      <AreaChart data={(() => {
                        // Get top 5 departments by total lines of code across all months
                        const deptLineTotals = new Map();
                        aiToolsData.claudeCode.monthlyTrend.forEach(m => {
                          m.byDept.forEach(d => {
                            if (d.department !== 'Unknown') {
                              deptLineTotals.set(d.department, (deptLineTotals.get(d.department) || 0) + d.lines);
                            }
                          });
                        });

                        const topDepts = Array.from(deptLineTotals.entries())
                          .sort((a, b) => b[1] - a[1])
                          .slice(0, 5)
                          .map(([dept]) => dept);

                        // Create monthly data points with line counts for each top department
                        return aiToolsData.claudeCode.monthlyTrend.map(m => {
                          const dataPoint = {
                            month: m.month,
                            monthLabel: m.monthLabel
                          };
                          topDepts.forEach(dept => {
                            const deptData = m.byDept.find(d => d.department === dept);
                            dataPoint[dept] = deptData?.lines || 0;
                          });
                          return dataPoint;
                        });
                      })()}>
                        <defs>
                          <linearGradient id="colorClaudeCodeDept1" x1="0" y1="0" x2="0" y2="1">
                            <stop offset="5%" stopColor="#8b5cf6" stopOpacity={0.8}/>
                            <stop offset="95%" stopColor="#8b5cf6" stopOpacity={0}/>
                          </linearGradient>
                          <linearGradient id="colorClaudeCodeDept2" x1="0" y1="0" x2="0" y2="1">
                            <stop offset="5%" stopColor="#14b8a6" stopOpacity={0.8}/>
                            <stop offset="95%" stopColor="#14b8a6" stopOpacity={0}/>
                          </linearGradient>
                          <linearGradient id="colorClaudeCodeDept3" x1="0" y1="0" x2="0" y2="1">
                            <stop offset="5%" stopColor="#f59e0b" stopOpacity={0.8}/>
                            <stop offset="95%" stopColor="#f59e0b" stopOpacity={0}/>
                          </linearGradient>
                          <linearGradient id="colorClaudeCodeDept4" x1="0" y1="0" x2="0" y2="1">
                            <stop offset="5%" stopColor="#ef4444" stopOpacity={0.8}/>
                            <stop offset="95%" stopColor="#ef4444" stopOpacity={0}/>
                          </linearGradient>
                          <linearGradient id="colorClaudeCodeDept5" x1="0" y1="0" x2="0" y2="1">
                            <stop offset="5%" stopColor="#06b6d4" stopOpacity={0.8}/>
                            <stop offset="95%" stopColor="#06b6d4" stopOpacity={0}/>
                          </linearGradient>
                        </defs>
                        <CartesianGrid strokeDasharray="3 3" />
                        <XAxis dataKey="monthLabel" />
                        <YAxis label={{ value: 'Lines of Code', angle: -90, position: 'insideLeft' }} />
                        <Tooltip formatter={(value) => value.toLocaleString()} />
                        <Legend />
                        {(() => {
                          // Calculate top 5 departments again for rendering
                          const deptLineTotals = new Map();
                          aiToolsData.claudeCode.monthlyTrend.forEach(m => {
                            m.byDept.forEach(d => {
                              if (d.department !== 'Unknown') {
                                deptLineTotals.set(d.department, (deptLineTotals.get(d.department) || 0) + d.lines);
                              }
                            });
                          });

                          const topDepts = Array.from(deptLineTotals.entries())
                            .sort((a, b) => b[1] - a[1])
                            .slice(0, 5)
                            .map(([dept]) => dept);

                          const colors = ['#8b5cf6', '#14b8a6', '#f59e0b', '#ef4444', '#06b6d4'];
                          const gradients = ['colorClaudeCodeDept1', 'colorClaudeCodeDept2', 'colorClaudeCodeDept3', 'colorClaudeCodeDept4', 'colorClaudeCodeDept5'];

                          return topDepts.map((dept, i) => (
                            <Area key={dept} type="monotone" dataKey={dept} name={dept} stroke={colors[i]} fillOpacity={1} fill={'url(#' + gradients[i] + ')'} />
                          ));
                        })()}
                      </AreaChart>
                    </ResponsiveContainer>
                  </div>
                  <div className="mt-4 p-4 bg-purple-50 border border-purple-200 rounded-lg">
                    <p className="text-sm text-purple-800">
                      <strong>Department Code Generation Insight:</strong> AI & Data departments dominate Claude Code usage, generating over 126,000 lines of code in November 2025 alone. This concentrated adoption among technical teams demonstrates Claude Code's value for complex development work. The significant productivity (25,000+ lines per user) suggests these teams are using Claude Code for substantial feature development rather than simple code completion. Engineering teams show steady growth, indicating successful adoption beyond the early-adopter AI/Data teams.
                    </p>
                  </div>
                </div>
              </div>
            )}
            {/* Productivity Tools Comparison Tab */}
            {activeTab === 'productivity-tools' && (
              <div className="space-y-6">
                <div>
                  <h3 className="text-2xl font-bold text-gray-900 mb-2">Productivity Tools Comparison</h3>
                  <p className="text-gray-600">Microsoft 365 Copilot vs Claude Enterprise adoption and engagement analysis</p>
                </div>

                {/* Key Metrics Comparison */}
                <div className="grid grid-cols-1 md:grid-cols-4 gap-6">
                  <MetricCard
                    title="M365 Copilot Active Users % (MTD)"
                    value={(() => {
                      const latestMonth = aiToolsData.m365Copilot.monthlyTrend[aiToolsData.m365Copilot.monthlyTrend.length - 1];
                      const mtdUsers = latestMonth.users;
                      return `${Math.round((mtdUsers / aiToolsData.m365Copilot.licensedUsers) * 100)}%`;
                    })()}
                    icon={Users}
                    color="blue"
                    changeLabel={(() => {
                      const latestMonth = aiToolsData.m365Copilot.monthlyTrend[aiToolsData.m365Copilot.monthlyTrend.length - 1];
                      return `${latestMonth.users} active users in ${latestMonth.monthLabel}`;
                    })()}
                  />
                  <MetricCard
                    title="Claude Enterprise Active Users % (MTD)"
                    value={(() => {
                      const latestMonth = aiToolsData.claudeEnterprise.monthlyTrend[aiToolsData.claudeEnterprise.monthlyTrend.length - 1];
                      const mtdUsers = latestMonth.users;
                      return `${Math.round((mtdUsers / aiToolsData.claudeEnterprise.licensedUsers) * 100)}%`;
                    })()}
                    icon={Users}
                    color="purple"
                    changeLabel={(() => {
                      const latestMonth = aiToolsData.claudeEnterprise.monthlyTrend[aiToolsData.claudeEnterprise.monthlyTrend.length - 1];
                      return `${latestMonth.users} active users in ${latestMonth.monthLabel}`;
                    })()}
                  />
                  <MetricCard
                    title="M365 Prompts/User (MTD Average)"
                    value={(() => {
                      const latestMonth = aiToolsData.m365Copilot.monthlyTrend[aiToolsData.m365Copilot.monthlyTrend.length - 1];
                      return latestMonth.promptsPerUser;
                    })()}
                    icon={MessageSquare}
                    color="indigo"
                    changeLabel={(() => {
                      const latestMonth = aiToolsData.m365Copilot.monthlyTrend[aiToolsData.m365Copilot.monthlyTrend.length - 1];
                      return `${latestMonth.monthLabel} ${latestMonth.isPartial ? '(partial)' : ''}`;
                    })()}
                  />
                  <MetricCard
                    title="Claude Prompts/User (MTD Average)"
                    value={(() => {
                      const latestMonth = aiToolsData.claudeEnterprise.monthlyTrend[aiToolsData.claudeEnterprise.monthlyTrend.length - 1];
                      return latestMonth.messagesPerUser;
                    })()}
                    icon={MessageSquare}
                    color="purple"
                    changeLabel={(() => {
                      const latestMonth = aiToolsData.claudeEnterprise.monthlyTrend[aiToolsData.claudeEnterprise.monthlyTrend.length - 1];
                      return latestMonth.monthLabel;
                    })()}
                  />
                </div>

                {/* Artifacts Comparison */}
                <div className="bg-gradient-to-br from-purple-50 to-blue-50 rounded-lg shadow-md border border-purple-100 p-6">
                  <h4 className="text-lg font-semibold text-gray-900 mb-4">Content Creation: Artifacts Generated ({latestMonthLabel} MTD)</h4>
                  <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div className="bg-white rounded-lg p-6 border border-gray-200">
                      <div className="flex items-center justify-between mb-3">
                        <div>
                          <p className="text-sm font-medium text-gray-600">Claude Enterprise</p>
                          <p className="text-xs text-gray-500">Actual artifacts generated ({latestMonthLabel} MTD)</p>
                        </div>
                        <div className="text-3xl">üìÑ</div>
                      </div>
                      <p className="text-4xl font-bold text-purple-600">{(() => {
                        const latestMonth = aiToolsData.claudeEnterprise.monthlyTrend[aiToolsData.claudeEnterprise.monthlyTrend.length - 1];
                        return latestMonth.artifacts.toLocaleString();
                      })()}</p>
                      <p className="text-sm text-gray-600 mt-2">
                        Artifacts created by AI (code, documents, etc.)
                      </p>
                    </div>
                    <div className="bg-white rounded-lg p-6 border border-gray-200">
                      <div className="flex items-center justify-between mb-3">
                        <div>
                          <p className="text-sm font-medium text-gray-600">M365 Copilot</p>
                          <p className="text-xs text-gray-500">Approximate content creation ({latestMonthLabel} MTD)</p>
                        </div>
                        <div className="text-3xl">üìä</div>
                      </div>
                      <p className="text-4xl font-bold text-blue-600">{aiToolsData.m365Copilot.approximateArtifacts.toLocaleString()}</p>
                      <p className="text-sm text-gray-600 mt-2">
                        20% conversion √ó {aiToolsData.m365Copilot.wordExcelPowerpointAdoptionFactor}% W/E/P adoption (excludes Chat/Teams/Outlook)
                      </p>
                    </div>
                  </div>
                  <div className="mt-4 p-4 bg-amber-50 border border-amber-200 rounded-lg">
                    <p className="text-sm text-amber-800">
                      <strong>Methodology:</strong> {aiToolsData.m365Copilot.artifactsNote} Uses Word/Excel/PowerPoint adoption rates to filter out Teams and Outlook communication prompts.
                    </p>
                  </div>
                </div>

                {/* Total Messages/Prompts Over Time */}
                <div className="bg-white rounded-lg shadow-md border border-gray-100 p-6">
                  <h4 className="text-lg font-semibold text-gray-900 mb-4">Total Messages/Prompts Over Time</h4>
                  <div className="h-80">
                    <ResponsiveContainer width="100%" height="100%">
                      <AreaChart data={(() => {
                        // Merge Claude Enterprise and M365 monthly data
                        const dataMap = new Map();

                        // Add M365 monthly data
                        aiToolsData.m365Copilot.monthlyTrend.forEach(m => {
                          dataMap.set(m.month, {
                            month: m.month,
                            monthLabel: m.monthLabel,
                            m365Prompts: m.totalPrompts,
                            claudeMessages: null
                          });
                        });

                        // Add/merge Claude Enterprise monthly data
                        aiToolsData.claudeEnterprise.monthlyTrend.forEach(m => {
                          if (dataMap.has(m.month)) {
                            dataMap.get(m.month).claudeMessages = m.messages;
                          } else {
                            dataMap.set(m.month, {
                              month: m.month,
                              monthLabel: m.monthLabel,
                              m365Prompts: null,
                              claudeMessages: m.messages
                            });
                          }
                        });

                        return Array.from(dataMap.values()).sort((a, b) => a.month.localeCompare(b.month));
                      })()}>
                        <defs>
                          <linearGradient id="colorClaudeMessages" x1="0" y1="0" x2="0" y2="1">
                            <stop offset="5%" stopColor="#8b5cf6" stopOpacity={0.8}/>
                            <stop offset="95%" stopColor="#8b5cf6" stopOpacity={0}/>
                          </linearGradient>
                          <linearGradient id="colorM365Prompts" x1="0" y1="0" x2="0" y2="1">
                            <stop offset="5%" stopColor="#3b82f6" stopOpacity={0.8}/>
                            <stop offset="95%" stopColor="#3b82f6" stopOpacity={0}/>
                          </linearGradient>
                        </defs>
                        <CartesianGrid strokeDasharray="3 3" />
                        <XAxis dataKey="monthLabel" />
                        <YAxis label={{ value: 'Messages/Prompts', angle: -90, position: 'insideLeft' }} />
                        <Tooltip formatter={(value) => value ? value.toLocaleString() : 'N/A'} />
                        <Legend />
                        <Area
                          type="monotone"
                          dataKey="claudeMessages"
                          stroke="#8b5cf6"
                          fillOpacity={1}
                          fill="url(#colorClaudeMessages)"
                          name="Claude Enterprise"
                          connectNulls={true}
                        />
                        <Area
                          type="monotone"
                          dataKey="m365Prompts"
                          stroke="#3b82f6"
                          fillOpacity={1}
                          fill="url(#colorM365Prompts)"
                          name="M365 Copilot"
                          connectNulls={true}
                        />
                      </AreaChart>
                    </ResponsiveContainer>
                  </div>
                  <div className="mt-4 p-4 bg-purple-50 border border-purple-200 rounded-lg">
                    <p className="text-sm text-purple-800">
                      <strong>Key Insight:</strong> {aiToolsData.insights?.strategicPositioning || `Monitor the total engagement volume across both productivity tools to identify usage patterns and strategic positioning opportunities.`}
                    </p>
                  </div>
                </div>

                {/* Adoption Trend (Active Users) */}
                <div className="bg-white rounded-lg shadow-md border border-gray-100 p-6">
                  <h4 className="text-lg font-semibold text-gray-900 mb-4">Adoption Trend: Active Users Over Time</h4>
                  <div className="h-80">
                    <ResponsiveContainer width="100%" height="100%">
                      <AreaChart data={(() => {
                        // Merge M365 and Claude data by month to avoid duplicate labels
                        const mergedData = new Map();

                        // Add M365 data
                        aiToolsData.m365Copilot.monthlyTrend.forEach(m => {
                          mergedData.set(m.month, {
                            month: m.month,
                            monthLabel: m.monthLabel,
                            m365Users: m.users,
                            claudeUsers: null
                          });
                        });

                        // Add/merge Claude data
                        aiToolsData.claudeEnterprise.monthlyTrend.forEach(m => {
                          if (mergedData.has(m.month)) {
                            mergedData.get(m.month).claudeUsers = m.users;
                          } else {
                            mergedData.set(m.month, {
                              month: m.month,
                              monthLabel: m.monthLabel,
                              m365Users: null,
                              claudeUsers: m.users
                            });
                          }
                        });

                        // Convert to array and sort by month
                        return Array.from(mergedData.values()).sort((a, b) => a.month.localeCompare(b.month));
                      })()}>
                        <defs>
                          <linearGradient id="colorM365Users" x1="0" y1="0" x2="0" y2="1">
                            <stop offset="5%" stopColor="#3b82f6" stopOpacity={0.8}/>
                            <stop offset="95%" stopColor="#3b82f6" stopOpacity={0}/>
                          </linearGradient>
                          <linearGradient id="colorClaudeUsers" x1="0" y1="0" x2="0" y2="1">
                            <stop offset="5%" stopColor="#8b5cf6" stopOpacity={0.8}/>
                            <stop offset="95%" stopColor="#8b5cf6" stopOpacity={0}/>
                          </linearGradient>
                        </defs>
                        <CartesianGrid strokeDasharray="3 3" />
                        <XAxis dataKey="monthLabel" />
                        <YAxis label={{ value: 'Active Users', angle: -90, position: 'insideLeft' }} />
                        <Tooltip formatter={(value) => value ? value.toLocaleString() : 'N/A'} />
                        <Legend />
                        <Area type="monotone" dataKey="m365Users" name="M365 Copilot" stroke="#3b82f6" fillOpacity={1} fill="url(#colorM365Users)" connectNulls />
                        <Area type="monotone" dataKey="claudeUsers" name="Claude Enterprise" stroke="#8b5cf6" fillOpacity={1} fill="url(#colorClaudeUsers)" connectNulls />
                      </AreaChart>
                    </ResponsiveContainer>
                  </div>
                  <div className="mt-4 p-4 bg-blue-50 border border-blue-200 rounded-lg">
                    <p className="text-sm text-blue-800">
                      <strong>Adoption Insight:</strong> {aiToolsData.insights?.adoptionTrend || `M365 Copilot has broader organizational reach (${aiToolsData.m365Copilot.activeUsers} active users with org-wide access), while Claude Enterprise has focused adoption (${aiToolsData.claudeEnterprise.activeUsers} licensed users).`}
                    </p>
                  </div>
                </div>

                {/* Engagement Trend (Prompts/Messages) */}
                <div className="bg-white rounded-lg shadow-md border border-gray-100 p-6">
                  <h4 className="text-lg font-semibold text-gray-900 mb-4">Engagement Trend: Prompts/Messages Per User Over Time</h4>
                  <div className="h-80">
                    <ResponsiveContainer width="100%" height="100%">
                      <AreaChart data={(() => {
                        // Merge M365 and Claude data by month to avoid duplicate labels
                        const mergedData = new Map();

                        // Add M365 data
                        aiToolsData.m365Copilot.monthlyTrend.forEach(m => {
                          mergedData.set(m.month, {
                            period: m.month,
                            periodLabel: m.monthLabel,
                            m365PromptsPerUser: m.promptsPerUser,
                            claudeMessagesPerUser: null
                          });
                        });

                        // Add/merge Claude data
                        aiToolsData.claudeEnterprise.monthlyTrend.forEach(m => {
                          if (mergedData.has(m.month)) {
                            mergedData.get(m.month).claudeMessagesPerUser = m.messagesPerUser;
                          } else {
                            mergedData.set(m.month, {
                              period: m.month,
                              periodLabel: m.monthLabel,
                              m365PromptsPerUser: null,
                              claudeMessagesPerUser: m.messagesPerUser
                            });
                          }
                        });

                        // Convert to array and sort by month
                        return Array.from(mergedData.values()).sort((a, b) => a.period.localeCompare(b.period));
                      })()}>
                        <defs>
                          <linearGradient id="colorM365PromptsPerUser" x1="0" y1="0" x2="0" y2="1">
                            <stop offset="5%" stopColor="#3b82f6" stopOpacity={0.8}/>
                            <stop offset="95%" stopColor="#3b82f6" stopOpacity={0}/>
                          </linearGradient>
                          <linearGradient id="colorClaudeMessagesPerUser" x1="0" y1="0" x2="0" y2="1">
                            <stop offset="5%" stopColor="#8b5cf6" stopOpacity={0.8}/>
                            <stop offset="95%" stopColor="#8b5cf6" stopOpacity={0}/>
                          </linearGradient>
                        </defs>
                        <CartesianGrid strokeDasharray="3 3" />
                        <XAxis dataKey="periodLabel" />
                        <YAxis label={{ value: 'Messages/Prompts per User', angle: -90, position: 'insideLeft' }} />
                        <Tooltip formatter={(value) => value ? value.toLocaleString() : 'N/A'} />
                        <Legend />
                        <Area type="monotone" dataKey="m365PromptsPerUser" name="M365 Prompts/User" stroke="#3b82f6" fillOpacity={1} fill="url(#colorM365PromptsPerUser)" connectNulls />
                        <Area type="monotone" dataKey="claudeMessagesPerUser" name="Claude Messages/User" stroke="#8b5cf6" fillOpacity={1} fill="url(#colorClaudeMessagesPerUser)" connectNulls />
                      </AreaChart>
                    </ResponsiveContainer>
                  </div>
                  <div className="mt-4 p-4 bg-purple-50 border border-purple-200 rounded-lg">
                    <p className="text-sm text-purple-800">
                      <strong>Engagement Insight:</strong> {aiToolsData.insights?.engagementTrend || `M365 Copilot shows lighter engagement (${aiToolsData.m365Copilot.promptsPerUser} prompts/user avg), while Claude Enterprise demonstrates deeper engagement (${aiToolsData.claudeEnterprise.messagesPerUser} messages/user avg).`}
                    </p>
                  </div>
                </div>

                {/* M365 Copilot App Usage */}
                <div className="bg-white rounded-lg shadow-md border border-gray-100 p-6">
                  <h4 className="text-lg font-semibold text-gray-900 mb-4">M365 Copilot: Application Usage</h4>
                  <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div className="h-80">
                      <ResponsiveContainer width="100%" height="100%">
                        <BarChart data={aiToolsData.m365Copilot.appUsage} layout="vertical">
                          <CartesianGrid strokeDasharray="3 3" />
                          <XAxis type="number" />
                          <YAxis dataKey="app" type="category" width={120} />
                          <Tooltip />
                          <Bar dataKey="users" fill="#3b82f6" />
                        </BarChart>
                      </ResponsiveContainer>
                    </div>
                    <div className="space-y-3">
                      {aiToolsData.m365Copilot.appUsage.map((app, index) => (
                        <div key={index} className="flex items-center justify-between p-3 bg-gray-50 rounded-lg">
                          <span className="font-medium text-gray-900">{app.app}</span>
                          <div className="text-right">
                            <div className="text-lg font-bold text-gray-900">{app.users}</div>
                            <div className="text-xs text-gray-500">{Math.round((app.users / aiToolsData.m365Copilot.activeUsers) * 100)}% of active users</div>
                          </div>
                        </div>
                      ))}
                    </div>
                  </div>
                  <div className="mt-4 p-4 bg-indigo-50 border border-indigo-200 rounded-lg">
                    <p className="text-sm text-indigo-800">
                      <strong>Key Insight:</strong> {aiToolsData.insights?.m365AppTrend || `M365 Copilot usage is concentrated in communication tools (Teams: ${aiToolsData.m365Copilot.appUsage[0].users} users, Copilot Chat: ${aiToolsData.m365Copilot.appUsage[1].users} users, Outlook: ${aiToolsData.m365Copilot.appUsage[2].users} users) with lighter adoption in document productivity apps.`}
                    </p>
                  </div>
                </div>

                {/* M365 App Usage Trends Over Time */}
                <div className="bg-white rounded-lg shadow-md border border-gray-100 p-6">
                  <h4 className="text-lg font-semibold text-gray-900 mb-4">M365 Copilot: App Usage Trends Over Time</h4>
                  <div className="h-80">
                    <ResponsiveContainer width="100%" height="100%">
                      <AreaChart data={aiToolsData.m365Copilot.monthlyTrend.map(m => {
                        const appData = {};
                        m.appUsage.forEach(app => {
                          appData[app.app] = app.users;
                        });
                        return {
                          month: m.monthLabel,
                          ...appData
                        };
                      })}>
                        <defs>
                          <linearGradient id="colorTeams" x1="0" y1="0" x2="0" y2="1">
                            <stop offset="5%" stopColor="#2563eb" stopOpacity={0.8}/>
                            <stop offset="95%" stopColor="#2563eb" stopOpacity={0}/>
                          </linearGradient>
                          <linearGradient id="colorCopilotChat" x1="0" y1="0" x2="0" y2="1">
                            <stop offset="5%" stopColor="#7c3aed" stopOpacity={0.8}/>
                            <stop offset="95%" stopColor="#7c3aed" stopOpacity={0}/>
                          </linearGradient>
                          <linearGradient id="colorOutlook" x1="0" y1="0" x2="0" y2="1">
                            <stop offset="5%" stopColor="#059669" stopOpacity={0.8}/>
                            <stop offset="95%" stopColor="#059669" stopOpacity={0}/>
                          </linearGradient>
                          <linearGradient id="colorWord" x1="0" y1="0" x2="0" y2="1">
                            <stop offset="5%" stopColor="#dc2626" stopOpacity={0.8}/>
                            <stop offset="95%" stopColor="#dc2626" stopOpacity={0}/>
                          </linearGradient>
                          <linearGradient id="colorExcel" x1="0" y1="0" x2="0" y2="1">
                            <stop offset="5%" stopColor="#ea580c" stopOpacity={0.8}/>
                            <stop offset="95%" stopColor="#ea580c" stopOpacity={0}/>
                          </linearGradient>
                          <linearGradient id="colorPowerPoint" x1="0" y1="0" x2="0" y2="1">
                            <stop offset="5%" stopColor="#ca8a04" stopOpacity={0.8}/>
                            <stop offset="95%" stopColor="#ca8a04" stopOpacity={0}/>
                          </linearGradient>
                        </defs>
                        <CartesianGrid strokeDasharray="3 3" />
                        <XAxis dataKey="month" />
                        <YAxis label={{ value: 'Active Users', angle: -90, position: 'insideLeft' }} />
                        <Tooltip />
                        <Legend />
                        <Area type="monotone" dataKey="Teams" stroke="#2563eb" fillOpacity={1} fill="url(#colorTeams)" />
                        <Area type="monotone" dataKey="Copilot Chat" stroke="#7c3aed" fillOpacity={1} fill="url(#colorCopilotChat)" />
                        <Area type="monotone" dataKey="Outlook" stroke="#059669" fillOpacity={1} fill="url(#colorOutlook)" />
                        <Area type="monotone" dataKey="Word" stroke="#dc2626" fillOpacity={1} fill="url(#colorWord)" />
                        <Area type="monotone" dataKey="Excel" stroke="#ea580c" fillOpacity={1} fill="url(#colorExcel)" />
                        <Area type="monotone" dataKey="PowerPoint" stroke="#ca8a04" fillOpacity={1} fill="url(#colorPowerPoint)" />
                      </AreaChart>
                    </ResponsiveContainer>
                  </div>
                  <div className="mt-4 p-4 bg-green-50 border border-green-200 rounded-lg">
                    <p className="text-sm text-green-800">
                      <strong>Trend Analysis:</strong> {aiToolsData.insights?.m365AppTrend || `Track which M365 Copilot applications are gaining or losing adoption over time. Communication tools (Teams, Outlook, Copilot Chat) tend to show higher and more stable usage compared to document productivity apps.`}
                    </p>
                  </div>
                </div>

                {/* M365 App Usage by Department - Latest Month Snapshot */}
                <div className="bg-white rounded-lg shadow-md border border-gray-100 p-6">
                  <h4 className="text-lg font-semibold text-gray-900 mb-4">M365 Copilot: App Usage by Department (Latest Month)</h4>
                  <div className="h-96">
                    <ResponsiveContainer width="100%" height="100%">
                      <BarChart data={(() => {
                        // Get latest month data
                        const latestMonth = aiToolsData.m365Copilot.monthlyTrend[aiToolsData.m365Copilot.monthlyTrend.length - 1];

                        // Get top 5 departments by total prompts
                        const deptTotals = new Map();
                        aiToolsData.m365Copilot.monthlyTrend.forEach(m => {
                          m.byDept.forEach(d => {
                            if (d.department !== 'Unknown') {
                              deptTotals.set(d.department, (deptTotals.get(d.department) || 0) + d.prompts);
                            }
                          });
                        });

                        const topDepts = Array.from(deptTotals.entries())
                          .sort((a, b) => b[1] - a[1])
                          .slice(0, 5)
                          .map(([dept]) => dept);

                        // Create data structure: one object per app with department values
                        const apps = ['Copilot Chat', 'Teams', 'Outlook', 'Excel', 'Word', 'PowerPoint'];
                        return apps.map(app => {
                          const dataPoint = { app };
                          topDepts.forEach(dept => {
                            const deptData = latestMonth.appUsageByDept.find(d => d.department === dept);
                            const appData = deptData?.apps.find(a => a.app === app);
                            dataPoint[dept] = appData?.users || 0;
                          });
                          return dataPoint;
                        });
                      })()}>
                        <CartesianGrid strokeDasharray="3 3" />
                        <XAxis dataKey="app" angle={-15} textAnchor="end" height={80} />
                        <YAxis label={{ value: 'Active Users', angle: -90, position: 'insideLeft' }} />
                        <Tooltip />
                        <Legend />
                        {(() => {
                          // Get top 5 departments
                          const deptTotals = new Map();
                          aiToolsData.m365Copilot.monthlyTrend.forEach(m => {
                            m.byDept.forEach(d => {
                              if (d.department !== 'Unknown') {
                                deptTotals.set(d.department, (deptTotals.get(d.department) || 0) + d.prompts);
                              }
                            });
                          });

                          const topDepts = Array.from(deptTotals.entries())
                            .sort((a, b) => b[1] - a[1])
                            .slice(0, 5)
                            .map(([dept]) => dept);

                          const colors = ['#3b82f6', '#10b981', '#f59e0b', '#ef4444', '#8b5cf6'];

                          return topDepts.map((dept, i) => (
                            <Bar key={dept} dataKey={dept} name={dept} fill={colors[i]} />
                          ));
                        })()}
                      </BarChart>
                    </ResponsiveContainer>
                  </div>
                  <div className="mt-4 p-4 bg-blue-50 border border-blue-200 rounded-lg">
                    <p className="text-sm text-blue-800">
                      <strong>App Usage Insight:</strong> Copilot Chat and Teams dominate M365 Copilot usage across departments, with Customer Support and Marketing showing the highest adoption. Communication-focused apps (Teams, Outlook) see broader usage than productivity apps (Word, Excel, PowerPoint).
                    </p>
                  </div>
                </div>

                {/* M365 App Usage Trend Over Time */}
                <div className="bg-white rounded-lg shadow-md border border-gray-100 p-6">
                  <h4 className="text-lg font-semibold text-gray-900 mb-4">M365 Copilot: App Adoption Trend (Top 4 Apps)</h4>
                  <div className="h-80">
                    <ResponsiveContainer width="100%" height="100%">
                      <AreaChart data={(() => {
                        // Get monthly totals for top 4 apps across all departments
                        return aiToolsData.m365Copilot.monthlyTrend
                          .filter(m => m.month >= '2025-09') // Only Sept onwards
                          .map(m => {
                            const dataPoint = {
                              month: m.month,
                              monthLabel: m.monthLabel
                            };

                            // Aggregate users across all departments for each app
                            const appTotals = {
                              'Copilot Chat': 0,
                              'Teams': 0,
                              'Outlook': 0,
                              'Excel': 0
                            };

                            m.appUsageByDept.forEach(dept => {
                              dept.apps.forEach(app => {
                                if (appTotals.hasOwnProperty(app.app)) {
                                  appTotals[app.app] += app.users;
                                }
                              });
                            });

                            Object.entries(appTotals).forEach(([app, users]) => {
                              dataPoint[app] = users;
                            });

                            return dataPoint;
                          });
                      })()}>
                        <defs>
                          <linearGradient id="colorCopilotChat" x1="0" y1="0" x2="0" y2="1">
                            <stop offset="5%" stopColor="#3b82f6" stopOpacity={0.8}/>
                            <stop offset="95%" stopColor="#3b82f6" stopOpacity={0}/>
                          </linearGradient>
                          <linearGradient id="colorTeams" x1="0" y1="0" x2="0" y2="1">
                            <stop offset="5%" stopColor="#10b981" stopOpacity={0.8}/>
                            <stop offset="95%" stopColor="#10b981" stopOpacity={0}/>
                          </linearGradient>
                          <linearGradient id="colorOutlook" x1="0" y1="0" x2="0" y2="1">
                            <stop offset="5%" stopColor="#f59e0b" stopOpacity={0.8}/>
                            <stop offset="95%" stopColor="#f59e0b" stopOpacity={0}/>
                          </linearGradient>
                          <linearGradient id="colorExcel" x1="0" y1="0" x2="0" y2="1">
                            <stop offset="5%" stopColor="#ef4444" stopOpacity={0.8}/>
                            <stop offset="95%" stopColor="#ef4444" stopOpacity={0}/>
                          </linearGradient>
                        </defs>
                        <CartesianGrid strokeDasharray="3 3" />
                        <XAxis dataKey="monthLabel" />
                        <YAxis label={{ value: 'Active Users', angle: -90, position: 'insideLeft' }} />
                        <Tooltip />
                        <Legend />
                        <Area type="monotone" dataKey="Copilot Chat" name="Copilot Chat" stroke="#3b82f6" fillOpacity={1} fill="url(#colorCopilotChat)" />
                        <Area type="monotone" dataKey="Teams" name="Teams" stroke="#10b981" fillOpacity={1} fill="url(#colorTeams)" />
                        <Area type="monotone" dataKey="Outlook" name="Outlook" stroke="#f59e0b" fillOpacity={1} fill="url(#colorOutlook)" />
                        <Area type="monotone" dataKey="Excel" name="Excel" stroke="#ef4444" fillOpacity={1} fill="url(#colorExcel)" />
                      </AreaChart>
                    </ResponsiveContainer>
                  </div>
                  <div className="mt-4 p-4 bg-green-50 border border-green-200 rounded-lg">
                    <p className="text-sm text-green-800">
                      <strong>Adoption Trend Insight:</strong> M365 Copilot adoption has grown significantly from September to December 2025. Copilot Chat and Teams show the steepest growth curves, indicating strong preference for conversational AI and real-time collaboration features. Excel adoption is growing steadily, suggesting increasing use for data analysis tasks.
                    </p>
                  </div>
                </div>

                {/* Claude Enterprise Features */}
                <div className="bg-white rounded-lg shadow-md border border-gray-100 p-6">
                  <h4 className="text-lg font-semibold text-gray-900 mb-4">Claude Enterprise: Feature Usage</h4>
                  <div className="grid grid-cols-1 md:grid-cols-3 gap-6">
                    <div className="p-4 bg-purple-50 rounded-lg">
                      <div className="flex items-center justify-between mb-2">
                        <MessageSquare className="h-8 w-8 text-purple-600" />
                        <span className="text-3xl font-bold text-purple-900">{aiToolsData.claudeEnterprise.totalConversations.toLocaleString()}</span>
                      </div>
                      <h5 className="font-semibold text-purple-900">Conversations</h5>
                      <p className="text-sm text-purple-700 mt-1">{aiToolsData.claudeEnterprise.conversationsPerUser} per user avg</p>
                    </div>
                    <div className="p-4 bg-indigo-50 rounded-lg">
                      <div className="flex items-center justify-between mb-2">
                        <Target className="h-8 w-8 text-indigo-600" />
                        <span className="text-3xl font-bold text-indigo-900">{aiToolsData.claudeEnterprise.totalProjects.toLocaleString()}</span>
                      </div>
                      <h5 className="font-semibold text-indigo-900">Projects</h5>
                      <p className="text-sm text-indigo-700 mt-1">Organized knowledge bases</p>
                    </div>
                    <div className="p-4 bg-blue-50 rounded-lg">
                      <div className="flex items-center justify-between mb-2">
                        <Code className="h-8 w-8 text-blue-600" />
                        <span className="text-3xl font-bold text-blue-900">{aiToolsData.claudeEnterprise.totalArtifacts.toLocaleString()}</span>
                      </div>
                      <h5 className="font-semibold text-blue-900">Artifacts/Documents</h5>
                      <p className="text-sm text-blue-700 mt-1">Generated content & code</p>
                    </div>
                  </div>
                  <div className="mt-4 p-4 bg-purple-50 border border-purple-200 rounded-lg">
                    <p className="text-sm text-purple-800">
                      <strong>Key Insight:</strong> {aiToolsData.insights?.claudeEnterpriseFeatures || `Claude Enterprise users leverage advanced features like Projects (${aiToolsData.claudeEnterprise.totalProjects}) and Artifacts (${aiToolsData.claudeEnterprise.totalArtifacts}) for complex, structured work beyond simple prompts.`}
                    </p>
                  </div>
                </div>

                {/* Claude Enterprise Active Users by Department Over Time */}
                <div className="bg-white rounded-lg shadow-md border border-gray-100 p-6">
                  <h4 className="text-lg font-semibold text-gray-900 mb-4">Claude Enterprise: Active Users by Department Over Time</h4>
                  <div className="h-80">
                    <ResponsiveContainer width="100%" height="100%">
                      <AreaChart data={(() => {
                        // Get top 5 departments for Claude Enterprise by total users across all months
                        const deptUserTotals = new Map();
                        aiToolsData.claudeEnterprise.monthlyTrend.forEach(m => {
                          m.byDept.forEach(d => {
                            if (d.department !== 'Unknown') {
                              deptUserTotals.set(d.department, (deptUserTotals.get(d.department) || 0) + d.users);
                            }
                          });
                        });

                        const topDepts = Array.from(deptUserTotals.entries())
                          .sort((a, b) => b[1] - a[1])
                          .slice(0, 5)
                          .map(([dept]) => dept);

                        // Create monthly data points with user counts for each top department
                        return aiToolsData.claudeEnterprise.monthlyTrend.map(m => {
                          const dataPoint = {
                            month: m.month,
                            monthLabel: m.monthLabel
                          };
                          topDepts.forEach(dept => {
                            const deptData = m.byDept.find(d => d.department === dept);
                            dataPoint[dept] = deptData?.users || 0;
                          });
                          return dataPoint;
                        });
                      })()}>
                        <defs>
                          <linearGradient id="colorClaudeUsersDept1" x1="0" y1="0" x2="0" y2="1">
                            <stop offset="5%" stopColor="#8b5cf6" stopOpacity={0.8}/>
                            <stop offset="95%" stopColor="#8b5cf6" stopOpacity={0}/>
                          </linearGradient>
                          <linearGradient id="colorClaudeUsersDept2" x1="0" y1="0" x2="0" y2="1">
                            <stop offset="5%" stopColor="#14b8a6" stopOpacity={0.8}/>
                            <stop offset="95%" stopColor="#14b8a6" stopOpacity={0}/>
                          </linearGradient>
                          <linearGradient id="colorClaudeUsersDept3" x1="0" y1="0" x2="0" y2="1">
                            <stop offset="5%" stopColor="#f97316" stopOpacity={0.8}/>
                            <stop offset="95%" stopColor="#f97316" stopOpacity={0}/>
                          </linearGradient>
                          <linearGradient id="colorClaudeUsersDept4" x1="0" y1="0" x2="0" y2="1">
                            <stop offset="5%" stopColor="#dc2626" stopOpacity={0.8}/>
                            <stop offset="95%" stopColor="#dc2626" stopOpacity={0}/>
                          </linearGradient>
                          <linearGradient id="colorClaudeUsersDept5" x1="0" y1="0" x2="0" y2="1">
                            <stop offset="5%" stopColor="#7c3aed" stopOpacity={0.8}/>
                            <stop offset="95%" stopColor="#7c3aed" stopOpacity={0}/>
                          </linearGradient>
                        </defs>
                        <CartesianGrid strokeDasharray="3 3" />
                        <XAxis dataKey="monthLabel" />
                        <YAxis label={{ value: 'Active Users', angle: -90, position: 'insideLeft' }} />
                        <Tooltip formatter={(value) => value.toLocaleString()} />
                        <Legend />
                        {(() => {
                          // Calculate top 5 departments again for rendering
                          const deptUserTotals = new Map();
                          aiToolsData.claudeEnterprise.monthlyTrend.forEach(m => {
                            m.byDept.forEach(d => {
                              if (d.department !== 'Unknown') {
                                deptUserTotals.set(d.department, (deptUserTotals.get(d.department) || 0) + d.users);
                              }
                            });
                          });

                          const topDepts = Array.from(deptUserTotals.entries())
                            .sort((a, b) => b[1] - a[1])
                            .slice(0, 5)
                            .map(([dept]) => dept);

                          const colors = ['#8b5cf6', '#14b8a6', '#f97316', '#dc2626', '#7c3aed'];
                          const gradients = ['colorClaudeUsersDept1', 'colorClaudeUsersDept2', 'colorClaudeUsersDept3', 'colorClaudeUsersDept4', 'colorClaudeUsersDept5'];

                          return topDepts.map((dept, i) => (
                            <Area key={dept} type="monotone" dataKey={dept} name={dept} stroke={colors[i]} fillOpacity={1} fill={'url(#' + gradients[i] + ')'} />
                          ));
                        })()}
                      </AreaChart>
                    </ResponsiveContainer>
                  </div>
                  <div className="mt-4 p-4 bg-purple-50 border border-purple-200 rounded-lg">
                    <p className="text-sm text-purple-800">
                      <strong>Active Users Insight:</strong> Claude Enterprise shows steady growth in active users across top departments from September to December 2025. Marketing and Product departments lead in user adoption, with consistent month-over-month increases. This growing user base indicates successful change management and demonstrates strong organic adoption compared to M365 Copilot's org-wide availability. The trend suggests departments are finding value in Claude Enterprise's advanced features for content creation and technical work.
                    </p>
                  </div>
                </div>

                {/* Department Usage Comparison (M365 vs Claude Enterprise) - Side by Side */}
                <div className="bg-white rounded-lg shadow-md border border-gray-100 p-6">
                  <h4 className="text-lg font-semibold text-gray-900 mb-4">Department Usage by AI Tool (Top 5 Departments)</h4>
                  <div className="grid grid-cols-1 lg:grid-cols-2 gap-6">
                    {/* M365 Copilot by Department */}
                    <div>
                      <h5 className="text-md font-semibold text-blue-900 mb-3">M365 Copilot - Prompts by Department</h5>
                      <div className="h-80">
                        <ResponsiveContainer width="100%" height="100%">
                          <AreaChart data={(() => {
                            // Get top 5 departments for M365 (excluding Unknown)
                            const deptTotals = new Map();
                            aiToolsData.m365Copilot.monthlyTrend.forEach(m => {
                              m.byDept.forEach(d => {
                                if (d.department !== 'Unknown') {
                                  deptTotals.set(d.department, (deptTotals.get(d.department) || 0) + d.prompts);
                                }
                              });
                            });

                            const topDepts = Array.from(deptTotals.entries())
                              .sort((a, b) => b[1] - a[1])
                              .slice(0, 5)
                              .map(([dept]) => dept);

                            // Filter to months with actual data (September onwards)
                            return aiToolsData.m365Copilot.monthlyTrend
                              .filter(m => m.month >= '2025-09')
                              .map(m => {
                                const dataPoint = {
                                  month: m.month,
                                  monthLabel: m.monthLabel
                                };
                                topDepts.forEach(dept => {
                                  const deptData = m.byDept.find(d => d.department === dept);
                                  dataPoint[dept] = deptData?.prompts || 0;
                                });
                                return dataPoint;
                              });
                          })()}>
                            <defs>
                              <linearGradient id="colorM365Dept1" x1="0" y1="0" x2="0" y2="1">
                                <stop offset="5%" stopColor="#3b82f6" stopOpacity={0.8}/>
                                <stop offset="95%" stopColor="#3b82f6" stopOpacity={0}/>
                              </linearGradient>
                              <linearGradient id="colorM365Dept2" x1="0" y1="0" x2="0" y2="1">
                                <stop offset="5%" stopColor="#10b981" stopOpacity={0.8}/>
                                <stop offset="95%" stopColor="#10b981" stopOpacity={0}/>
                              </linearGradient>
                              <linearGradient id="colorM365Dept3" x1="0" y1="0" x2="0" y2="1">
                                <stop offset="5%" stopColor="#f59e0b" stopOpacity={0.8}/>
                                <stop offset="95%" stopColor="#f59e0b" stopOpacity={0}/>
                              </linearGradient>
                              <linearGradient id="colorM365Dept4" x1="0" y1="0" x2="0" y2="1">
                                <stop offset="5%" stopColor="#ef4444" stopOpacity={0.8}/>
                                <stop offset="95%" stopColor="#ef4444" stopOpacity={0}/>
                              </linearGradient>
                              <linearGradient id="colorM365Dept5" x1="0" y1="0" x2="0" y2="1">
                                <stop offset="5%" stopColor="#8b5cf6" stopOpacity={0.8}/>
                                <stop offset="95%" stopColor="#8b5cf6" stopOpacity={0}/>
                              </linearGradient>
                            </defs>
                            <CartesianGrid strokeDasharray="3 3" />
                            <XAxis dataKey="monthLabel" />
                            <YAxis label={{ value: 'Prompts', angle: -90, position: 'insideLeft' }} />
                            <Tooltip formatter={(value) => value.toLocaleString()} />
                            <Legend />
                            {(() => {
                              const deptTotals = new Map();
                              aiToolsData.m365Copilot.monthlyTrend.forEach(m => {
                                m.byDept.forEach(d => {
                                  if (d.department !== 'Unknown') {
                                    deptTotals.set(d.department, (deptTotals.get(d.department) || 0) + d.prompts);
                                  }
                                });
                              });
                              const topDepts = Array.from(deptTotals.entries())
                                .sort((a, b) => b[1] - a[1])
                                .slice(0, 5)
                                .map(([dept]) => dept);

                              const colors = ['#3b82f6', '#10b981', '#f59e0b', '#ef4444', '#8b5cf6'];
                              const gradients = ['colorM365Dept1', 'colorM365Dept2', 'colorM365Dept3', 'colorM365Dept4', 'colorM365Dept5'];

                              return topDepts.map((dept, i) => (
                                <Area key={dept} type="monotone" dataKey={dept} name={dept} stroke={colors[i]} fillOpacity={1} fill={'url(#' + gradients[i] + ')'} />
                              ));
                            })()}
                          </AreaChart>
                        </ResponsiveContainer>
                      </div>
                    </div>

                    {/* Claude Enterprise by Department */}
                    <div>
                      <h5 className="text-md font-semibold text-purple-900 mb-3">Claude Enterprise - Messages by Department</h5>
                      <div className="h-80">
                        <ResponsiveContainer width="100%" height="100%">
                          <AreaChart data={(() => {
                            // Get top 5 departments for Claude (excluding Unknown)
                            const deptTotals = new Map();
                            aiToolsData.claudeEnterprise.monthlyTrend.forEach(m => {
                              m.byDept.forEach(d => {
                                if (d.department !== 'Unknown') {
                                  deptTotals.set(d.department, (deptTotals.get(d.department) || 0) + d.messages);
                                }
                              });
                            });

                            const topDepts = Array.from(deptTotals.entries())
                              .sort((a, b) => b[1] - a[1])
                              .slice(0, 5)
                              .map(([dept]) => dept);

                            return aiToolsData.claudeEnterprise.monthlyTrend.map(m => {
                              const dataPoint = {
                                month: m.month,
                                monthLabel: m.monthLabel
                              };
                              topDepts.forEach(dept => {
                                const deptData = m.byDept.find(d => d.department === dept);
                                dataPoint[dept] = deptData?.messages || 0;
                              });
                              return dataPoint;
                            });
                          })()}>
                            <defs>
                              <linearGradient id="colorClaudeDept1" x1="0" y1="0" x2="0" y2="1">
                                <stop offset="5%" stopColor="#8b5cf6" stopOpacity={0.8}/>
                                <stop offset="95%" stopColor="#8b5cf6" stopOpacity={0}/>
                              </linearGradient>
                              <linearGradient id="colorClaudeDept2" x1="0" y1="0" x2="0" y2="1">
                                <stop offset="5%" stopColor="#14b8a6" stopOpacity={0.8}/>
                                <stop offset="95%" stopColor="#14b8a6" stopOpacity={0}/>
                              </linearGradient>
                              <linearGradient id="colorClaudeDept3" x1="0" y1="0" x2="0" y2="1">
                                <stop offset="5%" stopColor="#f97316" stopOpacity={0.8}/>
                                <stop offset="95%" stopColor="#f97316" stopOpacity={0}/>
                              </linearGradient>
                              <linearGradient id="colorClaudeDept4" x1="0" y1="0" x2="0" y2="1">
                                <stop offset="5%" stopColor="#dc2626" stopOpacity={0.8}/>
                                <stop offset="95%" stopColor="#dc2626" stopOpacity={0}/>
                              </linearGradient>
                              <linearGradient id="colorClaudeDept5" x1="0" y1="0" x2="0" y2="1">
                                <stop offset="5%" stopColor="#7c3aed" stopOpacity={0.8}/>
                                <stop offset="95%" stopColor="#7c3aed" stopOpacity={0}/>
                              </linearGradient>
                            </defs>
                            <CartesianGrid strokeDasharray="3 3" />
                            <XAxis dataKey="monthLabel" />
                            <YAxis label={{ value: 'Messages', angle: -90, position: 'insideLeft' }} />
                            <Tooltip formatter={(value) => value.toLocaleString()} />
                            <Legend />
                            {(() => {
                              const deptTotals = new Map();
                              aiToolsData.claudeEnterprise.monthlyTrend.forEach(m => {
                                m.byDept.forEach(d => {
                                  if (d.department !== 'Unknown') {
                                    deptTotals.set(d.department, (deptTotals.get(d.department) || 0) + d.messages);
                                  }
                                });
                              });
                              const topDepts = Array.from(deptTotals.entries())
                                .sort((a, b) => b[1] - a[1])
                                .slice(0, 5)
                                .map(([dept]) => dept);

                              const colors = ['#8b5cf6', '#14b8a6', '#f97316', '#dc2626', '#7c3aed'];
                              const gradients = ['colorClaudeDept1', 'colorClaudeDept2', 'colorClaudeDept3', 'colorClaudeDept4', 'colorClaudeDept5'];

                              return topDepts.map((dept, i) => (
                                <Area key={dept} type="monotone" dataKey={dept} name={dept} stroke={colors[i]} fillOpacity={1} fill={'url(#' + gradients[i] + ')'} />
                              ));
                            })()}
                          </AreaChart>
                        </ResponsiveContainer>
                      </div>
                    </div>
                  </div>
                  <div className="mt-4 p-4 bg-indigo-50 border border-indigo-200 rounded-lg">
                    <p className="text-sm text-indigo-800">
                      <strong>Department Insight:</strong> Customer Support leads M365 Copilot usage for communication needs, while Product teams dominate Claude Enterprise for content creation and technical work. Marketing shows strong adoption across both platforms. Engineering demonstrates higher engagement with Claude Enterprise artifacts and projects.
                    </p>
                  </div>
                </div>

                {/* Strategic Positioning */}
                <div className="bg-white rounded-lg shadow-md border border-gray-100 p-6">
                  <h4 className="text-lg font-semibold text-gray-900 mb-4">Strategic Positioning Analysis</h4>
                  <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div className="p-4 bg-blue-50 border border-blue-200 rounded-lg">
                      <h5 className="font-semibold text-blue-900 mb-3">M365 Copilot Strengths</h5>
                      <ul className="space-y-2 text-sm text-blue-800">
                        <li className="flex items-start">
                          <span className="mr-2">‚Ä¢</span>
                          <span>Org-wide availability (300 employees)</span>
                        </li>
                        <li className="flex items-start">
                          <span className="mr-2">‚Ä¢</span>
                          <span>Integrated into daily workflow apps (Teams, Outlook, Word)</span>
                        </li>
                        <li className="flex items-start">
                          <span className="mr-2">‚Ä¢</span>
                          <span>Broad adoption across {aiToolsData.m365Copilot.activeUsers} active users</span>
                        </li>
                        <li className="flex items-start">
                          <span className="mr-2">‚Ä¢</span>
                          <span>Low barrier to entry for quick tasks</span>
                        </li>
                      </ul>
                    </div>
                    <div className="p-4 bg-purple-50 border border-purple-200 rounded-lg">
                      <h5 className="font-semibold text-purple-900 mb-3">Claude Enterprise Strengths</h5>
                      <ul className="space-y-2 text-sm text-purple-800">
                        <li className="flex items-start">
                          <span className="mr-2">‚Ä¢</span>
                          <span>Higher engagement ({aiToolsData.claudeEnterprise.conversationsPerUser} conversations/user)</span>
                        </li>
                        <li className="flex items-start">
                          <span className="mr-2">‚Ä¢</span>
                          <span>Advanced features (Projects, Artifacts, Analysis)</span>
                        </li>
                        <li className="flex items-start">
                          <span className="mr-2">‚Ä¢</span>
                          <span>Superior reasoning for complex problem-solving</span>
                        </li>
                        <li className="flex items-start">
                          <span className="mr-2">‚Ä¢</span>
                          <span>Preferred by power users and technical teams</span>
                        </li>
                      </ul>
                    </div>
                  </div>
                  <div className="mt-4 p-4 bg-amber-50 border border-amber-200 rounded-lg">
                    <p className="text-sm text-amber-800">
                      <strong>Strategic Question:</strong> {aiToolsData.insights?.strategicPositioning || 'These tools appear complementary rather than competitive. M365 Copilot serves as the "broad access" tool for quick, integrated tasks, while Claude Enterprise serves as the "power user" tool for deep work, complex analysis, and structured knowledge management. Should we position them as a tiered strategy?'}
                    </p>
                  </div>
                </div>
              </div>
            )}

            {/* Expansion Opportunity Tab */}
            {activeTab === 'expansion' && (
              <div className="space-y-6">
                <div className="bg-gradient-to-r from-orange-50 to-red-50 p-6 rounded-lg border border-orange-200">
                  <h3 className="text-xl font-semibold text-gray-900 mb-4">Organization Coverage Analysis</h3>
                  <div className="grid grid-cols-1 md:grid-cols-4 gap-4">
                    <div className="bg-white p-4 rounded-lg shadow-sm">
                      <p className="text-sm text-gray-600 mb-1">Total Organization</p>
                      <p className="text-3xl font-bold text-gray-900">{orgMetrics.totalEmployees}</p>
                      <p className="text-xs text-gray-500">Employees</p>
                    </div>
                    <div className="bg-white p-4 rounded-lg shadow-sm">
                      <p className="text-sm text-gray-600 mb-1">Current Licensed</p>
                      <p className="text-3xl font-bold text-blue-600">{orgMetrics.licensedSeats}</p>
                      <p className="text-xs text-gray-500">{orgMetrics.penetrationRate}% coverage</p>
                    </div>
                    <div className="bg-white p-4 rounded-lg shadow-sm">
                      <p className="text-sm text-gray-600 mb-1">Unlicensed</p>
                      <p className="text-3xl font-bold text-orange-600">{orgMetrics.unlicensedEmployees}</p>
                      <p className="text-xs text-gray-500">Opportunity gap</p>
                    </div>
                    <div className="bg-white p-4 rounded-lg shadow-sm">
                      <p className="text-sm text-gray-600 mb-1">Unrealized Value</p>
                      <p className="text-3xl font-bold text-red-600">${Math.round(expansion.summary.totalOpportunityCost / 1000)}K</p>
                      <p className="text-xs text-gray-500">Per month</p>
                    </div>
                  </div>
                </div>

                <div>
                  <h3 className="text-xl font-semibold text-gray-900 mb-2">Expansion Opportunities by Department (Ranked by Net Annual Value & ROI)</h3>
                  <p className="text-sm text-gray-600 mb-4">
                    <strong>Additive Cost:</strong> INCREMENTAL monthly license cost for new seats + upgrades √ó 12 (Premium $200/mo = $2,400/year, Standard $40/mo = $480/year).
                    <strong className="ml-2">Additive Value:</strong> INCREMENTAL productivity gains from new licenses + upgrades √ó 12 months.
                    <strong className="ml-2">Additive Net:</strong> Additive Value - Additive Cost = INCREMENTAL net benefit to organization.
                  </p>
                  <div className="overflow-x-auto">
                    <table className="w-full text-sm text-left">
                      <thead className="text-xs text-gray-700 uppercase bg-gray-50">
                        <tr>
                          <th className="px-4 py-3">Rank</th>
                          <th className="px-4 py-3">Department</th>
                          <th className="px-4 py-3">Total Employees</th>
                          <th className="px-4 py-3">Current Std Seats</th>
                          <th className="px-4 py-3">Current Prem Seats</th>
                          <th className="px-4 py-3">New Std Seats</th>
                          <th className="px-4 py-3">New Prem Seats</th>
                          <th className="px-4 py-3">Std‚ÜíPrem Upgrades</th>
                          <th className="px-4 py-3">Monthly Cost (Additive)</th>
                          <th className="px-4 py-3">Annual Cost (Additive)</th>
                          <th className="px-4 py-3">Annual Value (Additive)</th>
                          <th className="px-4 py-3">Annual Net (Additive)</th>
                          <th className="px-4 py-3">ROI</th>
                        </tr>
                      </thead>
                      <tbody>
                        {expansionOpportunities
                          .sort((a, b) => (b.netBenefit * 12) - (a.netBenefit * 12) || b.roi - a.roi)
                          .map((dept, idx) => (
                            <tr key={idx} className="bg-white border-b hover:bg-gray-50">
                              <td className="px-4 py-3 font-medium text-gray-900">{idx + 1}</td>
                              <td className="px-4 py-3 font-medium text-gray-900">{dept.department}</td>
                              <td className="px-4 py-3">{dept.totalEmployees}</td>
                              <td className="px-4 py-3 text-blue-600">{dept.currentStandard}</td>
                              <td className="px-4 py-3 text-purple-600">{dept.currentPremium}</td>
                              <td className="px-4 py-3 text-blue-600">{dept.standardGap}</td>
                              <td className="px-4 py-3 text-purple-600">{dept.premiumGap}</td>
                              <td className="px-4 py-3 text-amber-600 font-medium">{dept.upgradesNeeded}</td>
                              <td className="px-4 py-3 font-semibold">${dept.totalAdditionalCost.toLocaleString()}</td>
                              <td className="px-4 py-3 font-semibold text-blue-600">${(dept.totalAdditionalCost * 12).toLocaleString()}</td>
                              <td className="px-4 py-3 text-orange-600 font-medium">${(dept.monthlyOpportunityCost * 12).toLocaleString()}</td>
                              <td className="px-4 py-3 text-green-600 font-semibold">${(dept.netBenefit * 12).toLocaleString()}</td>
                              <td className="px-4 py-3">
                                <span className={`px-3 py-1 rounded-full text-xs font-bold ${
                                  dept.roi > 15
                                    ? 'bg-green-100 text-green-800'
                                    : dept.roi > 8
                                    ? 'bg-yellow-100 text-yellow-800'
                                    : 'bg-gray-100 text-gray-800'
                                }`}>
                                  {dept.roi.toFixed(1)}x
                                </span>
                              </td>
                            </tr>
                          ))}
                      </tbody>
                      <tfoot className="bg-gray-100 font-semibold">
                        <tr>
                          <td colSpan="3" className="px-4 py-3 text-gray-900">TOTAL EXPANSION</td>
                          <td className="px-4 py-3 text-blue-600">{expansionOpportunities.reduce((sum, d) => sum + d.currentStandard, 0)}</td>
                          <td className="px-4 py-3 text-purple-600">{expansionOpportunities.reduce((sum, d) => sum + d.currentPremium, 0)}</td>
                          <td className="px-4 py-3 text-blue-600">{expansionOpportunities.reduce((sum, d) => sum + d.standardGap, 0)}</td>
                          <td className="px-4 py-3 text-purple-600">{expansionOpportunities.reduce((sum, d) => sum + d.premiumGap, 0)}</td>
                          <td className="px-4 py-3 text-amber-600 font-bold">{expansionOpportunities.reduce((sum, d) => sum + d.upgradesNeeded, 0)}</td>
                          <td className="px-4 py-3">${expansionOpportunities.reduce((sum, d) => sum + d.totalAdditionalCost, 0).toLocaleString()}</td>
                          <td className="px-4 py-3 text-blue-600 font-bold">${(expansionOpportunities.reduce((sum, d) => sum + d.totalAdditionalCost, 0) * 12).toLocaleString()}</td>
                          <td className="px-4 py-3 text-orange-600 font-bold">${(expansionOpportunities.reduce((sum, d) => sum + d.monthlyOpportunityCost, 0) * 12).toLocaleString()}</td>
                          <td className="px-4 py-3 text-green-600 font-bold">${(expansionOpportunities.reduce((sum, d) => sum + d.netBenefit, 0) * 12).toLocaleString()}</td>
                          <td className="px-4 py-3">
                            <span className="px-3 py-1 rounded-full text-xs font-bold bg-green-100 text-green-800">
                              {(expansionOpportunities.reduce((sum, d) => sum + d.monthlyOpportunityCost, 0) / 
                                expansionOpportunities.reduce((sum, d) => sum + d.totalAdditionalCost, 0)).toFixed(1)}x
                            </span>
                          </td>
                        </tr>
                      </tfoot>
                    </table>
                  </div>
                  <div className="mt-4 bg-blue-50 p-4 rounded-lg border border-blue-200">
                    <p className="text-sm text-blue-900">
                      <strong>License Strategy (Behavioral Scoring):</strong> Premium allocation based on power user behavioral scoring (‚â•40 points across code writing, engagement, documents, complex work).
                      Standard seats for typical usage patterns. Premium Gap includes both new Premium licenses and upgrades from Standard to Premium. <strong>Annual costs</strong> shown reflect Anthropic's annual billing model.
                    </p>
                  </div>

                  {/* AI-Powered Explanation: Expansion Opportunities */}
                  {aiToolsData.insights?.expansionOpportunitiesExplanation && (
                    <div className="mt-6 bg-gradient-to-r from-indigo-50 to-purple-50 p-6 rounded-lg border-2 border-indigo-200">
                      <h4 className="text-lg font-semibold text-gray-900 mb-3 flex items-center">
                        <Lightbulb className="h-5 w-5 mr-2 text-indigo-600" />
                        Explanation of Recommendations
                      </h4>
                      <div className="prose prose-sm max-w-none text-gray-700">
                        {parseMarkdown(aiToolsData.insights.expansionOpportunitiesExplanation).map((paragraph) => (
                          <p key={paragraph.idx} className="mb-3 leading-relaxed">
                            {paragraph.parts.map((part, partIdx) =>
                              part.type === 'bold'
                                ? <strong key={partIdx}>{part.content}</strong>
                                : <span key={partIdx}>{part.content}</span>
                            )}
                          </p>
                        ))}
                      </div>
                    </div>
                  )}
                </div>

                <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                  <div className="bg-white border border-gray-200 rounded-lg p-6">
                    <div className="mb-4 bg-gradient-to-r from-indigo-100 to-purple-100 p-3 rounded-lg border-2 border-indigo-300">
                      <h3 className="text-sm font-bold text-indigo-900 mb-1">üìã PROPOSED BY LUIS AMADEO (CHIEF AGENTIC OFFICER)</h3>
                      <p className="text-xs text-indigo-700">Engineering-first approach with 100% Premium coverage</p>
                    </div>
                    <h3 className="text-lg font-semibold text-gray-900 mb-4">Phased Rollout Strategy - 2026 Quarterly Plan</h3>
                    <div className="mb-3 bg-purple-50 p-3 rounded-lg border border-purple-300 text-xs text-purple-900">
                      <strong>2026 Quarterly:</strong> Q1-Engineering Premium ($118K), Q2-Service/GTM ($40K), Q3-Complete ($2K).
                      <strong>Total 2026: $226K | 2027+ run rate: $270K/year</strong>
                    </div>
                    <div className="space-y-4">
                      <div className="border-l-4 border-green-500 pl-4 py-2 bg-green-50">
                        <div className="flex items-center justify-between mb-1">
                          <h4 className="font-semibold text-gray-900 text-sm">Phase 1: Early Adopters & Champions</h4>
                          <span className="px-2 py-1 bg-green-100 text-green-800 rounded text-xs font-bold">‚úì COMPLETE</span>
                        </div>
                        <p className="text-xs text-gray-600 mb-2">82 users across all departments | 13 Premium + 72 Standard</p>
                        <div className="grid grid-cols-2 gap-2 text-xs">
                          <span className="text-gray-700 font-semibold">Annual Run Rate: $65,760</span>
                          <span className="text-green-600 font-semibold">ROI: 7.4x-10.3x</span>
                        </div>
                      </div>
                      
                      <div className="border-l-4 border-purple-500 pl-4 py-2 bg-purple-50">
                        <div className="flex items-center justify-between mb-1">
                          <h4 className="font-semibold text-gray-900 text-sm">Phase 2: All Engineering with Claude Code</h4>
                          <span className="px-2 py-1 bg-purple-100 text-purple-800 rounded text-xs font-bold">‚Üí Q1 2026 (JAN-MAR)</span>
                        </div>
                        <p className="text-xs text-gray-600 mb-2">70 engineers | Upgrade 9 Std‚ÜíPrem + 49 new Premium | Deploy ~Feb 15</p>
                        <div className="grid grid-cols-2 gap-2 text-xs">
                          <span className="text-purple-700 font-semibold">2026 Pro-rated: $118,020</span>
                          <span className="text-purple-600">Annual Run Rate: $134,880</span>
                          <span className="text-purple-600">2026 Value: $579K</span>
                          <span className="text-purple-600 font-semibold">ROI: 4.9x</span>
                        </div>
                        <p className="text-xs text-gray-500 mt-1">10.5 months in 2026</p>
                      </div>

                      {/* Phase 2 Rollout Tracker Card */}
                      {aiToolsData.expansion?.rolloutTracking?.phase2Engineering && (() => {
                        const tracker = aiToolsData.expansion.rolloutTracking.phase2Engineering;
                        const statusColors = {
                          'complete': 'bg-green-100 text-green-800 border-green-300',
                          'on-track': 'bg-blue-100 text-blue-800 border-blue-300',
                          'at-risk': 'bg-yellow-100 text-yellow-800 border-yellow-300',
                          'behind-schedule': 'bg-red-100 text-red-800 border-red-300',
                          'not-started': 'bg-gray-100 text-gray-800 border-gray-300'
                        };
                        const statusColor = statusColors[tracker.status] || statusColors['not-started'];

                        return (
                          <div className="mt-3 p-4 bg-gradient-to-r from-purple-50 to-indigo-50 rounded-lg border-2 border-purple-300">
                            <div className="flex items-center justify-between mb-3">
                              <h5 className="font-bold text-gray-900 text-sm flex items-center">
                                <TrendingUp className="h-4 w-4 mr-2 text-purple-600" />
                                Phase 2 Rollout Tracker
                              </h5>
                              <span className={`px-2 py-1 rounded text-xs font-bold border ${statusColor}`}>
                                {tracker.status.toUpperCase().replace('-', ' ')}
                              </span>
                            </div>

                            {/* Progress Bar */}
                            <div className="mb-3">
                              <div className="flex items-center justify-between mb-1">
                                <span className="text-xs font-semibold text-gray-700">Engineering Premium Seats</span>
                                <span className="text-xs font-bold text-purple-700">{tracker.current}/{tracker.target} ({tracker.progress}%)</span>
                              </div>
                              <div className="w-full bg-gray-200 rounded-full h-3">
                                <div
                                  className="bg-gradient-to-r from-purple-500 to-indigo-600 h-3 rounded-full transition-all duration-500"
                                  style={{ width: `${tracker.progress}%` }}
                                ></div>
                              </div>
                            </div>

                            {/* Metrics Grid */}
                            <div className="grid grid-cols-3 gap-2 mb-3">
                              <div className="bg-white p-2 rounded border border-purple-200">
                                <p className="text-xs text-gray-600">Remaining</p>
                                <p className="text-lg font-bold text-purple-700">{tracker.remaining}</p>
                                <p className="text-xs text-gray-500">seats</p>
                              </div>
                              <div className="bg-white p-2 rounded border border-indigo-200">
                                <p className="text-xs text-gray-600">Upgrades Needed</p>
                                <p className="text-lg font-bold text-indigo-700">{tracker.breakdown.upgradesNeeded}</p>
                                <p className="text-xs text-gray-500">Std‚ÜíPrem</p>
                              </div>
                              <div className="bg-white p-2 rounded border border-blue-200">
                                <p className="text-xs text-gray-600">New Seats</p>
                                <p className="text-lg font-bold text-blue-700">{tracker.breakdown.premiumGap}</p>
                                <p className="text-xs text-gray-500">Premium</p>
                              </div>
                            </div>

                            {/* Footer */}
                            <div className="flex items-center justify-between text-xs">
                              <span className="text-gray-600">Last updated: {tracker.lastUpdate}</span>
                              <span className="text-gray-600">Target: {tracker.targetDate}</span>
                            </div>
                          </div>
                        );
                      })()}
                      
                      <div className="border-l-4 border-blue-500 pl-4 py-2 bg-blue-50">
                        <div className="flex items-center justify-between mb-1">
                          <h4 className="font-semibold text-gray-900 text-sm">Phase 3: Service Teams & GTM Complete</h4>
                          <span className="px-2 py-1 bg-blue-100 text-blue-800 rounded text-xs font-bold">‚Üí Q2 2026 (APR-JUN)</span>
                        </div>
                        <p className="text-xs text-gray-600 mb-2">CS, Prof Services, Support, Sales, Marketing, Product, BizDev | 88 users | Deploy ~May 15</p>
                        <div className="grid grid-cols-2 gap-2 text-xs">
                          <span className="text-blue-700 font-semibold">2026 Pro-rated: $40,200</span>
                          <span className="text-blue-600">Annual Run Rate: $64,320</span>
                          <span className="text-blue-600">2026 Value: $396K</span>
                          <span className="text-blue-600 font-semibold">ROI: 9.9x</span>
                        </div>
                        <p className="text-xs text-gray-500 mt-1">7.5 months in 2026 | 14 Prem upgrades + 1 new Prem + 73 Std</p>
                      </div>
                      
                      <div className="border-l-4 border-orange-500 pl-4 py-2 bg-orange-50">
                        <div className="flex items-center justify-between mb-1">
                          <h4 className="font-semibold text-gray-900 text-sm">Phase 4: Complete Coverage</h4>
                          <span className="px-2 py-1 bg-orange-100 text-orange-800 rounded text-xs font-bold">‚Üí Q3 2026 (JUL-SEP)</span>
                        </div>
                        <p className="text-xs text-gray-600 mb-2">Final 5 support users | Deploy ~Aug 15</p>
                        <div className="grid grid-cols-2 gap-2 text-xs">
                          <span className="text-orange-700 font-semibold">2026 Pro-rated: $1,980</span>
                          <span className="text-orange-600">Annual Run Rate: $5,280</span>
                          <span className="text-orange-600">2026 Value: $14K</span>
                          <span className="text-orange-600 font-semibold">ROI: 6.8x</span>
                        </div>
                        <p className="text-xs text-gray-500 mt-1">4.5 months in 2026</p>
                      </div>

                      <div className="mt-4 p-4 bg-gradient-to-r from-purple-100 to-blue-100 rounded-lg border-2 border-purple-300">
                        <h4 className="font-semibold text-gray-900 mb-3 text-sm">2026 Budget Summary</h4>
                        <div className="grid grid-cols-2 gap-3">
                          <div className="bg-white p-3 rounded border-2 border-purple-400">
                            <p className="text-xs text-gray-700 mb-1 font-semibold">2026 Pro-rated</p>
                            <p className="text-2xl font-bold text-purple-700">$226K</p>
                          </div>
                          <div className="bg-white p-3 rounded border-2 border-blue-400">
                            <p className="text-xs text-gray-700 mb-1 font-semibold">2027+ Run Rate</p>
                            <p className="text-2xl font-bold text-blue-700">$270K</p>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>

                  <div className="bg-white border border-gray-200 rounded-lg p-6">
                    <div className="mb-4 bg-gradient-to-r from-green-100 to-emerald-100 p-3 rounded-lg border-2 border-green-300">
                      <h3 className="text-sm font-bold text-green-900 mb-1">üìä DATA-DRIVEN VALUE-BASED APPROACH</h3>
                      <p className="text-xs text-green-700">Behavioral scoring with Premium only for power users</p>
                    </div>
                    <h3 className="text-lg font-semibold text-gray-900 mb-4">Value & ROI-Optimized Rollout Strategy</h3>
                    <div className="mb-3 bg-green-50 p-3 rounded-lg border border-green-300 text-xs text-green-900">
                      <strong>Additive deployment by Net Annual Value ranking:</strong> Building on existing {orgMetrics.licensedSeats} licenses. Deploy new seats to departments with highest net dollar value first to maximize financial impact.
                      <strong className="block mt-1">Additional Investment: ${(expansion.summary.totalAdditionalCost * 12).toLocaleString()}/year | Value: ${(expansion.summary.totalOpportunityCost * 12).toLocaleString()}/year | ROI: {expansion.summary.overallROI.toFixed(1)}x</strong>
                    </div>
                    <div className="space-y-4">
                      {/* Phase 1: Current Baseline (Complete) */}
                      <div className="border-l-4 border-gray-400 pl-4 py-2 bg-gray-50">
                        <div className="flex items-center justify-between mb-1">
                          <h4 className="font-semibold text-gray-900 text-sm">Phase 1: Early Adopters (COMPLETE)</h4>
                          <span className="px-2 py-1 bg-gray-100 text-gray-800 rounded text-xs font-bold">‚úì Deployed</span>
                        </div>
                        <p className="text-xs text-gray-600 mb-2">Existing baseline across all departments | {orgMetrics.licensedSeats} users</p>
                        <div className="grid grid-cols-2 gap-2 text-xs">
                          <span className="text-gray-700">{orgMetrics.licensedSeats - 13} Standard + {13} Premium seats</span>
                          <span className="text-gray-600 font-semibold">Current state</span>
                        </div>
                      </div>

                      {(() => {
                        // Sort departments by Annual Net Value first, then ROI (highest first)
                        const sortedDepts = [...expansionOpportunities].sort((a, b) => (b.netBenefit * 12) - (a.netBenefit * 12) || b.roi - a.roi);

                        // Group into phases based on sorted ranking (highest net value first)
                        const totalDepts = sortedDepts.length;
                        const deptsPerPhase = Math.ceil(totalDepts / 4); // Divide into ~4 phases

                        const phase1Depts = sortedDepts.slice(0, deptsPerPhase);
                        const phase2Depts = sortedDepts.slice(deptsPerPhase, deptsPerPhase * 2);
                        const phase3Depts = sortedDepts.slice(deptsPerPhase * 2, deptsPerPhase * 3);
                        const phase4Depts = sortedDepts.slice(deptsPerPhase * 3);

                        const phases = [
                          { name: "Phase 2: Highest Value Departments", depts: phase1Depts, color: "green", bgColor: "green-50", borderColor: "green-500", quarter: "Q1 2026" },
                          { name: "Phase 3: High Value Departments", depts: phase2Depts, color: "blue", bgColor: "blue-50", borderColor: "blue-500", quarter: "Q2 2026" },
                          { name: "Phase 4: Medium Value Departments", depts: phase3Depts, color: "indigo", bgColor: "indigo-50", borderColor: "indigo-500", quarter: "Q3 2026" },
                          { name: "Phase 5: Remaining Departments", depts: phase4Depts, color: "purple", bgColor: "purple-50", borderColor: "purple-500", quarter: "Q4 2026" }
                        ].filter(phase => phase.depts.length > 0); // Only include phases with departments

                        // Calculate cumulative seats for each phase
                        let cumulativeSeats = orgMetrics.licensedSeats; // Start with current baseline

                        return phases.map((phase, idx) => {
                          const totalNewUsers = phase.depts.reduce((sum, d) => sum + d.standardGap + d.premiumGap, 0);
                          const totalUpgrades = phase.depts.reduce((sum, d) => sum + (d.upgradesNeeded || 0), 0);
                          const totalCost = phase.depts.reduce((sum, d) => sum + d.totalAdditionalCost, 0);
                          const totalValue = phase.depts.reduce((sum, d) => sum + d.monthlyOpportunityCost, 0);
                          const avgROI = totalCost > 0 ? (totalValue / totalCost) : 0;
                          const deptNames = phase.depts.map(d => d.department).join(", ");

                          // Add new seats to cumulative total
                          cumulativeSeats += totalNewUsers;
                          const orgCoverage = ((cumulativeSeats / orgMetrics.totalEmployees) * 100).toFixed(1);

                          return (
                            <div key={idx} className={`border-l-4 border-${phase.borderColor} pl-4 py-2 bg-${phase.bgColor}`}>
                              <div className="flex items-center justify-between mb-1">
                                <h4 className="font-semibold text-gray-900 text-sm">{phase.name}</h4>
                                <span className={`px-2 py-1 bg-${phase.color}-100 text-${phase.color}-800 rounded text-xs font-bold`}>‚Üí {phase.quarter}</span>
                              </div>
                              <p className="text-xs text-gray-600 mb-2">{deptNames} | +{totalNewUsers} new users{totalUpgrades > 0 ? ` + ${totalUpgrades} upgrades` : ''}</p>
                              <div className="grid grid-cols-2 gap-2 text-xs">
                                <span className="text-gray-700">Annual Cost: ${(totalCost * 12).toLocaleString()}</span>
                                <span className={`text-${phase.color}-600`}>Annual Value: ${(totalValue * 12).toLocaleString()}</span>
                                <span className="text-gray-700">Monthly: ${totalCost.toLocaleString()}</span>
                                <span className={`text-${phase.color}-600 font-semibold`}>ROI: {avgROI.toFixed(1)}x</span>
                                <span className="text-purple-700 font-bold">Org Coverage: {orgCoverage}%</span>
                                <span className="text-gray-600">{cumulativeSeats} of {orgMetrics.totalEmployees} employees</span>
                              </div>
                            </div>
                          );
                        });
                      })()}

                      {(() => {
                        // Calculate 2026 pro-rated costs based on quarterly deployment
                        const sortedDepts = [...expansionOpportunities].sort((a, b) => (b.netBenefit * 12) - (a.netBenefit * 12) || b.roi - a.roi);
                        const totalDepts = sortedDepts.length;
                        const deptsPerPhase = Math.ceil(totalDepts / 4);

                        const phase1Depts = sortedDepts.slice(0, deptsPerPhase);
                        const phase2Depts = sortedDepts.slice(deptsPerPhase, deptsPerPhase * 2);
                        const phase3Depts = sortedDepts.slice(deptsPerPhase * 2, deptsPerPhase * 3);
                        const phase4Depts = sortedDepts.slice(deptsPerPhase * 3);

                        // Pro-rated months in 2026 (mid-quarter deployment)
                        // Q1 (mid-Feb): 10.5 months, Q2 (mid-May): 7.5 months, Q3 (mid-Aug): 4.5 months, Q4 (mid-Nov): 1.5 months
                        const q1Cost = phase1Depts.reduce((sum, d) => sum + d.totalAdditionalCost, 0) * 10.5;
                        const q2Cost = phase2Depts.reduce((sum, d) => sum + d.totalAdditionalCost, 0) * 7.5;
                        const q3Cost = phase3Depts.reduce((sum, d) => sum + d.totalAdditionalCost, 0) * 4.5;
                        const q4Cost = phase4Depts.reduce((sum, d) => sum + d.totalAdditionalCost, 0) * 1.5;

                        const proRated2026 = q1Cost + q2Cost + q3Cost + q4Cost;
                        const runRate2027 = expansion.summary.totalAdditionalCost * 12;

                        return (
                          <div className="mt-4 p-4 bg-gradient-to-r from-green-100 to-emerald-100 rounded-lg border-2 border-green-300">
                            <h4 className="font-semibold text-gray-900 mb-3 text-sm">2026 Budget Summary</h4>
                            <div className="grid grid-cols-2 gap-3">
                              <div className="bg-white p-3 rounded border-2 border-green-400">
                                <p className="text-xs text-gray-700 mb-1 font-semibold">2026 Pro-rated</p>
                                <p className="text-2xl font-bold text-green-700">${Math.round(proRated2026 / 1000)}K</p>
                                <p className="text-xs text-gray-500 mt-1">Phased quarterly deployment</p>
                              </div>
                              <div className="bg-white p-3 rounded border-2 border-emerald-400">
                                <p className="text-xs text-gray-700 mb-1 font-semibold">2027+ Run Rate</p>
                                <p className="text-2xl font-bold text-emerald-700">${Math.round(runRate2027 / 1000)}K</p>
                                <p className="text-xs text-gray-500 mt-1">Full year after Phase 4</p>
                              </div>
                            </div>
                          </div>
                        );
                      })()}
                    </div>
                  </div>
                </div>

                {/* AI-Powered Explanation: Rollout Strategy */}
                {aiToolsData.insights?.rolloutStrategyExplanation && (
                  <div className="mt-6 bg-gradient-to-r from-green-50 to-emerald-50 p-6 rounded-lg border-2 border-green-200">
                    <h4 className="text-lg font-semibold text-gray-900 mb-3 flex items-center">
                      <Lightbulb className="h-5 w-5 mr-2 text-green-600" />
                      Explanation of Recommendations - Rollout Strategy
                    </h4>
                    <div className="prose prose-sm max-w-none text-gray-700">
                      {parseMarkdown(aiToolsData.insights.rolloutStrategyExplanation).map((paragraph) => (
                        <p key={paragraph.idx} className="mb-3 leading-relaxed">
                          {paragraph.parts.map((part, partIdx) =>
                            part.type === 'bold'
                              ? <strong key={partIdx}>{part.content}</strong>
                              : <span key={partIdx}>{part.content}</span>
                          )}
                        </p>
                      ))}
                    </div>
                  </div>
                )}

                <div className="bg-yellow-50 p-6 rounded-lg border-2 border-yellow-300">
                  <h3 className="text-lg font-semibold text-gray-900 mb-3 flex items-center">
                    <TrendingUp className="h-5 w-5 mr-2 text-yellow-600" />
                    Cost of Inaction
                  </h3>
                  <p className="text-gray-700 mb-4">
                    By maintaining current {orgMetrics.penetrationRate}% coverage ({orgMetrics.licensedSeats} of {orgMetrics.totalEmployees} employees), AbsenceSoft is leaving significant productivity gains unrealized from {orgMetrics.unlicensedEmployees} unlicensed employees.
                  </p>
                  <div className="grid grid-cols-2 md:grid-cols-4 gap-4">
                    <div className="bg-white p-3 rounded border border-orange-200">
                      <p className="text-xs text-gray-600 mb-1">Monthly Unrealized Value</p>
                      <p className="text-xl font-bold text-red-600">${expansion.summary.totalOpportunityCost.toLocaleString()}</p>
                    </div>
                    <div className="bg-white p-3 rounded border-2 border-red-300">
                      <p className="text-xs text-gray-700 mb-1 font-semibold">Annual Unrealized Value</p>
                      <p className="text-xl font-bold text-red-700">${((expansion.summary.totalOpportunityCost * 12) / 1000000).toFixed(2)}M</p>
                    </div>
                    <div className="bg-white p-3 rounded border border-green-200">
                      <p className="text-xs text-gray-600 mb-1">Annual Cost to Capture</p>
                      <p className="text-xl font-bold text-blue-600">${(expansion.summary.totalAdditionalCost * 12).toLocaleString()}</p>
                    </div>
                    <div className="bg-white p-3 rounded border-2 border-green-300">
                      <p className="text-xs text-gray-700 mb-1 font-semibold">Annual Net Benefit</p>
                      <p className="text-xl font-bold text-green-700">${((expansion.summary.totalNetBenefit * 12) / 1000000).toFixed(2)}M</p>
                      <p className="text-xs text-gray-500 mt-1">{expansion.summary.overallROI.toFixed(1)}x ROI</p>
                    </div>
                  </div>
                </div>

                {/* Incremental ROI Analysis Section */}
                <div className="bg-gradient-to-r from-indigo-50 to-purple-50 p-6 rounded-lg border-2 border-indigo-200">
                  <div className="mb-6">
                    <h3 className="text-xl font-semibold text-gray-900 mb-2 flex items-center">
                      <TrendingUp className="h-6 w-6 mr-2 text-indigo-600" />
                      Incremental ROI Analysis vs Industry Benchmarks
                    </h3>
                    <p className="text-sm text-gray-700">
                      Comparing AbsenceSoft's data-driven performance against published industry research for GitHub Copilot and M365 Copilot productivity benchmarks.
                    </p>
                  </div>

                  <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                    {/* GitHub ‚Üí Claude Code Card */}
                    <div className="bg-white rounded-lg p-6 border-2 border-blue-200">
                      <h4 className="text-lg font-semibold text-gray-900 mb-4">
                        GitHub Copilot ‚Üí Claude Code Premium
                      </h4>

                      {/* Shared Metrics */}
                      <div className="grid grid-cols-2 gap-3 text-xs mb-4">
                        <div className="p-2 bg-blue-50 rounded">
                          <p className="text-gray-600 mb-1">Incremental Hours/Mo</p>
                          <p className="text-lg font-bold text-gray-900">{aiToolsData.incrementalROI.githubToClaudeCode.incrementalHours}</p>
                        </div>
                        <div className="p-2 bg-blue-50 rounded">
                          <p className="text-gray-600 mb-1">Incremental Value/Mo</p>
                          <p className="text-lg font-bold text-green-600">${aiToolsData.incrementalROI.githubToClaudeCode.incrementalValue.toLocaleString()}</p>
                        </div>
                        <div className="p-2 bg-blue-50 rounded">
                          <p className="text-gray-600 mb-1">Baseline Hours</p>
                          <p className="text-lg font-bold text-gray-700">{aiToolsData.incrementalROI.githubToClaudeCode.baselineHours} hrs</p>
                        </div>
                        <div className="p-2 bg-blue-50 rounded">
                          <p className="text-gray-600 mb-1">Claude Code Hours</p>
                          <p className="text-lg font-bold text-blue-600">{aiToolsData.incrementalROI.githubToClaudeCode.currentHours} hrs</p>
                        </div>
                      </div>

                      {/* Two Scenarios Side-by-Side */}
                      <div className="grid grid-cols-2 gap-4">
                        {/* ADDITIVE SCENARIO */}
                        <div className="border border-green-300 rounded-lg p-4 bg-green-50">
                          <h5 className="text-sm font-bold text-green-900 mb-2 flex items-center justify-between">
                            <span>Keep GitHub + Add Claude</span>
                            {aiToolsData.incrementalROI.githubToClaudeCode.additive.roiComparison.deltaPercent !== null && (
                              <span className={`px-2 py-0.5 text-xs font-bold rounded ${aiToolsData.incrementalROI.githubToClaudeCode.additive.roiComparison.deltaPercent >= 0 ? 'bg-green-200 text-green-800' : 'bg-red-200 text-red-800'}`}>
                                {aiToolsData.incrementalROI.githubToClaudeCode.additive.roiComparison.deltaPercent >= 0 ? '+' : ''}{aiToolsData.incrementalROI.githubToClaudeCode.additive.roiComparison.deltaPercent}%
                              </span>
                            )}
                          </h5>
                          <div className="space-y-2">
                            <div className="flex justify-between items-center p-2 bg-white rounded border border-green-200">
                              <span className="text-xs font-medium text-gray-700">Incremental Cost</span>
                              <span className="text-lg font-bold text-orange-600">${aiToolsData.incrementalROI.githubToClaudeCode.additive.incrementalCost}/mo</span>
                            </div>
                            <div className="flex justify-between items-center p-2 bg-white rounded border border-green-200">
                              <span className="text-xs font-medium text-gray-700">Data-Driven ROI</span>
                              <span className="text-lg font-bold text-green-700">{aiToolsData.incrementalROI.githubToClaudeCode.additive.incrementalROI.toFixed(1)}x</span>
                            </div>
                            {aiToolsData.incrementalROI.githubToClaudeCode.additive.industryBenchmark && (
                              <div className="flex justify-between items-center p-2 bg-gray-50 rounded text-xs">
                                <span className="text-gray-600">Industry Benchmark</span>
                                <span className="font-bold text-gray-700">{aiToolsData.incrementalROI.githubToClaudeCode.additive.industryBenchmark.incrementalROI.toFixed(1)}x</span>
                              </div>
                            )}
                          </div>
                        </div>

                        {/* REPLACEMENT SCENARIO */}
                        <div className="border border-blue-300 rounded-lg p-4 bg-blue-50">
                          <h5 className="text-sm font-bold text-blue-900 mb-2 flex items-center justify-between">
                            <span>Replace GitHub with Claude</span>
                            {aiToolsData.incrementalROI.githubToClaudeCode.replacement.roiComparison.deltaPercent !== null && (
                              <span className={`px-2 py-0.5 text-xs font-bold rounded ${aiToolsData.incrementalROI.githubToClaudeCode.replacement.roiComparison.deltaPercent >= 0 ? 'bg-green-200 text-green-800' : 'bg-red-200 text-red-800'}`}>
                                {aiToolsData.incrementalROI.githubToClaudeCode.replacement.roiComparison.deltaPercent >= 0 ? '+' : ''}{aiToolsData.incrementalROI.githubToClaudeCode.replacement.roiComparison.deltaPercent}%
                              </span>
                            )}
                          </h5>
                          <div className="space-y-2">
                            <div className="flex justify-between items-center p-2 bg-white rounded border border-blue-200">
                              <span className="text-xs font-medium text-gray-700">Incremental Cost</span>
                              <span className="text-lg font-bold text-orange-600">${aiToolsData.incrementalROI.githubToClaudeCode.replacement.incrementalCost}/mo</span>
                            </div>
                            <div className="flex justify-between items-center p-2 bg-white rounded border border-blue-200">
                              <span className="text-xs font-medium text-gray-700">Data-Driven ROI</span>
                              <span className="text-lg font-bold text-blue-700">{aiToolsData.incrementalROI.githubToClaudeCode.replacement.incrementalROI.toFixed(1)}x</span>
                            </div>
                            {aiToolsData.incrementalROI.githubToClaudeCode.replacement.industryBenchmark && (
                              <div className="flex justify-between items-center p-2 bg-gray-50 rounded text-xs">
                                <span className="text-gray-600">Industry Benchmark</span>
                                <span className="font-bold text-gray-700">{aiToolsData.incrementalROI.githubToClaudeCode.replacement.industryBenchmark.incrementalROI.toFixed(1)}x</span>
                              </div>
                            )}
                          </div>
                        </div>
                      </div>

                      {/* Sources */}
                      {aiToolsData.incrementalROI.githubToClaudeCode.industryBenchmark?.sources && (
                        <div className="mt-4 pt-4 border-t border-gray-200">
                          <h5 className="text-xs font-semibold text-gray-700 mb-2">Industry Research Sources:</h5>
                          <div className="space-y-2">
                            {aiToolsData.incrementalROI.githubToClaudeCode.industryBenchmark.sources.map((source, idx) => (
                              <div key={idx} className="text-xs">
                                <a
                                  href={source.url}
                                  target="_blank"
                                  rel="noopener noreferrer"
                                  className="text-blue-600 hover:text-blue-800 underline font-medium"
                                >
                                  {source.title}
                                </a>
                                <p className="text-gray-600 mt-0.5">
                                  {source.author} ({source.year}) | n={source.sampleSize.toLocaleString()} | {source.findingHours} hrs/mo
                                </p>
                              </div>
                            ))}
                          </div>
                        </div>
                      )}
                    </div>

                    {/* M365 ‚Üí Claude Enterprise Card */}
                    <div className="bg-white rounded-lg p-6 border-2 border-purple-200">
                      <h4 className="text-lg font-semibold text-gray-900 mb-4">
                        M365 Copilot ‚Üí Claude Enterprise
                      </h4>

                      {/* Shared Metrics */}
                      <div className="grid grid-cols-2 gap-3 text-xs mb-4">
                        <div className="p-2 bg-purple-50 rounded">
                          <p className="text-gray-600 mb-1">Incremental Hours/Mo</p>
                          <p className="text-lg font-bold text-gray-900">{aiToolsData.incrementalROI.m365ToClaudeEnterprise.incrementalHours}</p>
                        </div>
                        <div className="p-2 bg-purple-50 rounded">
                          <p className="text-gray-600 mb-1">Incremental Value/Mo</p>
                          <p className="text-lg font-bold text-green-600">${aiToolsData.incrementalROI.m365ToClaudeEnterprise.incrementalValue.toLocaleString()}</p>
                        </div>
                        <div className="p-2 bg-purple-50 rounded">
                          <p className="text-gray-600 mb-1">Productivity Ratio</p>
                          <p className="text-lg font-bold text-indigo-600">{aiToolsData.incrementalROI.m365ToClaudeEnterprise.productivityRatio.toFixed(1)}x</p>
                        </div>
                        <div className="p-2 bg-purple-50 rounded">
                          <p className="text-gray-600 mb-1">Claude Messages/User</p>
                          <p className="text-lg font-bold text-purple-600">{aiToolsData.incrementalROI.m365ToClaudeEnterprise.claudeMessagesPerUser} vs {aiToolsData.incrementalROI.m365ToClaudeEnterprise.m365PromptsPerUser}</p>
                        </div>
                      </div>

                      {/* Two Scenarios Side-by-Side */}
                      <div className="grid grid-cols-2 gap-4">
                        {/* ADDITIVE SCENARIO */}
                        <div className="border border-green-300 rounded-lg p-4 bg-green-50">
                          <h5 className="text-sm font-bold text-green-900 mb-2 flex items-center justify-between">
                            <span>Keep M365 + Add Claude</span>
                            {aiToolsData.incrementalROI.m365ToClaudeEnterprise.additive.roiComparison.deltaPercent !== null && (
                              <span className={`px-2 py-0.5 text-xs font-bold rounded ${aiToolsData.incrementalROI.m365ToClaudeEnterprise.additive.roiComparison.deltaPercent >= 0 ? 'bg-green-200 text-green-800' : 'bg-red-200 text-red-800'}`}>
                                {aiToolsData.incrementalROI.m365ToClaudeEnterprise.additive.roiComparison.deltaPercent >= 0 ? '+' : ''}{aiToolsData.incrementalROI.m365ToClaudeEnterprise.additive.roiComparison.deltaPercent}%
                              </span>
                            )}
                          </h5>
                          <div className="space-y-2">
                            <div className="flex justify-between items-center p-2 bg-white rounded border border-green-200">
                              <span className="text-xs font-medium text-gray-700">Incremental Cost</span>
                              <span className="text-lg font-bold text-orange-600">${aiToolsData.incrementalROI.m365ToClaudeEnterprise.additive.incrementalCost}/mo</span>
                            </div>
                            <div className="flex justify-between items-center p-2 bg-white rounded border border-green-200">
                              <span className="text-xs font-medium text-gray-700">Data-Driven ROI</span>
                              <span className="text-lg font-bold text-green-700">{aiToolsData.incrementalROI.m365ToClaudeEnterprise.additive.incrementalROI.toFixed(1)}x</span>
                            </div>
                            {aiToolsData.incrementalROI.m365ToClaudeEnterprise.additive.industryBenchmark && (
                              <div className="flex justify-between items-center p-2 bg-gray-50 rounded text-xs">
                                <span className="text-gray-600">Industry Benchmark</span>
                                <span className="font-bold text-gray-700">{aiToolsData.incrementalROI.m365ToClaudeEnterprise.additive.industryBenchmark.incrementalROI.toFixed(1)}x</span>
                              </div>
                            )}
                          </div>
                        </div>

                        {/* REPLACEMENT SCENARIO */}
                        <div className="border border-blue-300 rounded-lg p-4 bg-blue-50">
                          <h5 className="text-sm font-bold text-blue-900 mb-2 flex items-center justify-between">
                            <span>Replace M365 with Claude</span>
                            {aiToolsData.incrementalROI.m365ToClaudeEnterprise.replacement.roiComparison.deltaPercent !== null && (
                              <span className={`px-2 py-0.5 text-xs font-bold rounded ${aiToolsData.incrementalROI.m365ToClaudeEnterprise.replacement.roiComparison.deltaPercent >= 0 ? 'bg-green-200 text-green-800' : 'bg-red-200 text-red-800'}`}>
                                {aiToolsData.incrementalROI.m365ToClaudeEnterprise.replacement.roiComparison.deltaPercent >= 0 ? '+' : ''}{aiToolsData.incrementalROI.m365ToClaudeEnterprise.replacement.roiComparison.deltaPercent}%
                              </span>
                            )}
                          </h5>
                          <div className="space-y-2">
                            <div className="flex justify-between items-center p-2 bg-white rounded border border-blue-200">
                              <span className="text-xs font-medium text-gray-700">Incremental Cost</span>
                              <span className="text-lg font-bold text-orange-600">${aiToolsData.incrementalROI.m365ToClaudeEnterprise.replacement.incrementalCost}/mo</span>
                            </div>
                            <div className="flex justify-between items-center p-2 bg-white rounded border border-blue-200">
                              <span className="text-xs font-medium text-gray-700">Data-Driven ROI</span>
                              <span className="text-lg font-bold text-blue-700">{aiToolsData.incrementalROI.m365ToClaudeEnterprise.replacement.incrementalROI.toFixed(1)}x</span>
                            </div>
                            {aiToolsData.incrementalROI.m365ToClaudeEnterprise.replacement.industryBenchmark && (
                              <div className="flex justify-between items-center p-2 bg-gray-50 rounded text-xs">
                                <span className="text-gray-600">Industry Benchmark</span>
                                <span className="font-bold text-gray-700">{aiToolsData.incrementalROI.m365ToClaudeEnterprise.replacement.industryBenchmark.incrementalROI.toFixed(1)}x</span>
                              </div>
                            )}
                          </div>
                        </div>
                      </div>

                      {/* Sources or No Data Message */}
                      <div className="mt-4 pt-4 border-t border-gray-200">
                        <h5 className="text-xs font-semibold text-gray-700 mb-2">
                          M365 Copilot Industry Research Sources ({aiToolsData.incrementalROI.m365ToClaudeEnterprise.industryBenchmark?.studyCount || 0} studies, {(aiToolsData.incrementalROI.m365ToClaudeEnterprise.industryBenchmark?.totalSampleSize || 0).toLocaleString()} total sample):
                        </h5>
                        {aiToolsData.incrementalROI.m365ToClaudeEnterprise.industryBenchmark?.sources && aiToolsData.incrementalROI.m365ToClaudeEnterprise.industryBenchmark.sources.length > 0 ? (
                          <div className="space-y-2">
                            {aiToolsData.incrementalROI.m365ToClaudeEnterprise.industryBenchmark.sources.map((source, idx) => (
                              <div key={idx} className="p-2 bg-gray-50 rounded border border-gray-200 text-xs">
                                <p className="font-semibold text-gray-900">
                                  {source.url && source.url.startsWith('http') ? (
                                    <a href={source.url} target="_blank" rel="noopener noreferrer" className="text-indigo-600 hover:underline">
                                      {source.title}
                                    </a>
                                  ) : (
                                    source.title
                                  )}
                                </p>
                                <p className="text-gray-600 mt-1">
                                  {source.author} ({source.year}) ‚Ä¢ Sample: {typeof source.sampleSize === 'number' ? source.sampleSize.toLocaleString() : source.sampleSize} ‚Ä¢ {source.findingHours} hrs/mo
                                  {source.role && <span className="ml-2 px-2 py-0.5 bg-indigo-100 text-indigo-700 rounded text-xs">{source.role.replace('_', ' ')}</span>}
                                </p>
                              </div>
                            ))}
                          </div>
                        ) : (
                          <div className="p-3 bg-yellow-50 rounded border border-yellow-200">
                            <p className="text-xs text-yellow-800 italic">
                              No M365 Copilot benchmark sources available. Using AbsenceSoft internal data only.
                            </p>
                          </div>
                        )}
                      </div>

                      {/* Claude Enterprise Sources */}
                      {aiToolsData.incrementalROI.m365ToClaudeEnterprise.claudeEnterpriseSources && aiToolsData.incrementalROI.m365ToClaudeEnterprise.claudeEnterpriseSources.length > 0 && (
                        <div className="mt-4 pt-4 border-t border-gray-200">
                          <h5 className="text-xs font-semibold text-gray-700 mb-2">
                            Claude Enterprise Industry Research Sources ({aiToolsData.incrementalROI.m365ToClaudeEnterprise.claudeEnterpriseSources.length} studies):
                          </h5>
                          <div className="space-y-2">
                            {aiToolsData.incrementalROI.m365ToClaudeEnterprise.claudeEnterpriseSources.map((source, idx) => (
                              <div key={idx} className="p-2 bg-purple-50 rounded border border-purple-200 text-xs">
                                <p className="font-semibold text-gray-900">
                                  {source.url && source.url.startsWith('http') ? (
                                    <a href={source.url} target="_blank" rel="noopener noreferrer" className="text-purple-600 hover:underline">
                                      {source.title}
                                    </a>
                                  ) : (
                                    source.title
                                  )}
                                </p>
                                <p className="text-gray-600 mt-1">
                                  {source.author} ({source.year}) ‚Ä¢ Sample: {typeof source.sampleSize === 'number' ? source.sampleSize.toLocaleString() : source.sampleSize} ‚Ä¢ {source.findingHours} hrs/mo
                                  {source.role && <span className="ml-2 px-2 py-0.5 bg-purple-100 text-purple-700 rounded text-xs">{source.role.replace('_', ' ')}</span>}
                                </p>
                              </div>
                            ))}
                          </div>
                        </div>
                      )}
                    </div>
                  </div>

                  <div className="mt-4 p-4 bg-white rounded-lg border border-indigo-200">
                    <p className="text-xs text-gray-700 leading-relaxed">
                      <strong>Methodology:</strong> Incremental ROI compares the additional productivity value gained minus the additional cost when upgrading from baseline tools (GitHub Copilot @ $19/mo, M365 Copilot @ $30/mo) to Claude tools. Industry benchmarks sourced from published research studies with weighted aggregation based on sample size, recency, and credibility. AbsenceSoft's data-driven metrics calculated from actual usage patterns across {aiToolsData.claudeEnterprise.licensedUsers + aiToolsData.m365Copilot.licensedUsers + aiToolsData.claudeCode.licensedUsers} licensed users.
                    </p>
                  </div>
                </div>

                <div>
                  <h3 className="text-xl font-semibold text-gray-900 mb-4">Department Penetration Analysis</h3>
                  <div style={{ height: `${Math.max(400, expansionOpportunities.length * 50)}px` }}>
                    <ResponsiveContainer width="100%" height="100%">
                      <BarChart data={expansionOpportunities.sort((a, b) => b.totalEmployees - a.totalEmployees)} layout="vertical" margin={{ left: 20 }}>
                        <CartesianGrid strokeDasharray="3 3" />
                        <XAxis type="number" />
                        <YAxis dataKey="department" type="category" width={180} tick={{ fontSize: 11 }} interval={0} />
                        <Tooltip />
                        <Legend />
                        <Bar dataKey="currentUsers" fill="#10b981" name="Current Users" stackId="a" />
                        <Bar dataKey="standardGap" fill="#3b82f6" name="Std Gap" stackId="a" />
                        <Bar dataKey="premiumGap" fill="#8b5cf6" name="Premium Gap" stackId="a" />
                      </BarChart>
                    </ResponsiveContainer>
                  </div>
                </div>

                <div className="bg-indigo-50 p-6 rounded-lg border border-indigo-200">
                  <h3 className="text-lg font-semibold text-gray-900 mb-3">Engineering Expansion - Data-Driven Recommendation</h3>
                  {(() => {
                    // Find Engineering departments (Engineering + Agentic AI)
                    const engineeringDept = expansionOpportunities.find(d => d.department === 'Engineering') || {};
                    const agenticDept = expansionOpportunities.find(d => d.department === 'Agentic AI') || {};

                    const totalEng = (engineeringDept.totalEmployees || 0) + (agenticDept.totalEmployees || 0);
                    const currentEng = (engineeringDept.currentUsers || 0) + (agenticDept.currentUsers || 0);
                    const stdGap = (engineeringDept.standardGap || 0) + (agenticDept.standardGap || 0);
                    const premGap = (engineeringDept.premiumGap || 0) + (agenticDept.premiumGap || 0);
                    const upgrades = (engineeringDept.upgradesNeeded || 0) + (agenticDept.upgradesNeeded || 0);
                    const totalCost = (engineeringDept.totalAdditionalCost || 0) + (agenticDept.totalAdditionalCost || 0);
                    const totalValue = (engineeringDept.monthlyOpportunityCost || 0) + (agenticDept.monthlyOpportunityCost || 0);

                    return (
                      <div className="grid grid-cols-2 gap-4">
                        <div className="bg-white p-4 rounded-lg">
                          <p className="text-sm text-gray-600 mb-2">Total Engineering Org</p>
                          <p className="text-2xl font-bold text-gray-900">{totalEng} people</p>
                          <p className="text-xs text-gray-500 mt-1">Ron's Engineering ({engineeringDept.totalEmployees || 0}) + Luis's Agentic AI ({agenticDept.totalEmployees || 0})</p>
                        </div>
                        <div className="bg-white p-4 rounded-lg">
                          <p className="text-sm text-gray-600 mb-2">Current Coverage</p>
                          <p className="text-2xl font-bold text-purple-600">{currentEng} users ({Math.round((currentEng / totalEng) * 100)}%)</p>
                          <p className="text-xs text-gray-500 mt-1">All Standard seats currently</p>
                        </div>
                        <div className="bg-white p-4 rounded-lg">
                          <p className="text-sm text-gray-600 mb-2">Recommended Add: Standard</p>
                          <p className="text-2xl font-bold text-blue-600">{stdGap} seats</p>
                          <p className="text-xs text-gray-500 mt-1">For typical usage patterns</p>
                        </div>
                        <div className="bg-white p-4 rounded-lg">
                          <p className="text-sm text-gray-600 mb-2">Recommended Add: Premium</p>
                          <p className="text-2xl font-bold text-purple-600">{premGap} seats</p>
                          <p className="text-xs text-gray-500 mt-1">{upgrades} upgrades from Standard based on power user scoring</p>
                        </div>
                        <div className="bg-white p-4 rounded-lg">
                          <p className="text-sm text-gray-600 mb-2">Monthly Investment</p>
                          <p className="text-2xl font-bold text-indigo-600">${totalCost.toLocaleString()}</p>
                          <p className="text-xs text-gray-500 mt-1">{stdGap} Std (${stdGap * 40}) + {upgrades} upgrades (${upgrades * 160})</p>
                        </div>
                        <div className="bg-white p-4 rounded-lg">
                          <p className="text-sm text-gray-600 mb-2">Annual Value Generated</p>
                          <p className="text-2xl font-bold text-green-700">${(totalValue * 12).toLocaleString()}</p>
                          <p className="text-xs text-gray-500 mt-1">ROI: {totalCost > 0 ? (totalValue / totalCost).toFixed(1) : 0}x</p>
                        </div>
                      </div>
                    );
                  })()}
                  <div className="mt-4 p-3 bg-green-50 rounded border border-green-200">
                    <p className="text-xs text-gray-700">
                      <strong>Data-Driven Approach:</strong> Behavioral scoring (code writing, engagement, documents, complex work) identifies power users who truly need Premium. Most engineers can be highly productive with Standard seats.
                    </p>
                  </div>
                </div>
              </div>
            )}

            {/* M365 Copilot Deep Dive Tab */}
            {activeTab === 'm365' && aiToolsData.m365CopilotDeepDive && (
              <div className="space-y-6">
                {/* Executive Summary KPIs */}
                <div>
                  <h3 className="text-xl font-semibold text-gray-900 mb-4">M365 Copilot Usage Overview (since August 2025)</h3>
                  <div className="grid grid-cols-1 md:grid-cols-5 gap-4 mb-6">
                    <MetricCard
                      title="Total Active Users"
                      value={aiToolsData.m365CopilotDeepDive.summaryMetrics.totalActiveUsers}
                      changeLabel="Past 180 days (6 months)"
                      icon={Users}
                      color="blue"
                    />
                    <MetricCard
                      title="Avg Prompts/Day"
                      value={aiToolsData.m365CopilotDeepDive.summaryMetrics.avgPromptsPerDay.toFixed(1)}
                      changeLabel="Per active day (when user was active)"
                      icon={MessageSquare}
                      color="green"
                    />
                    <MetricCard
                      title="Active Days per Week"
                      value={`${aiToolsData.m365CopilotDeepDive.summaryMetrics.avgActiveDaysPerWeek} days/week`}
                      changeLabel={`${aiToolsData.m365CopilotDeepDive.summaryMetrics.avgActiveDays} days over 180 days`}
                      icon={TrendingUp}
                      color="purple"
                    />
                    <MetricCard
                      title="Most Used App"
                      value={aiToolsData.m365CopilotDeepDive.summaryMetrics.mostUsedApp}
                      changeLabel={`${aiToolsData.m365CopilotDeepDive.appAdoption[0].percent}% adoption`}
                      icon={Award}
                      color="indigo"
                    />
                    <MetricCard
                      title="Content Creation (Approx.)"
                      value={aiToolsData.m365Copilot.approximateArtifacts}
                      changeLabel={`${latestMonthLabel} MTD (20% √ó ${aiToolsData.m365Copilot.wordExcelPowerpointAdoptionFactor}% W/E/P adoption)`}
                      icon={FileText}
                      color="amber"
                    />
                  </div>
                  <div className="mb-6 p-4 bg-amber-50 border border-amber-200 rounded-lg">
                    <p className="text-sm text-amber-800">
                      <strong>Methodology:</strong> {aiToolsData.m365Copilot.artifactsNote} Focuses exclusively on Word/Excel/PowerPoint document creation.
                    </p>
                  </div>
                </div>

                {/* Monthly Growth Trends */}
                <div>
                  <h3 className="text-xl font-semibold text-gray-900 mb-4">Monthly Growth Trends</h3>
                  <div className="h-80">
                    <ResponsiveContainer width="100%" height="100%">
                      <AreaChart data={aiToolsData.m365Copilot.monthlyTrend.map(m => ({
                        month: m.monthLabel,
                        activeUsers: m.users,
                        prompts: m.totalPrompts,
                        artifacts: Math.round((m.contentAppPrompts || 0) * 0.20 * (aiToolsData.m365Copilot.wordExcelPowerpointAdoptionFactor / 100))
                      }))}>
                        <defs>
                          <linearGradient id="colorM365Users" x1="0" y1="0" x2="0" y2="1">
                            <stop offset="5%" stopColor="#3b82f6" stopOpacity={0.8}/>
                            <stop offset="95%" stopColor="#3b82f6" stopOpacity={0}/>
                          </linearGradient>
                          <linearGradient id="colorM365Prompts" x1="0" y1="0" x2="0" y2="1">
                            <stop offset="5%" stopColor="#10b981" stopOpacity={0.8}/>
                            <stop offset="95%" stopColor="#10b981" stopOpacity={0}/>
                          </linearGradient>
                          <linearGradient id="colorM365Artifacts" x1="0" y1="0" x2="0" y2="1">
                            <stop offset="5%" stopColor="#f59e0b" stopOpacity={0.8}/>
                            <stop offset="95%" stopColor="#f59e0b" stopOpacity={0}/>
                          </linearGradient>
                        </defs>
                        <CartesianGrid strokeDasharray="3 3" />
                        <XAxis dataKey="month" />
                        <YAxis yAxisId="left" label={{ value: 'Users / Artifacts', angle: -90, position: 'insideLeft' }} />
                        <YAxis yAxisId="right" orientation="right" label={{ value: 'Prompts', angle: 90, position: 'insideRight' }} />
                        <Tooltip />
                        <Legend />
                        <Area yAxisId="left" type="monotone" dataKey="activeUsers" stroke="#3b82f6" strokeWidth={2} fillOpacity={1} fill="url(#colorM365Users)" name="Active Users" />
                        <Area yAxisId="right" type="monotone" dataKey="prompts" stroke="#10b981" strokeWidth={2} fillOpacity={1} fill="url(#colorM365Prompts)" name="Prompts" />
                        <Area yAxisId="left" type="monotone" dataKey="artifacts" stroke="#f59e0b" strokeWidth={2} fillOpacity={1} fill="url(#colorM365Artifacts)" name="Artifacts Generated" />
                      </AreaChart>
                    </ResponsiveContainer>
                  </div>
                </div>

                {/* AI Insights */}
                {aiToolsData.insights?.m365PowerUsers && (
                  <div className="bg-gradient-to-br from-blue-50 to-indigo-50 border border-blue-200 rounded-lg p-6 mb-6">
                    <h3 className="text-xl font-semibold text-gray-900 mb-4 flex items-center">
                      <Target className="h-6 w-6 mr-2 text-blue-600" />
                      Key Insights
                    </h3>
                    <div className="grid grid-cols-1 gap-4">
                      {/* Monthly Growth Trends - Full Width */}
                      {aiToolsData.insights?.m365MonthlyGrowthTrends && (
                        <div className="bg-amber-50 border-l-4 border-amber-500 rounded-lg p-4 shadow-sm">
                          <h4 className="font-semibold text-sm text-gray-700 mb-2">Monthly Growth Trends Analysis</h4>
                          <p className="text-gray-700 text-sm leading-relaxed">{aiToolsData.insights.m365MonthlyGrowthTrends}</p>
                        </div>
                      )}
                      {/* AI Agents Adoption - Full Width */}
                      {aiToolsData.insights?.m365AgentsAdoption && (
                        <div className="bg-purple-50 border-l-4 border-purple-500 rounded-lg p-4 shadow-sm">
                          <h4 className="font-semibold text-sm text-gray-700 mb-2">AI Agents Adoption Analysis (December)</h4>
                          <p className="text-gray-700 text-sm leading-relaxed">{aiToolsData.insights.m365AgentsAdoption}</p>
                        </div>
                      )}
                      {/* Other Insights - 2x2 Grid */}
                      <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div className="bg-white rounded-lg p-4 shadow-sm">
                          <h4 className="font-semibold text-sm text-gray-700 mb-2">Power Users</h4>
                          <p className="text-gray-700 text-sm leading-relaxed">{aiToolsData.insights.m365PowerUsers}</p>
                        </div>
                        <div className="bg-white rounded-lg p-4 shadow-sm">
                          <h4 className="font-semibold text-sm text-gray-700 mb-2">App Adoption</h4>
                          <p className="text-gray-700 text-sm leading-relaxed">{aiToolsData.insights.m365AppAdoption}</p>
                        </div>
                        <div className="bg-white rounded-lg p-4 shadow-sm">
                          <h4 className="font-semibold text-sm text-gray-700 mb-2">Department Performance</h4>
                          <p className="text-gray-700 text-sm leading-relaxed">{aiToolsData.insights.m365DepartmentPerformance}</p>
                        </div>
                        <div className="bg-white rounded-lg p-4 shadow-sm">
                          <h4 className="font-semibold text-sm text-gray-700 mb-2">Opportunities</h4>
                          <p className="text-gray-700 text-sm leading-relaxed">{aiToolsData.insights.m365Opportunities}</p>
                        </div>
                      </div>
                    </div>
                  </div>
                )}

                {/* Power Users Table */}
                <div>
                  <h3 className="text-xl font-semibold text-gray-900 mb-4">Power User Champions (Top 20)</h3>
                  <div className="bg-white rounded-lg shadow-md overflow-hidden">
                    <div className="overflow-x-auto">
                      <table className="min-w-full divide-y divide-gray-200">
                        <thead className="bg-gray-50">
                          <tr>
                            <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Rank</th>
                            <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Name</th>
                            <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Department</th>
                            <th className="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider">Total Prompts</th>
                            <th className="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider">Active Days</th>
                            <th className="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider">Prompts/Day</th>
                            <th className="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider">Apps Used</th>
                          </tr>
                        </thead>
                        <tbody className="bg-white divide-y divide-gray-200">
                          {aiToolsData.m365CopilotDeepDive.powerUsers.map((user) => (
                            <tr key={user.email} className={user.rank <= 3 ? 'bg-yellow-50' : ''}>
                              <td className="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">
                                {user.rank === 1 && 'ü•á'} {user.rank === 2 && 'ü•à'} {user.rank === 3 && 'ü•â'} {user.rank}
                              </td>
                              <td className="px-6 py-4 whitespace-nowrap text-sm text-gray-900">{user.name}</td>
                              <td className="px-6 py-4 whitespace-nowrap text-sm text-gray-600">{user.department}</td>
                              <td className="px-6 py-4 whitespace-nowrap text-sm text-right text-gray-900 font-medium">{user.totalPrompts.toLocaleString()}</td>
                              <td className="px-6 py-4 whitespace-nowrap text-sm text-right text-gray-600">{user.activeDays}</td>
                              <td className="px-6 py-4 whitespace-nowrap text-sm text-right text-gray-900 font-semibold">{user.promptsPerDay}</td>
                              <td className="px-6 py-4 whitespace-nowrap text-sm text-right text-gray-600">{user.appsUsed.length}/7</td>
                            </tr>
                          ))}
                        </tbody>
                      </table>
                    </div>
                  </div>
                </div>

                {/* App Utilization Chart */}
                <div>
                  <h3 className="text-xl font-semibold text-gray-900 mb-4">App-Specific Adoption Rates</h3>
                  <div className="h-80 bg-white rounded-lg shadow-md p-6">
                    <ResponsiveContainer width="100%" height="100%">
                      <BarChart data={aiToolsData.m365CopilotDeepDive.appAdoption} layout="vertical">
                        <CartesianGrid strokeDasharray="3 3" />
                        <XAxis type="number" domain={[0, 100]} />
                        <YAxis dataKey="app" type="category" width={150} />
                        <Tooltip formatter={(value) => `${value}%`} />
                        <Bar dataKey="percent" fill="#3b82f6" label={{ position: 'right', formatter: (val) => `${val}% (${aiToolsData.m365CopilotDeepDive.appAdoption.find(a => a.percent === val)?.users} users)` }} />
                      </BarChart>
                    </ResponsiveContainer>
                  </div>
                </div>

                {/* Usage Intensity Distribution */}
                <div>
                  <h3 className="text-xl font-semibold text-gray-900 mb-4">Usage Intensity Distribution</h3>
                  <div className="h-80 bg-white rounded-lg shadow-md p-6">
                    <ResponsiveContainer width="100%" height="100%">
                      <BarChart data={aiToolsData.m365CopilotDeepDive.intensityDistribution}>
                        <CartesianGrid strokeDasharray="3 3" />
                        <XAxis dataKey="label" />
                        <YAxis />
                        <Tooltip />
                        <Bar dataKey="count" fill="#10b981" label={{ position: 'top' }} />
                      </BarChart>
                    </ResponsiveContainer>
                  </div>
                </div>

                {/* Department Performance Table */}
                <div>
                  <h3 className="text-xl font-semibold text-gray-900 mb-4">Department Performance Benchmarks</h3>
                  <div className="bg-white rounded-lg shadow-md overflow-hidden">
                    <div className="overflow-x-auto">
                      <table className="min-w-full divide-y divide-gray-200">
                        <thead className="bg-gray-50">
                          <tr>
                            <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Department</th>
                            <th className="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider">Users</th>
                            <th className="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider">Avg Prompts</th>
                            <th className="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider">Prompts/Day</th>
                            <th className="px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider">Engagement Level</th>
                          </tr>
                        </thead>
                        <tbody className="bg-white divide-y divide-gray-200">
                          {aiToolsData.m365CopilotDeepDive.departmentPerformance.map((dept) => (
                            <tr key={dept.department}>
                              <td className="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">{dept.department}</td>
                              <td className="px-6 py-4 whitespace-nowrap text-sm text-right text-gray-600">{dept.userCount}</td>
                              <td className="px-6 py-4 whitespace-nowrap text-sm text-right text-gray-900">{dept.avgPrompts.toFixed(0)}</td>
                              <td className="px-6 py-4 whitespace-nowrap text-sm text-right text-gray-900 font-semibold">{dept.avgPromptsPerDay.toFixed(2)}</td>
                              <td className="px-6 py-4 whitespace-nowrap text-center">
                                <span className={`inline-flex px-2 py-1 text-xs font-semibold rounded-full ${
                                  dept.engagementLevel === 'High' ? 'bg-green-100 text-green-800' :
                                  dept.engagementLevel === 'Medium' ? 'bg-yellow-100 text-yellow-800' :
                                  'bg-red-100 text-red-800'
                                }`}>
                                  {dept.engagementLevel}
                                </span>
                              </td>
                            </tr>
                          ))}
                        </tbody>
                      </table>
                    </div>
                  </div>
                </div>

                {/* User Segmentation Pie Chart */}
                <div>
                  <h3 className="text-xl font-semibold text-gray-900 mb-4">User Segmentation by Engagement</h3>
                  <div className="h-80 bg-white rounded-lg shadow-md p-6">
                    <ResponsiveContainer width="100%" height="100%">
                      <PieChart>
                        <Pie
                          data={[
                            { name: `Power Users (${aiToolsData.m365CopilotDeepDive.userSegments.powerUsers.threshold})`, value: aiToolsData.m365CopilotDeepDive.userSegments.powerUsers.count },
                            { name: `Engaged Users (${aiToolsData.m365CopilotDeepDive.userSegments.engagedUsers.threshold})`, value: aiToolsData.m365CopilotDeepDive.userSegments.engagedUsers.count },
                            { name: `Regular Users (${aiToolsData.m365CopilotDeepDive.userSegments.regularUsers.threshold})`, value: aiToolsData.m365CopilotDeepDive.userSegments.regularUsers.count },
                            { name: `Light Users (${aiToolsData.m365CopilotDeepDive.userSegments.lightUsers.threshold})`, value: aiToolsData.m365CopilotDeepDive.userSegments.lightUsers.count }
                          ]}
                          cx="50%"
                          cy="50%"
                          labelLine={false}
                          label={({ name, percent }) => `${name}: ${(percent * 100).toFixed(0)}%`}
                          outerRadius={100}
                          fill="#8884d8"
                          dataKey="value"
                        >
                          {[0, 1, 2, 3].map((entry, index) => (
                            <Cell key={`cell-${index}`} fill={['#10b981', '#3b82f6', '#f59e0b', '#ef4444'][index]} />
                          ))}
                        </Pie>
                        <Tooltip />
                      </PieChart>
                    </ResponsiveContainer>
                  </div>
                </div>

                {/* Opportunity Analysis Cards */}
                <div>
                  <h3 className="text-xl font-semibold text-gray-900 mb-4">Opportunities for Improvement</h3>
                  <div className="grid grid-cols-1 md:grid-cols-3 gap-6">
                    {/* PowerPoint Adoption Gap */}
                    <div className="bg-white rounded-lg shadow-md p-6 border-l-4 border-orange-500">
                      <h4 className="text-lg font-semibold text-gray-900 mb-3 flex items-center">
                        <FileText className="h-5 w-5 mr-2 text-orange-500" />
                        PowerPoint Adoption Gap
                      </h4>
                      <div className="space-y-2">
                        <p className="text-2xl font-bold text-gray-900">{aiToolsData.m365CopilotDeepDive.opportunities.lowPowerPointUsage.gapUsers} users</p>
                        <p className="text-sm text-gray-600">Currently: {aiToolsData.m365CopilotDeepDive.opportunities.lowPowerPointUsage.currentUsers} users</p>
                        <p className="text-sm text-gray-600">Target: {aiToolsData.m365CopilotDeepDive.opportunities.lowPowerPointUsage.targetUsers} users (Word adoption)</p>
                        <p className="text-sm text-green-600 font-medium mt-2">{aiToolsData.m365CopilotDeepDive.opportunities.lowPowerPointUsage.potentialValue}</p>
                      </div>
                    </div>

                    {/* Inactive Licenses */}
                    <div className="bg-white rounded-lg shadow-md p-6 border-l-4 border-red-500">
                      <h4 className="text-lg font-semibold text-gray-900 mb-3 flex items-center">
                        <DollarSign className="h-5 w-5 mr-2 text-red-500" />
                        Inactive Licenses
                      </h4>
                      <div className="space-y-2">
                        <p className="text-2xl font-bold text-gray-900">{aiToolsData.m365CopilotDeepDive.opportunities.inactiveUsers.count} users</p>
                        <p className="text-sm text-gray-600">0 prompts in 180 days</p>
                        <p className="text-sm text-gray-600">Reclaimable: {aiToolsData.m365CopilotDeepDive.opportunities.inactiveUsers.reclaimableLicenses} licenses</p>
                        <p className="text-sm text-green-600 font-medium mt-2">Save ${aiToolsData.m365CopilotDeepDive.opportunities.inactiveUsers.monthlySavings}/month</p>
                      </div>
                    </div>

                    {/* Low Engagement Users */}
                    <div className="bg-white rounded-lg shadow-md p-6 border-l-4 border-yellow-500">
                      <h4 className="text-lg font-semibold text-gray-900 mb-3 flex items-center">
                        <Clock className="h-5 w-5 mr-2 text-yellow-500" />
                        Low Engagement
                      </h4>
                      <div className="space-y-2">
                        <p className="text-2xl font-bold text-gray-900">{aiToolsData.m365CopilotDeepDive.opportunities.lowEngagementUsers.count} users</p>
                        <p className="text-sm text-gray-600">&lt;10 total prompts</p>
                        <p className="text-sm text-gray-600">Departments: {aiToolsData.m365CopilotDeepDive.opportunities.lowEngagementUsers.departments.join(', ')}</p>
                        <p className="text-sm text-green-600 font-medium mt-2">Training opportunity</p>
                      </div>
                    </div>
                  </div>
                </div>

                {/* Low Engagement Users Detail Table */}
                <div>
                  <h3 className="text-xl font-semibold text-gray-900 mb-4">Low Engagement Users - Enablement Targets</h3>
                  <div className="bg-white rounded-lg shadow-md overflow-hidden">
                    <div className="overflow-x-auto">
                      <table className="min-w-full divide-y divide-gray-200">
                        <thead className="bg-gray-50">
                          <tr>
                            <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Name</th>
                            <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Department</th>
                            <th className="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider">Total Prompts</th>
                            <th className="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider">Active Days</th>
                            <th className="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider">Prompts/Day</th>
                          </tr>
                        </thead>
                        <tbody className="bg-white divide-y divide-gray-200">
                          {aiToolsData.m365CopilotDeepDive.opportunities.lowEngagementUsers.users.map((user) => (
                            <tr key={user.email}>
                              <td className="px-6 py-4 whitespace-nowrap text-sm text-gray-900">{user.name}</td>
                              <td className="px-6 py-4 whitespace-nowrap text-sm text-gray-600">{user.department}</td>
                              <td className="px-6 py-4 whitespace-nowrap text-sm text-right text-gray-600">{user.totalPrompts}</td>
                              <td className="px-6 py-4 whitespace-nowrap text-sm text-right text-gray-600">{user.activeDays}</td>
                              <td className="px-6 py-4 whitespace-nowrap text-sm text-right text-gray-600">{user.promptsPerDay.toFixed(2)}</td>
                            </tr>
                          ))}
                        </tbody>
                      </table>
                    </div>
                  </div>
                </div>

                {/* AI Agents Usage Charts */}
                {aiToolsData.m365CopilotDeepDive.agents && (
                  <>
                    {/* Chart 1: Top 10 AI Agents by Usage */}
                    <div>
                      <h3 className="text-xl font-semibold text-gray-900 mb-4">Top 10 AI Agents by Usage (December)</h3>
                      <p className="text-sm text-gray-600 mb-4">
                        Total responses sent across all agents. Color-coded by creator type.
                      </p>
                      <div className="h-96 bg-white rounded-lg shadow-md p-6">
                        <ResponsiveContainer width="100%" height="100%">
                          <BarChart data={aiToolsData.m365CopilotDeepDive.agents.topAgentsByUsage} layout="vertical">
                            <CartesianGrid strokeDasharray="3 3" />
                            <XAxis type="number" />
                            <YAxis dataKey="agentName" type="category" width={200} />
                            <Tooltip
                              formatter={(value, name, props) => {
                                if (name === 'totalResponses') {
                                  return [`${value} responses`, 'Responses'];
                                }
                                return value;
                              }}
                              labelFormatter={(label) => {
                                const agent = aiToolsData.m365CopilotDeepDive.agents.topAgentsByUsage.find(a => a.agentName === label);
                                return agent ? `${label}\n${agent.totalUsers} users ‚Ä¢ ${agent.creatorType}` : label;
                              }}
                            />
                            <Bar dataKey="totalResponses" label={{ position: 'right', formatter: (val) => `${val} responses` }}>
                              {aiToolsData.m365CopilotDeepDive.agents.topAgentsByUsage.map((entry, index) => {
                                const colorMap = {
                                  'User-created agent': '#9333ea',
                                  'Agent built by Microsoft': '#3b82f6',
                                  'Agent built by Microsoft partner': '#10b981',
                                  'Agent built by your org': '#f59e0b'
                                };
                                return <Cell key={`cell-${index}`} fill={colorMap[entry.creatorType] || '#6b7280'} />;
                              })}
                            </Bar>
                          </BarChart>
                        </ResponsiveContainer>
                        <div className="mt-4 flex flex-wrap gap-4 justify-center text-sm">
                          <div className="flex items-center gap-2">
                            <div className="w-4 h-4 rounded" style={{ backgroundColor: '#9333ea' }}></div>
                            <span>User-created agent</span>
                          </div>
                          <div className="flex items-center gap-2">
                            <div className="w-4 h-4 rounded" style={{ backgroundColor: '#3b82f6' }}></div>
                            <span>Microsoft-built</span>
                          </div>
                          <div className="flex items-center gap-2">
                            <div className="w-4 h-4 rounded" style={{ backgroundColor: '#10b981' }}></div>
                            <span>Partner-built</span>
                          </div>
                          <div className="flex items-center gap-2">
                            <div className="w-4 h-4 rounded" style={{ backgroundColor: '#f59e0b' }}></div>
                            <span>Org-built</span>
                          </div>
                        </div>
                      </div>
                    </div>

                    {/* Chart 2: Top 10 AI Agents by Department */}
                    <div>
                      <h3 className="text-xl font-semibold text-gray-900 mb-4">Top 10 AI Agents by Department (December)</h3>
                      <p className="text-sm text-gray-600 mb-4">
                        Which departments drive adoption of each agent. Stacked by department contribution.
                      </p>
                      <div className="h-96 bg-white rounded-lg shadow-md p-6">
                        <ResponsiveContainer width="100%" height="100%">
                          <BarChart
                            data={aiToolsData.m365CopilotDeepDive.agents.topAgentsByDepartment.map(agent => {
                              const deptData = {};
                              agent.byDepartment.forEach(dept => {
                                deptData[dept.department] = dept.responses;
                              });
                              // Truncate long agent names
                              const truncatedName = agent.agentName.length > 25
                                ? agent.agentName.substring(0, 25) + '...'
                                : agent.agentName;
                              return {
                                agentName: truncatedName,
                                fullAgentName: agent.agentName,
                                ...deptData,
                                totalResponses: agent.totalResponses
                              };
                            })}
                            layout="vertical"
                            margin={{ left: 20 }}
                          >
                            <CartesianGrid strokeDasharray="3 3" />
                            <XAxis type="number" />
                            <YAxis dataKey="agentName" type="category" width={200} style={{ fontSize: '12px' }} />
                            <Tooltip
                              formatter={(value, name) => [`${value} responses`, name]}
                              labelFormatter={(label) => {
                                // Find by truncated name, show full name in tooltip
                                const chartData = aiToolsData.m365CopilotDeepDive.agents.topAgentsByDepartment.map(agent => {
                                  const truncated = agent.agentName.length > 25 ? agent.agentName.substring(0, 25) + '...' : agent.agentName;
                                  return { truncated, full: agent.agentName, total: agent.totalResponses };
                                });
                                const match = chartData.find(d => d.truncated === label);
                                return match ? `${match.full} (${match.total} total responses)` : label;
                              }}
                            />
                            <Legend />
                            {(() => {
                              // Get all unique departments across all agents
                              const allDepartments = new Set();
                              aiToolsData.m365CopilotDeepDive.agents.topAgentsByDepartment.forEach(agent => {
                                agent.byDepartment.forEach(dept => allDepartments.add(dept.department));
                              });

                              // Define department colors
                              const departmentColors = {
                                'Marketing': '#ec4899',
                                'Engineering': '#3b82f6',
                                'Sales - Enterprise': '#10b981',
                                'Sales - Large Market': '#14b8a6',
                                'Customer Success': '#8b5cf6',
                                'Professional Services': '#f59e0b',
                                'Product': '#6366f1',
                                'Operations': '#ef4444',
                                'Finance': '#84cc16',
                                'Human Resources': '#06b6d4',
                                'Agentic AI': '#a855f7',
                                'Executive': '#64748b',
                                'Legal': '#0ea5e9',
                                'IT': '#f97316',
                                'Revenue Operations': '#d946ef',
                                'Partnerships': '#22c55e'
                              };

                              return Array.from(allDepartments).map((dept, idx) => (
                                <Bar
                                  key={dept}
                                  dataKey={dept}
                                  stackId="a"
                                  fill={departmentColors[dept] || `hsl(${(idx * 360) / allDepartments.size}, 70%, 50%)`}
                                />
                              ));
                            })()}
                          </BarChart>
                        </ResponsiveContainer>
                      </div>
                    </div>

                    {/* Key Insights: M365 AI Agents Adoption */}
                    <div className="bg-white rounded-lg shadow-md border border-gray-100 p-6">
                      <h3 className="text-xl font-semibold text-gray-900 mb-4">Key Insights: M365 AI Agents Adoption</h3>

                      {/* AI-Generated Agents Adoption Insight */}
                      {aiToolsData.insights?.m365AgentsAdoption ? (
                        <div className="bg-gradient-to-r from-blue-50 to-indigo-50 p-4 rounded-lg border border-blue-200 mb-4">
                          <p className="text-sm text-gray-900 leading-relaxed">
                            <strong>AI Agents Analysis:</strong> {aiToolsData.insights.m365AgentsAdoption}
                          </p>
                        </div>
                      ) : (
                        <div className="bg-gray-50 p-4 rounded-lg border border-gray-200 mb-4">
                          <p className="text-sm text-gray-500 italic">
                            AI-generated insights about M365 Agents adoption, department usage patterns, and business value will appear here when data is available.
                          </p>
                        </div>
                      )}

                      {/* Key Metrics Summary */}
                      <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <div className="bg-purple-50 p-4 rounded-lg border border-purple-200">
                          <p className="text-xs text-purple-600 font-medium mb-1">Total Agent Interactions</p>
                          <p className="text-2xl font-bold text-purple-900">
                            {aiToolsData.m365CopilotDeepDive.agents.topAgentsByUsage.reduce((sum, a) => sum + a.totalResponses, 0).toLocaleString()}
                          </p>
                          <p className="text-xs text-purple-600 mt-1">responses across all agents</p>
                        </div>
                        <div className="bg-blue-50 p-4 rounded-lg border border-blue-200">
                          <p className="text-xs text-blue-600 font-medium mb-1">Active Agents</p>
                          <p className="text-2xl font-bold text-blue-900">
                            {aiToolsData.m365CopilotDeepDive.agents.topAgentsByUsage.length}
                          </p>
                          <p className="text-xs text-blue-600 mt-1">agents with recorded usage</p>
                        </div>
                        <div className="bg-green-50 p-4 rounded-lg border border-green-200">
                          <p className="text-xs text-green-600 font-medium mb-1">User-Created Agents</p>
                          <p className="text-2xl font-bold text-green-900">
                            {aiToolsData.m365CopilotDeepDive.agents.creatorTypeBreakdown['User-created agent'] || 0}
                          </p>
                          <p className="text-xs text-green-600 mt-1">of {aiToolsData.m365CopilotDeepDive.agents.totalAgentUserCombinations} total combinations</p>
                        </div>
                      </div>
                    </div>
                  </>
                )}
              </div>
            )}

          {/* Overview Landing Page - Home Tab */}
          {activeTab === 'overview-home' && (
            <div className="space-y-6">
              {/* Section 1: Hero - 5 KPI Cards */}
              <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-6">
                {/* Card 1: AI Licenses per Employee */}
                <div className="bg-white rounded-lg shadow-md p-6">
                  <div className="flex items-center justify-between">
                    <div>
                      <p className="text-sm text-gray-600 mb-1">AI Licenses / Employee</p>
                      <p className="text-3xl font-bold text-blue-600">
                        {(() => {
                          // Claude Code licenses are Premium CE users (subset of CE total)
                          const cePremium = aiToolsData.claudeCode.licensedUsers; // 11
                          // Claude Enterprise Standard = Total CE - Premium (those with Code)
                          const ceStandard = aiToolsData.claudeEnterprise.licensedUsers - cePremium; // 87 - 11 = 76
                          // M365 and GitHub
                          const m365 = aiToolsData.m365Copilot.licensedUsers;
                          const github = aiToolsData.githubCopilot.activeUsers; // 46 actual licenses

                          const totalLicenses = ceStandard + cePremium + m365 + github;
                          const totalEmployees = aiToolsData.orgMetrics.totalEmployees;
                          const ratio = totalLicenses / totalEmployees;

                          return ratio.toFixed(1);
                        })()}
                      </p>
                      <p className="text-xs text-gray-500 mt-1">
                        {(() => {
                          const cePremium = aiToolsData.claudeCode.licensedUsers;
                          const ceStandard = aiToolsData.claudeEnterprise.licensedUsers - cePremium;
                          const m365 = aiToolsData.m365Copilot.licensedUsers;
                          const github = aiToolsData.githubCopilot.activeUsers;
                          const totalLicenses = ceStandard + cePremium + m365 + github;
                          return `${totalLicenses} total licenses across all tools`;
                        })()}
                      </p>
                    </div>
                    <Users className="w-12 h-12 text-blue-600 opacity-20" />
                  </div>
                </div>

                {/* Card 2: Adoption */}
                <div className="bg-white rounded-lg shadow-md p-6">
                  <div className="flex items-center justify-between">
                    <div className="w-full">
                      <p className="text-sm text-gray-600 mb-1">Adoption</p>
                      {(() => {
                        // Calculate blended adoption across all tools - use latest and previous months
                        const ceLatest = aiToolsData.claudeEnterprise.monthlyTrend?.[aiToolsData.claudeEnterprise.monthlyTrend.length - 1];
                        const m365Latest = aiToolsData.m365Copilot.monthlyTrend?.[aiToolsData.m365Copilot.monthlyTrend.length - 1];
                        const ghLatest = aiToolsData.githubCopilot.monthlyTrend?.[aiToolsData.githubCopilot.monthlyTrend.length - 1];
                        const ccLatest = aiToolsData.claudeCode.monthlyTrend?.[aiToolsData.claudeCode.monthlyTrend.length - 1];

                        const cePrevious = aiToolsData.claudeEnterprise.monthlyTrend?.[aiToolsData.claudeEnterprise.monthlyTrend.length - 2];
                        const m365Previous = aiToolsData.m365Copilot.monthlyTrend?.[aiToolsData.m365Copilot.monthlyTrend.length - 2];
                        const ghPrevious = aiToolsData.githubCopilot.monthlyTrend?.[aiToolsData.githubCopilot.monthlyTrend.length - 2];
                        const ccPrevious = aiToolsData.claudeCode.monthlyTrend?.[aiToolsData.claudeCode.monthlyTrend.length - 2];

                        // Active users per tool (latest month)
                        const ceActiveUsers = ceLatest?.users || 0;
                        const m365ActiveUsers = m365Latest?.users || 0;
                        const ghActiveUsers = ghLatest?.users || 0;
                        const ccActiveUsers = ccLatest?.users || 0;

                        // Previous month active users
                        const ceActiveNov = cePrevious?.users || 0;
                        const m365ActiveNov = m365Previous?.users || 0;
                        const ghActiveNov = ghPrevious?.users || 0;
                        const ccActiveNov = ccPrevious?.users || 0;

                        // Licensed users per tool
                        const ceLicenses = aiToolsData.claudeEnterprise.licensedUsers;
                        const m365Licenses = aiToolsData.m365Copilot.licensedUsers;
                        const ghLicenses = aiToolsData.githubCopilot.activeUsers; // GitHub active users = licenses
                        const ccLicenses = aiToolsData.claudeCode.licensedUsers;

                        // Total active and total licenses
                        const totalActiveUsers = ceActiveUsers + m365ActiveUsers + ghActiveUsers + ccActiveUsers;
                        const totalLicenses = ceLicenses + m365Licenses + ghLicenses + ccLicenses;
                        const blendedAdoption = Math.round((totalActiveUsers / totalLicenses) * 100);

                        // MoM change for blended adoption
                        const totalActiveNov = ceActiveNov + m365ActiveNov + ghActiveNov + ccActiveNov;
                        const adoptionNov = Math.round((totalActiveNov / totalLicenses) * 100);
                        const adoptionChange = blendedAdoption - adoptionNov;

                        // Per-tool adoption rates
                        const ceAdoption = Math.round((ceActiveUsers / ceLicenses) * 100);
                        const m365Adoption = Math.round((m365ActiveUsers / m365Licenses) * 100);
                        const ghAdoption = Math.round((ghActiveUsers / ghLicenses) * 100);
                        const ccAdoption = Math.round((ccActiveUsers / ccLicenses) * 100);

                        return (
                          <>
                            <div className="flex items-baseline gap-2 mb-3">
                              <p className="text-3xl font-bold text-purple-600">{blendedAdoption}%</p>
                              <span className={`text-sm font-semibold ${adoptionChange >= 0 ? 'text-green-600' : 'text-red-600'}`}>
                                {adoptionChange >= 0 ? '‚Üë' : '‚Üì'} {Math.abs(adoptionChange)}%
                              </span>
                            </div>
                            <div className="space-y-1">
                              <div className="flex justify-between items-center text-xs">
                                <span className="text-gray-600">Claude Enterprise:</span>
                                <span className="font-semibold text-blue-600">{ceAdoption}%</span>
                              </div>
                              <div className="flex justify-between items-center text-xs">
                                <span className="text-gray-600">M365 Copilot:</span>
                                <span className="font-semibold text-purple-600">{m365Adoption}%</span>
                              </div>
                              <div className="flex justify-between items-center text-xs">
                                <span className="text-gray-600">GitHub Copilot:</span>
                                <span className="font-semibold text-green-600">{ghAdoption}%</span>
                              </div>
                              <div className="flex justify-between items-center text-xs">
                                <span className="text-gray-600">Claude Code:</span>
                                <span className="font-semibold text-orange-600">{ccAdoption}%</span>
                              </div>
                            </div>
                          </>
                        );
                      })()}
                    </div>
                    <TrendingUp className="w-12 h-12 text-purple-600 opacity-20" />
                  </div>
                </div>

                {/* Card 3a: Prompts/Messages */}
                <div className="bg-white rounded-lg shadow-md p-6">
                  <div className="flex items-center justify-between">
                    <div>
                      <p className="text-sm text-gray-600 mb-1">Prompts/Messages</p>
                      {(() => {
                        const ceLatest = aiToolsData.claudeEnterprise.monthlyTrend?.[aiToolsData.claudeEnterprise.monthlyTrend.length - 1];
                        const m365Latest = aiToolsData.m365Copilot.monthlyTrend?.[aiToolsData.m365Copilot.monthlyTrend.length - 1];
                        const cePrevious = aiToolsData.claudeEnterprise.monthlyTrend?.[aiToolsData.claudeEnterprise.monthlyTrend.length - 2];
                        const m365Previous = aiToolsData.m365Copilot.monthlyTrend?.[aiToolsData.m365Copilot.monthlyTrend.length - 2];

                        const latestTotal = (ceLatest?.messages || 0) + (m365Latest?.totalPrompts || 0);
                        const previousTotal = (cePrevious?.messages || 0) + (m365Previous?.totalPrompts || 0);
                        const percentChange = previousTotal > 0 ? ((latestTotal - previousTotal) / previousTotal) * 100 : 0;
                        const isPositive = percentChange >= 0;

                        return (
                          <>
                            <div className="flex items-baseline gap-2">
                              <p className="text-3xl font-bold text-green-600">
                                {Math.round(latestTotal / 1000)}k
                              </p>
                              {previousTotal > 0 && (
                                <span className={`text-sm font-semibold ${isPositive ? 'text-green-600' : 'text-red-600'}`}>
                                  {isPositive ? '‚Üë' : '‚Üì'} {Math.abs(percentChange).toFixed(1)}%
                                </span>
                              )}
                            </div>
                            <p className="text-xs text-gray-500 mt-1">
                              CE + M365 Copilot messages (MoM)
                            </p>
                          </>
                        );
                      })()}
                    </div>
                    <MessageSquare className="w-12 h-12 text-green-600 opacity-20" />
                  </div>
                </div>

                {/* Card 3b: Lines of Code */}
                <div className="bg-white rounded-lg shadow-md p-6">
                  <div className="flex items-center justify-between">
                    <div>
                      <p className="text-sm text-gray-600 mb-1">Lines of Code</p>
                      {(() => {
                        const ghLatest = aiToolsData.githubCopilot.monthlyTrend?.[aiToolsData.githubCopilot.monthlyTrend.length - 1];
                        const ccLatest = aiToolsData.claudeCode.monthlyTrend?.[aiToolsData.claudeCode.monthlyTrend.length - 1];
                        const ghPrevious = aiToolsData.githubCopilot.monthlyTrend?.[aiToolsData.githubCopilot.monthlyTrend.length - 2];
                        const ccPrevious = aiToolsData.claudeCode.monthlyTrend?.[aiToolsData.claudeCode.monthlyTrend.length - 2];

                        const latestLines = (ghLatest?.totalLines || 0) + (ccLatest?.totalLines || 0);
                        const previousLines = (ghPrevious?.totalLines || 0) + (ccPrevious?.totalLines || 0);
                        const percentChange = previousLines > 0 ? ((latestLines - previousLines) / previousLines) * 100 : 0;
                        const isPositive = percentChange >= 0;

                        return (
                          <>
                            <div className="flex items-baseline gap-2">
                              <p className="text-3xl font-bold text-indigo-600">
                                {Math.round(latestLines / 1000)}k
                              </p>
                              {previousLines > 0 && (
                                <span className={`text-sm font-semibold ${isPositive ? 'text-green-600' : 'text-red-600'}`}>
                                  {isPositive ? '‚Üë' : '‚Üì'} {Math.abs(percentChange).toFixed(1)}%
                                </span>
                              )}
                            </div>
                            <p className="text-xs text-gray-500 mt-1">
                              GitHub + Claude Code generated (MoM)
                            </p>
                          </>
                        );
                      })()}
                    </div>
                    <Code className="w-12 h-12 text-indigo-600 opacity-20" />
                  </div>
                </div>

                {/* Card 4: Portfolio ROI - Incremental */}
                <div className="bg-white rounded-lg shadow-md p-6">
                  <div className="flex items-center justify-between">
                    <div className="w-full">
                      <p className="text-sm text-gray-600 mb-1">Portfolio ROI</p>
                      <p className="text-3xl font-bold text-orange-600 mb-3">{incrementalMetrics.portfolio.blendedROI}x</p>
                      <div className="space-y-1">
                        <div className="flex justify-between items-center text-xs">
                          <span className="text-gray-600">GitHub ‚Üí Claude Code:</span>
                          <span className="font-semibold text-blue-600">
                            {incrementalMetrics.engineersGain.roi.toFixed(1)}x
                            {aiToolsData.incrementalROI.githubToClaudeCode.additive.roiComparison?.deltaPercent !== null && aiToolsData.incrementalROI.githubToClaudeCode.additive.roiComparison?.deltaPercent !== undefined && (
                              <span className={`ml-1 ${aiToolsData.incrementalROI.githubToClaudeCode.additive.roiComparison.deltaPercent >= 0 ? 'text-green-600' : 'text-red-600'}`}>
                                ({aiToolsData.incrementalROI.githubToClaudeCode.additive.roiComparison.deltaPercent >= 0 ? '+' : ''}{aiToolsData.incrementalROI.githubToClaudeCode.additive.roiComparison.deltaPercent}%)
                              </span>
                            )}
                          </span>
                        </div>
                        <div className="flex justify-between items-center text-xs">
                          <span className="text-gray-600">M365 ‚Üí Claude Ent:</span>
                          <span className="font-semibold text-purple-600">
                            {incrementalMetrics.otherRolesGain.roi.toFixed(1)}x
                            {aiToolsData.incrementalROI.m365ToClaudeEnterprise.additive.roiComparison?.deltaPercent !== null && aiToolsData.incrementalROI.m365ToClaudeEnterprise.additive.roiComparison?.deltaPercent !== undefined && (
                              <span className={`ml-1 ${aiToolsData.incrementalROI.m365ToClaudeEnterprise.additive.roiComparison.deltaPercent >= 0 ? 'text-green-600' : 'text-red-600'}`}>
                                ({aiToolsData.incrementalROI.m365ToClaudeEnterprise.additive.roiComparison.deltaPercent >= 0 ? '+' : ''}{aiToolsData.incrementalROI.m365ToClaudeEnterprise.additive.roiComparison.deltaPercent}%)
                              </span>
                            )}
                          </span>
                        </div>
                      </div>
                      <p className="text-xs text-gray-500 mt-2 italic">% comparisons are from industry benchmarks</p>
                    </div>
                    <DollarSign className="w-12 h-12 text-orange-600 opacity-20" />
                  </div>
                </div>
              </div>

              {/* Section 2A: Productivity Tools */}
              <div className="bg-white rounded-lg shadow-md p-6">
                <h3 className="text-lg font-semibold text-gray-900 mb-4">Productivity Tools</h3>
                <p className="text-xs text-gray-500 mb-4">{latestMonthLabel} {latestMonthYear}: Adoption rates, activity & artifacts</p>
                <div className="space-y-6">
                  {(() => {
                    // M365 Copilot - using September data (latest available)
                    const m365Trend = aiToolsData.m365Copilot.monthlyTrend;
                    const m365Latest = m365Trend[m365Trend.length - 1]; // September
                    const m365Previous = m365Trend.length > 1 ? m365Trend[m365Trend.length - 2] : null;
                    const m365AdoptionRate = (m365Latest.users / aiToolsData.m365Copilot.licensedUsers) * 100;
                    const m365PrevRate = m365Previous ? (m365Previous.users / aiToolsData.m365Copilot.licensedUsers) * 100 : null;
                    const m365Change = m365PrevRate ? m365AdoptionRate - m365PrevRate : null;
                    const m365Activity = m365Latest.totalPrompts; // Chat activity
                    const m365PrevActivity = m365Previous ? m365Previous.totalPrompts : null;
                    const m365ActivityChange = m365PrevActivity ? ((m365Activity - m365PrevActivity) / m365PrevActivity) * 100 : null;

                    // Use generated approximateArtifacts (20% √ó W/E/P adoption factor)
                    const m365Artifacts = aiToolsData.m365Copilot.approximateArtifacts;

                    // Calculate previous month artifacts using same methodology
                    const m365PrevArtifacts = m365Previous ? (() => {
                      // Get previous month's content app prompts
                      const prevContentAppPrompts = m365Previous.contentAppPrompts || 0;
                      // Apply same conversion rate and adoption factor
                      return Math.round(prevContentAppPrompts * 0.20 * (aiToolsData.m365Copilot.wordExcelPowerpointAdoptionFactor / 100));
                    })() : null;
                    const m365ArtifactsChange = m365PrevArtifacts ? ((m365Artifacts - m365PrevArtifacts) / m365PrevArtifacts) * 100 : null;

                    // Claude Enterprise - December
                    const ceTrend = aiToolsData.claudeEnterprise.monthlyTrend;
                    const ceLatest = ceTrend[ceTrend.length - 1]; // December
                    const cePrevious = ceTrend.length > 1 ? ceTrend[ceTrend.length - 2] : null;
                    const ceAdoptionRate = (ceLatest.users / aiToolsData.claudeEnterprise.licensedUsers) * 100;
                    const cePrevRate = cePrevious ? (cePrevious.users / aiToolsData.claudeEnterprise.licensedUsers) * 100 : null;
                    const ceChange = cePrevRate ? ceAdoptionRate - cePrevRate : null;
                    const ceActivity = ceLatest.messages; // Prompt activity (messages, not conversations)
                    const cePrevActivity = cePrevious ? cePrevious.messages : null;
                    const ceActivityChange = cePrevActivity ? ((ceActivity - cePrevActivity) / cePrevActivity) * 100 : null;
                    const ceArtifacts = ceLatest.artifacts; // Artifacts created
                    const cePrevArtifacts = cePrevious ? cePrevious.artifacts : null;
                    const ceArtifactsChange = cePrevArtifacts ? ((ceArtifacts - cePrevArtifacts) / cePrevArtifacts) * 100 : null;

                    // Calculate totals
                    const totalChats = m365Activity + ceActivity;
                    const totalArtifacts = m365Artifacts + ceArtifacts;

                    const totalEmployees = aiToolsData.orgMetrics.totalEmployees;

                    // Calculate total developers (Engineering + Product + Agentic AI) from department breakdown
                    const totalDevelopers = (() => {
                      const depts = aiToolsData.claudeEnterprise.departmentBreakdown || [];
                      const engineering = depts.find(d => d.department === 'Engineering');
                      const product = depts.find(d => d.department === 'Product');
                      const agenticAI = depts.find(d => d.department === 'Agentic AI');

                      // Return sum of employee counts (using users as proxy since we don't have explicit employee counts)
                      // Note: In production this should use actual employee counts from org hierarchy
                      return 100; // Engineering: 77 + Product: 17 + Agentic AI: 6 = 100
                    })();

                    const prodTools = [
                      {
                        tool: 'M365 Copilot',
                        adoptionRate: m365AdoptionRate,
                        activeUsers: m365Latest.users,
                        licensedUsers: aiToolsData.m365Copilot.licensedUsers,
                        monthLabel: m365Latest.monthLabel,
                        change: m365Change,
                        activity: m365Activity,
                        activityPercent: (m365Activity / totalChats) * 100,
                        activityChange: m365ActivityChange,
                        artifacts: m365Artifacts,
                        artifactsPercent: totalArtifacts > 0 ? (m365Artifacts / totalArtifacts) * 100 : 0,
                        artifactsChange: m365ArtifactsChange,
                        coverageRate: (aiToolsData.m365Copilot.licensedUsers / totalEmployees) * 100,
                        color: '#0078d4'
                      },
                      {
                        tool: 'Claude Enterprise',
                        adoptionRate: ceAdoptionRate,
                        activeUsers: ceLatest.users,
                        licensedUsers: aiToolsData.claudeEnterprise.licensedUsers,
                        monthLabel: ceLatest.monthLabel,
                        change: ceChange,
                        activity: ceActivity,
                        activityPercent: (ceActivity / totalChats) * 100,
                        activityChange: ceActivityChange,
                        artifacts: ceArtifacts,
                        artifactsPercent: totalArtifacts > 0 ? (ceArtifacts / totalArtifacts) * 100 : 0,
                        artifactsChange: ceArtifactsChange,
                        coverageRate: (aiToolsData.claudeEnterprise.licensedUsers / totalEmployees) * 100,
                        color: '#3b82f6'
                      }
                    ];

                    return prodTools.map(({ tool, adoptionRate, activeUsers, licensedUsers, monthLabel, change, activity, activityPercent, activityChange, artifacts, artifactsPercent, artifactsChange, coverageRate, color }) => (
                      <div key={tool} className="space-y-2">
                        <div className="flex justify-between text-sm">
                          <span className="font-medium text-gray-700">{tool}</span>
                        </div>

                        {/* Coverage Rate Bar */}
                        <div>
                          <div className="flex justify-between text-xs text-gray-500 mb-1">
                            <span>Coverage Rate</span>
                            <div className="flex items-center gap-2">
                              <span className="text-gray-400">
                                {licensedUsers} / {totalEmployees} employees
                              </span>
                              <span>{monthLabel}</span>
                            </div>
                          </div>
                          <div className="w-full bg-gray-200 rounded-full h-5">
                            <div
                              className="h-5 rounded-full flex items-center justify-end pr-2 transition-all"
                              style={{
                                width: `${Math.min(coverageRate, 100)}%`,
                                backgroundColor: '#3b82f6',
                                minWidth: coverageRate > 0 ? '50px' : '0px'
                              }}
                            >
                              <span className="text-xs font-semibold text-white">
                                {coverageRate.toFixed(1)}%
                              </span>
                            </div>
                          </div>
                        </div>

                        {/* Adoption Rate Bar */}
                        <div>
                          <div className="flex justify-between text-xs text-gray-500 mb-1">
                            <span>Adoption Rate</span>
                            <div className="flex items-center gap-2">
                              <span className="text-gray-600">{activeUsers} / {licensedUsers} users</span>
                              <span>{monthLabel}</span>
                              {change !== null && (
                                <span className={`text-xs font-semibold ${change > 0 ? 'text-green-600' : change === 0 ? 'text-yellow-600' : 'text-red-600'}`}>
                                  {change !== 0 && (change > 0 ? '‚Üë ' : '‚Üì ')}{Math.abs(change).toFixed(1)}%
                                </span>
                              )}
                            </div>
                          </div>
                          <div className="w-full bg-gray-200 rounded-full h-5">
                            <div
                              className="h-5 rounded-full flex items-center justify-end pr-2 transition-all"
                              style={{
                                width: `${Math.min(adoptionRate, 100)}%`,
                                backgroundColor: adoptionRate >= 70 ? '#10b981' : adoptionRate >= 30 ? '#eab308' : '#ef4444',
                                minWidth: adoptionRate > 0 ? '50px' : '0px'
                              }}
                            >
                              <span className="text-xs font-semibold text-white">
                                {Math.round(adoptionRate)}%
                              </span>
                            </div>
                          </div>
                        </div>

                        {/* Prompt Activity Distribution Bar */}
                        <div>
                          <div className="flex justify-between text-xs text-gray-500 mb-1">
                            <span>Prompt Activity Distribution</span>
                            <div className="flex items-center gap-2">
                              <span className="text-gray-400">
                                {activity >= 1000 ? `${Math.round(activity / 1000)}k` : activity} prompts
                              </span>
                              <span>{monthLabel}</span>
                              {activityChange !== null && (
                                <span className={`text-xs font-semibold ${activityChange >= 0 ? 'text-green-600' : 'text-red-600'}`}>
                                  {activityChange >= 0 ? '‚Üë' : '‚Üì'} {Math.abs(activityChange).toFixed(1)}%
                                </span>
                              )}
                            </div>
                          </div>
                          <div className="w-full bg-gray-200 rounded-full h-5">
                            <div
                              className="h-5 rounded-full flex items-center justify-end pr-2 transition-all"
                              style={{
                                width: `${activityPercent}%`,
                                backgroundColor: activityPercent >= 70 ? '#10b981' : activityPercent >= 30 ? '#eab308' : '#ef4444',
                                opacity: 0.7,
                                minWidth: activityPercent > 0 ? '50px' : '0px'
                              }}
                            >
                              <span className="text-xs font-semibold text-white">
                                {activityPercent.toFixed(1)}%
                              </span>
                            </div>
                          </div>
                        </div>

                        {/* Artifacts / Content Generated Bar */}
                        <div>
                          <div className="flex justify-between text-xs text-gray-500 mb-1">
                            <span>Artifacts / Content Generated ({latestMonthLabel} MTD) {tool === 'M365 Copilot' && <span className="text-gray-400">(20% √ó {aiToolsData.m365Copilot.wordExcelPowerpointAdoptionFactor}% W/E/P adoption)</span>}</span>
                            <div className="flex items-center gap-2">
                              <span className="text-gray-400">
                                {artifacts} artifacts
                              </span>
                              <span>{monthLabel}</span>
                              {artifactsChange !== null && (
                                <span className={`text-xs font-semibold ${artifactsChange > 0 ? 'text-green-600' : artifactsChange === 0 ? 'text-yellow-600' : 'text-red-600'}`}>
                                  {artifactsChange !== 0 && (artifactsChange > 0 ? '‚Üë ' : '‚Üì ')}{Math.abs(artifactsChange).toFixed(1)}%
                                </span>
                              )}
                            </div>
                          </div>
                          <div className="w-full bg-gray-200 rounded-full h-5">
                            <div
                              className="h-5 rounded-full flex items-center justify-end pr-2 transition-all"
                              style={{
                                width: `${artifactsPercent}%`,
                                backgroundColor: artifactsPercent >= 70 ? '#10b981' : artifactsPercent >= 30 ? '#eab308' : '#ef4444',
                                opacity: 0.7,
                                minWidth: artifactsPercent > 0 ? '50px' : '0px'
                              }}
                            >
                              <span className="text-xs font-semibold text-white">
                                {artifactsPercent.toFixed(1)}%
                              </span>
                            </div>
                          </div>
                        </div>
                      </div>
                    ));
                  })()}
                </div>
              </div>

              {/* Section 2B: Coding Tools */}
              <div className="bg-white rounded-lg shadow-md p-6">
                <h3 className="text-lg font-semibold text-gray-900 mb-4">Coding Tools</h3>
                <p className="text-xs text-gray-500 mb-4">{latestMonthLabel} {latestMonthYear}: Adoption rates & lines of code distribution</p>
                <div className="space-y-6">
                  {(() => {
                    // GitHub Copilot - December
                    const githubTrend = aiToolsData.githubCopilot.monthlyTrend;
                    const githubLatest = githubTrend[githubTrend.length - 1]; // December
                    const githubPrevious = githubTrend.length > 1 ? githubTrend[githubTrend.length - 2] : null;
                    const githubLicenses = 46;
                    const githubAdoptionRate = (githubLatest.users / githubLicenses) * 100;
                    const githubPrevRate = githubPrevious ? (githubPrevious.users / githubLicenses) * 100 : null;
                    const githubChange = githubPrevRate ? githubAdoptionRate - githubPrevRate : null;
                    const githubActivity = githubLatest.totalLines; // Code activity
                    const githubPrevActivity = githubPrevious ? githubPrevious.totalLines : null;
                    const githubActivityChange = githubPrevActivity ? ((githubActivity - githubPrevActivity) / githubPrevActivity) * 100 : null;

                    // Claude Code - December
                    const claudeCodeTrend = aiToolsData.claudeCode.monthlyTrend;
                    const claudeCodeLatest = claudeCodeTrend[claudeCodeTrend.length - 1]; // December
                    const claudeCodePrevious = claudeCodeTrend.length > 1 ? claudeCodeTrend[claudeCodeTrend.length - 2] : null;
                    const claudeCodeAdoptionRate = (claudeCodeLatest.users / aiToolsData.claudeCode.licensedUsers) * 100;
                    const claudeCodePrevRate = claudeCodePrevious ? (claudeCodePrevious.users / aiToolsData.claudeCode.licensedUsers) * 100 : null;
                    const claudeCodeChange = claudeCodePrevRate ? claudeCodeAdoptionRate - claudeCodePrevRate : null;
                    const claudeCodeActivity = claudeCodeLatest.totalLines; // Code activity
                    const claudeCodePrevActivity = claudeCodePrevious ? claudeCodePrevious.totalLines : null;
                    const claudeCodeActivityChange = claudeCodePrevActivity ? ((claudeCodeActivity - claudeCodePrevActivity) / claudeCodePrevActivity) * 100 : null;

                    // Calculate totals
                    const totalLines = githubActivity + claudeCodeActivity; // Code-based tools
                    const totalEmployees = aiToolsData.orgMetrics.totalEmployees;

                    // Calculate total developers (Engineering + Product + Agentic AI) from department breakdown
                    const totalDevelopers = (() => {
                      const depts = aiToolsData.claudeEnterprise.departmentBreakdown || [];
                      const engineering = depts.find(d => d.department === 'Engineering');
                      const product = depts.find(d => d.department === 'Product');
                      const agenticAI = depts.find(d => d.department === 'Agentic AI');

                      // Return sum of employee counts (using users as proxy since we don't have explicit employee counts)
                      // Note: In production this should use actual employee counts from org hierarchy
                      return 100; // Engineering: 77 + Product: 17 + Agentic AI: 6 = 100
                    })();

                    const codingTools = [
                      {
                        tool: 'GitHub Copilot',
                        adoptionRate: githubAdoptionRate,
                        activeUsers: githubLatest.users,
                        licensedUsers: githubLicenses,
                        monthLabel: githubLatest.monthLabel,
                        change: githubChange,
                        activity: githubActivity,
                        activityPercent: (githubActivity / totalLines) * 100,
                        activityChange: githubActivityChange,
                        coverageRate: (githubLicenses / totalDevelopers) * 100,
                        color: '#24292e'
                      },
                      {
                        tool: 'Claude Code',
                        adoptionRate: claudeCodeAdoptionRate,
                        activeUsers: claudeCodeLatest.users,
                        licensedUsers: aiToolsData.claudeCode.licensedUsers,
                        monthLabel: claudeCodeLatest.monthLabel,
                        change: claudeCodeChange,
                        activity: claudeCodeActivity,
                        activityPercent: (claudeCodeActivity / totalLines) * 100,
                        activityChange: claudeCodeActivityChange,
                        coverageRate: (aiToolsData.claudeCode.licensedUsers / totalDevelopers) * 100,
                        color: '#6366f1'
                      }
                    ];

                    return codingTools.map(({ tool, adoptionRate, activeUsers, licensedUsers, monthLabel, change, activity, activityPercent, activityChange, coverageRate, color }) => (
                      <div key={tool} className="space-y-2">
                        <div className="flex justify-between text-sm">
                          <span className="font-medium text-gray-700">{tool}</span>
                        </div>

                        {/* Coverage Rate Bar */}
                        <div>
                          <div className="flex justify-between text-xs text-gray-500 mb-1">
                            <span>Coverage Rate</span>
                            <div className="flex items-center gap-2">
                              <span className="text-gray-400">
                                {licensedUsers} / {totalDevelopers} R&D Employees
                              </span>
                              <span>{monthLabel}</span>
                            </div>
                          </div>
                          <div className="w-full bg-gray-200 rounded-full h-5">
                            <div
                              className="h-5 rounded-full flex items-center justify-end pr-2 transition-all"
                              style={{
                                width: `${Math.min(coverageRate, 100)}%`,
                                backgroundColor: '#3b82f6',
                                minWidth: coverageRate > 0 ? '50px' : '0px'
                              }}
                            >
                              <span className="text-xs font-semibold text-white">
                                {coverageRate.toFixed(1)}%
                              </span>
                            </div>
                          </div>
                        </div>

                        {/* Adoption Rate Bar */}
                        <div>
                          <div className="flex justify-between text-xs text-gray-500 mb-1">
                            <span>Adoption Rate</span>
                            <div className="flex items-center gap-2">
                              <span className="text-gray-600">{activeUsers} / {licensedUsers} users</span>
                              <span>{monthLabel}</span>
                              {change !== null && (
                                <span className={`text-xs font-semibold ${change > 0 ? 'text-green-600' : change === 0 ? 'text-yellow-600' : 'text-red-600'}`}>
                                  {change !== 0 && (change > 0 ? '‚Üë ' : '‚Üì ')}{Math.abs(change).toFixed(1)}%
                                </span>
                              )}
                            </div>
                          </div>
                          <div className="w-full bg-gray-200 rounded-full h-5">
                            <div
                              className="h-5 rounded-full flex items-center justify-end pr-2 transition-all"
                              style={{
                                width: `${Math.min(adoptionRate, 100)}%`,
                                backgroundColor: adoptionRate >= 70 ? '#10b981' : adoptionRate >= 30 ? '#eab308' : '#ef4444',
                                minWidth: adoptionRate > 0 ? '50px' : '0px'
                              }}
                            >
                              <span className="text-xs font-semibold text-white">
                                {Math.round(adoptionRate)}%
                              </span>
                            </div>
                          </div>
                        </div>

                        {/* Lines of Code Distribution Bar */}
                        <div>
                          <div className="flex justify-between text-xs text-gray-500 mb-1">
                            <span>Lines of Code Distribution</span>
                            <div className="flex items-center gap-2">
                              <span className="text-gray-400">
                                {activity >= 1000 ? `${Math.round(activity / 1000)}k` : activity} lines
                              </span>
                              <span>{monthLabel}</span>
                              {activityChange !== null && (
                                <span className={`text-xs font-semibold ${activityChange >= 0 ? 'text-green-600' : 'text-red-600'}`}>
                                  {activityChange >= 0 ? '‚Üë' : '‚Üì'} {Math.abs(activityChange).toFixed(1)}%
                                </span>
                              )}
                            </div>
                          </div>
                          <div className="w-full bg-gray-200 rounded-full h-5">
                            <div
                              className="h-5 rounded-full flex items-center justify-end pr-2 transition-all"
                              style={{
                                width: `${activityPercent}%`,
                                backgroundColor: activityPercent >= 70 ? '#10b981' : activityPercent >= 30 ? '#eab308' : '#ef4444',
                                opacity: 0.7,
                                minWidth: activityPercent > 0 ? '50px' : '0px'
                              }}
                            >
                              <span className="text-xs font-semibold text-white">
                                {activityPercent.toFixed(1)}%
                              </span>
                            </div>
                          </div>
                        </div>
                      </div>
                    ));
                  })()}
                </div>
              </div>

              {/* Section 3: Adoption Trends Chart */}
              <div className="bg-white rounded-lg shadow-md p-6">
                <h3 className="text-lg font-semibold text-gray-900 mb-4">Adoption Trends</h3>
                <ResponsiveContainer width="100%" height={300}>
                  <AreaChart data={(() => {
                    const months = aiToolsData.claudeEnterprise.monthlyTrend.map(m => m.monthLabel);
                    return months.map((month) => ({
                      month,
                      m365: aiToolsData.m365Copilot.monthlyTrend.find(m => m.monthLabel === month)?.users || 0,
                      claudeEnterprise: aiToolsData.claudeEnterprise.monthlyTrend.find(m => m.monthLabel === month)?.users || 0,
                      githubCopilot: aiToolsData.githubCopilot.monthlyTrend?.find(m => m.monthLabel === month)?.users || 0,
                      claudeCode: aiToolsData.claudeCode.monthlyTrend.find(m => m.monthLabel === month)?.users || 0
                    }));
                  })()}>
                    <defs>
                      <linearGradient id="colorM365" x1="0" y1="0" x2="0" y2="1">
                        <stop offset="5%" stopColor="#1e40af" stopOpacity={0.8}/>
                        <stop offset="95%" stopColor="#1e40af" stopOpacity={0.1}/>
                      </linearGradient>
                      <linearGradient id="colorClaudeEnterprise" x1="0" y1="0" x2="0" y2="1">
                        <stop offset="5%" stopColor="#d97706" stopOpacity={0.8}/>
                        <stop offset="95%" stopColor="#d97706" stopOpacity={0.1}/>
                      </linearGradient>
                      <linearGradient id="colorGithubCopilot" x1="0" y1="0" x2="0" y2="1">
                        <stop offset="5%" stopColor="#059669" stopOpacity={0.8}/>
                        <stop offset="95%" stopColor="#059669" stopOpacity={0.1}/>
                      </linearGradient>
                      <linearGradient id="colorClaudeCode" x1="0" y1="0" x2="0" y2="1">
                        <stop offset="5%" stopColor="#7c3aed" stopOpacity={0.8}/>
                        <stop offset="95%" stopColor="#7c3aed" stopOpacity={0.1}/>
                      </linearGradient>
                    </defs>
                    <CartesianGrid strokeDasharray="3 3" />
                    <XAxis dataKey="month" />
                    <YAxis label={{ value: 'Active Users', angle: -90, position: 'insideLeft' }} />
                    <Tooltip />
                    <Legend />
                    <Area type="monotone" dataKey="m365" stroke="#1e40af" fillOpacity={1} fill="url(#colorM365)" name="M365 Copilot" strokeWidth={2} />
                    <Area type="monotone" dataKey="claudeEnterprise" stroke="#d97706" fillOpacity={1} fill="url(#colorClaudeEnterprise)" name="Claude Enterprise" strokeWidth={2} />
                    <Area type="monotone" dataKey="githubCopilot" stroke="#059669" fillOpacity={1} fill="url(#colorGithubCopilot)" name="GitHub Copilot" strokeWidth={2} />
                    <Area type="monotone" dataKey="claudeCode" stroke="#7c3aed" fillOpacity={1} fill="url(#colorClaudeCode)" name="Claude Code" strokeWidth={2} />
                  </AreaChart>
                </ResponsiveContainer>
              </div>

              {/* Section 4: Department Adoption Heatmap (Cross-Tool) */}
              <div className="bg-white rounded-lg shadow-md p-6">
                <h3 className="text-lg font-semibold text-gray-900 mb-4">Department Adoption Heatmap (All Tools)</h3>
                <div className="overflow-x-auto">
                  <table className="w-full">
                    <thead>
                      <tr className="border-b-2 border-gray-300">
                        <th className="text-left p-2 text-sm font-semibold text-gray-700">Department</th>
                        <th className="text-right p-2 text-sm font-semibold text-gray-700">Total Employees</th>
                        <th className="text-right p-2 text-sm font-semibold text-gray-700">Active Seats</th>
                        <th className="text-right p-2 text-sm font-semibold text-gray-700">Seats/Employee</th>
                        <th className="text-right p-2 text-sm font-semibold text-gray-700">Total Activity</th>
                        <th className="text-right p-2 text-sm font-semibold text-gray-700">Activity/Seat</th>
                        <th className="text-right p-2 text-sm font-semibold text-gray-700">Adoption Score</th>
                      </tr>
                    </thead>
                    <tbody>
                      {(() => {
                        // Department headcounts from org hierarchy
                        const deptHeadcounts = {
                          "Agentic AI": 6,
                          "Customer Success": 42,
                          "Professional Services": 39,
                          "Executive": 1,
                          "Finance": 6,
                          "Legal": 1,
                          "Marketing": 22,
                          "Operations": 6,
                          "Human Resources": 7,
                          "Product": 17,
                          "IT": 1,
                          "Sales - Enterprise": 10,
                          "Sales - Large Market": 10,
                          "Partnerships": 2,
                          "Revenue Operations": 3,
                          "Engineering": 77
                        };

                        // Aggregate department data from ALL tools (including GitHub Copilot)
                        const deptMap = {};

                        // Add Claude Enterprise data
                        aiToolsData.claudeEnterprise.departmentBreakdown.forEach(dept => {
                          if (!deptMap[dept.department]) {
                            deptMap[dept.department] = { users: 0, activity: 0 };
                          }
                          deptMap[dept.department].users += dept.users;
                          deptMap[dept.department].activity += dept.messages;
                        });

                        // Add M365 Copilot data (latest month)
                        const m365LatestMonth = aiToolsData.m365Copilot.monthlyTrend[aiToolsData.m365Copilot.monthlyTrend.length - 1];
                        if (m365LatestMonth && m365LatestMonth.byDept) {
                          m365LatestMonth.byDept.forEach(dept => {
                            if (!deptMap[dept.department]) {
                              deptMap[dept.department] = { users: 0, activity: 0 };
                            }
                            deptMap[dept.department].users += dept.users;
                            deptMap[dept.department].activity += dept.prompts;
                          });
                        }

                        // Add Claude Code data (latest month)
                        const claudeCodeLatestMonth = aiToolsData.claudeCode.monthlyTrend[aiToolsData.claudeCode.monthlyTrend.length - 1];
                        if (claudeCodeLatestMonth && claudeCodeLatestMonth.byDept) {
                          claudeCodeLatestMonth.byDept.forEach(dept => {
                            if (!deptMap[dept.department]) {
                              deptMap[dept.department] = { users: 0, activity: 0 };
                            }
                            deptMap[dept.department].users += dept.users;
                            deptMap[dept.department].activity += dept.lines;
                          });
                        }

                        // Add GitHub Copilot data (latest month)
                        const githubLatestMonth = aiToolsData.githubCopilot.monthlyTrend?.[aiToolsData.githubCopilot.monthlyTrend.length - 1];
                        if (githubLatestMonth && githubLatestMonth.byDept) {
                          githubLatestMonth.byDept.forEach(dept => {
                            if (!deptMap[dept.department]) {
                              deptMap[dept.department] = { users: 0, activity: 0 };
                            }
                            deptMap[dept.department].users += dept.users;
                            deptMap[dept.department].activity += dept.lines;
                          });
                        }

                        // Calculate department metrics
                        const deptArray = Object.keys(deptMap).map(department => {
                          const totalEmployees = deptHeadcounts[department] || 0;
                          const seatsPerEmployee = totalEmployees > 0
                            ? deptMap[department].users / totalEmployees
                            : 0;
                          const activityPerEmployee = totalEmployees > 0
                            ? deptMap[department].activity / totalEmployees
                            : 0;
                          const activityPerSeat = deptMap[department].users > 0
                            ? deptMap[department].activity / deptMap[department].users
                            : 0;

                          return {
                            department,
                            users: deptMap[department].users,
                            employees: totalEmployees,
                            seatsPerEmployee,
                            activity: deptMap[department].activity,
                            activityPerSeat,
                            activityPerEmployee
                          };
                        });

                        // Calculate percentiles for ranking
                        const activityPerSeatValues = deptArray.map(d => d.activityPerSeat).sort((a, b) => a - b);
                        const activityPerEmployeeValues = deptArray.map(d => d.activityPerEmployee).sort((a, b) => a - b);

                        const getPercentile = (value, sortedArray) => {
                          const index = sortedArray.findIndex(v => v >= value);
                          return index / sortedArray.length;
                        };

                        // Calculate composite adoption score (0-100) for each department
                        const deptWithScores = deptArray.map(dept => {
                          // Factor 1: Employee Coverage (0-30 points)
                          // What % of employees are using AI tools
                          const coverageScore = Math.min((dept.users / dept.employees) * 30, 30);

                          // Factor 2: Multi-Tool Usage (0-25 points)
                          // Seats per employee - rewards multiple tool usage
                          const multiToolScore = Math.min(Math.max((dept.seatsPerEmployee - 0.5) * 16.67, 0), 25);

                          // Factor 3: Activity Intensity (0-25 points)
                          // Activity per seat compared to other departments
                          const percentileActivityPerSeat = getPercentile(dept.activityPerSeat, activityPerSeatValues);
                          const intensityScore = percentileActivityPerSeat * 25;

                          // Factor 4: Total Impact (0-20 points)
                          // Total activity per employee compared to other departments
                          const percentileActivityPerEmployee = getPercentile(dept.activityPerEmployee, activityPerEmployeeValues);
                          const impactScore = percentileActivityPerEmployee * 20;

                          const totalScore = coverageScore + multiToolScore + intensityScore + impactScore;

                          return {
                            ...dept,
                            adoptionScore: Math.round(totalScore)
                          };
                        });

                        return deptWithScores
                          .sort((a, b) => b.adoptionScore - a.adoptionScore)
                          .map((dept, idx) => {
                            // Color based on total adoption score
                            const bgColor = dept.adoptionScore >= 80 ? 'bg-green-50' :
                                           dept.adoptionScore >= 60 ? 'bg-yellow-50' :
                                           'bg-red-50';
                            const scoreColor = dept.adoptionScore >= 80 ? 'text-green-700 font-bold' :
                                              dept.adoptionScore >= 60 ? 'text-yellow-700 font-semibold' :
                                              'text-red-700';

                            return (
                              <tr key={idx} className={`border-b border-gray-200 ${bgColor}`}>
                                <td className="p-2 text-sm font-medium text-gray-900">{dept.department}</td>
                                <td className="p-2 text-sm text-gray-700 text-right">{dept.employees}</td>
                                <td className="p-2 text-sm text-gray-700 text-right">{dept.users}</td>
                                <td className="p-2 text-sm text-gray-700 text-right">{dept.seatsPerEmployee.toFixed(2)}</td>
                                <td className="p-2 text-sm text-gray-700 text-right">{dept.activity.toLocaleString()}</td>
                                <td className="p-2 text-sm text-gray-700 text-right">{Math.round(dept.activityPerSeat).toLocaleString()}</td>
                                <td className={`p-2 text-sm text-right ${scoreColor}`}>{dept.adoptionScore}</td>
                              </tr>
                            );
                          });
                      })()}
                    </tbody>
                  </table>
                </div>
                <div className="mt-4 space-y-3">
                  <div className="bg-gray-50 p-4 rounded-lg border border-gray-200">
                    <h4 className="text-sm font-semibold text-gray-900 mb-2">Scoring Methodology</h4>
                    <p className="text-xs text-gray-700 mb-2">
                      <strong>Adoption Score (0-100)</strong> is calculated from 4 factors:
                    </p>
                    <ul className="text-xs text-gray-600 space-y-1 ml-4">
                      <li><strong>Employee Coverage (30 pts):</strong> % of department using AI tools (rewards broad adoption)</li>
                      <li><strong>Multi-Tool Usage (25 pts):</strong> Avg tools per employee (rewards creative multi-tool workflows)</li>
                      <li><strong>Activity Intensity (25 pts):</strong> Activity per seat vs other departments (rewards high engagement)</li>
                      <li><strong>Total Impact (20 pts):</strong> Total activity per employee vs others (rewards departmental productivity)</li>
                    </ul>
                  </div>
                  <div className="grid grid-cols-3 gap-3">
                    <div className="bg-green-50 p-3 rounded border border-green-200">
                      <p className="text-xs font-semibold text-green-800">üü¢ Excellent (80-100)</p>
                      <p className="text-xs text-green-700 mt-1">Full adoption, high utilization, creative multi-tool usage</p>
                    </div>
                    <div className="bg-yellow-50 p-3 rounded border border-yellow-200">
                      <p className="text-xs font-semibold text-yellow-800">üü° Good (60-79)</p>
                      <p className="text-xs text-yellow-700 mt-1">Solid coverage, room for optimization</p>
                    </div>
                    <div className="bg-red-50 p-3 rounded border border-red-200">
                      <p className="text-xs font-semibold text-red-800">üî¥ Low (0-59)</p>
                      <p className="text-xs text-red-700 mt-1">Limited adoption, needs enablement</p>
                    </div>
                  </div>
                  <p className="text-xs text-gray-500 italic">
                    Aggregates users and activity across <strong>Claude Enterprise</strong> (messages), <strong>M365 Copilot</strong> (prompts), <strong>Claude Code</strong> (lines), and <strong>GitHub Copilot</strong> (lines). Sorted by adoption score (high to low).
                  </p>
                </div>

                {/* Key Insights: Department Adoption Analysis */}
                {aiToolsData.insights?.departmentAdoptionHeatmap && (
                  <div className="mt-6 bg-gradient-to-r from-blue-50 to-indigo-50 p-4 rounded-lg border border-blue-200">
                    <h4 className="text-sm font-semibold text-gray-900 mb-3">üîç Key Insights: Department Adoption Patterns</h4>
                    <div className="prose prose-sm max-w-none text-gray-800">
                      <ReactMarkdown
                        components={{
                          h1: ({node, ...props}) => <h3 className="text-base font-bold text-gray-900 mt-4 mb-2" {...props} />,
                          h2: ({node, ...props}) => <h4 className="text-sm font-semibold text-gray-900 mt-3 mb-2" {...props} />,
                          h3: ({node, ...props}) => <h5 className="text-sm font-medium text-gray-900 mt-2 mb-1" {...props} />,
                          p: ({node, ...props}) => <p className="text-sm text-gray-800 leading-relaxed mb-3" {...props} />,
                          ul: ({node, ...props}) => <ul className="list-disc list-inside text-sm text-gray-800 space-y-1 mb-3" {...props} />,
                          ol: ({node, ...props}) => <ol className="list-decimal list-inside text-sm text-gray-800 space-y-1 mb-3" {...props} />,
                          strong: ({node, ...props}) => <strong className="font-semibold text-gray-900" {...props} />,
                          em: ({node, ...props}) => <em className="italic text-gray-700" {...props} />
                        }}
                      >
                        {aiToolsData.insights.departmentAdoptionHeatmap}
                      </ReactMarkdown>
                    </div>
                  </div>
                )}
              </div>

              {/* Section 5: AI-Powered Insights */}
              <div className="bg-white rounded-lg shadow-md p-6">
                <h3 className="text-lg font-semibold text-gray-900 mb-4">AI-Powered Insights</h3>
                <div className="space-y-4">
                  {(() => {
                    // Transform insights object into array with priority insights first
                    const priorityKeys = ['adoptionTrend', 'productivityComparison', 'engagementTrend'];
                    const insights = priorityKeys
                      .filter(key => aiToolsData.insights[key])
                      .map(key => ({
                        key,
                        title: key.replace(/([A-Z])/g, ' $1').replace(/^./, str => str.toUpperCase()).trim(),
                        description: aiToolsData.insights[key],
                        impact: key === 'adoptionTrend' ? 'high' : key === 'productivityComparison' ? 'high' : 'medium'
                      }));

                    return insights.slice(0, 3).map((insight, idx) => (
                      <div
                        key={idx}
                        className={`p-4 rounded-lg border-l-4 ${
                          insight.impact === 'high' ? 'border-red-500 bg-red-50' :
                          insight.impact === 'medium' ? 'border-yellow-500 bg-yellow-50' :
                          'border-blue-500 bg-blue-50'
                        }`}
                      >
                        <div className="flex items-start justify-between mb-2">
                          <h4 className="font-semibold text-gray-900">{insight.title}</h4>
                          <span className={`text-xs px-2 py-1 rounded ${
                            insight.impact === 'high' ? 'bg-red-200 text-red-800' :
                            insight.impact === 'medium' ? 'bg-yellow-200 text-yellow-800' :
                            'bg-blue-200 text-blue-800'
                          }`}>
                            {insight.impact.toUpperCase()}
                          </span>
                        </div>
                        <p className="text-sm text-gray-700 leading-relaxed">{insight.description}</p>
                      </div>
                    ));
                  })()}
                </div>
              </div>

              {/* Section 6: Quick Actions Bar */}
              <div className="bg-gradient-to-r from-blue-50 to-purple-50 rounded-lg shadow-md p-6">
                <h3 className="text-lg font-semibold text-gray-900 mb-4">Quick Actions</h3>
                <div className="grid grid-cols-2 md:grid-cols-4 gap-4">
                  <button
                    onClick={() => setActiveTab('claude-enterprise')}
                    className="flex flex-col items-center p-4 bg-white rounded-lg hover:shadow-lg transition-all hover:scale-105"
                  >
                    <MessageSquare className="w-8 h-8 text-blue-600 mb-2" />
                    <span className="text-sm font-medium text-gray-900">Claude Enterprise</span>
                  </button>
                  <button
                    onClick={() => setActiveTab('m365')}
                    className="flex flex-col items-center p-4 bg-white rounded-lg hover:shadow-lg transition-all hover:scale-105"
                  >
                    <TrendingUp className="w-8 h-8 text-blue-600 mb-2" />
                    <span className="text-sm font-medium text-gray-900">M365 Copilot</span>
                  </button>
                  <button
                    onClick={() => setActiveTab('expansion')}
                    className="flex flex-col items-center p-4 bg-white rounded-lg hover:shadow-lg transition-all hover:scale-105"
                  >
                    <DollarSign className="w-8 h-8 text-green-600 mb-2" />
                    <span className="text-sm font-medium text-gray-900">Expansion ROI</span>
                  </button>
                  <button
                    onClick={() => setActiveTab('briefing-leadership')}
                    className="flex flex-col items-center p-4 bg-white rounded-lg hover:shadow-lg transition-all hover:scale-105"
                  >
                    <FileText className="w-8 h-8 text-purple-600 mb-2" />
                    <span className="text-sm font-medium text-gray-900">Briefings</span>
                  </button>
                </div>
              </div>
            </div>
          )}

          {/* PHASE 1D: Briefing - Leadership Summary Tab */}
          {activeTab === 'briefing-leadership' && (
            <div className="space-y-6">
              <div className="bg-white rounded-lg shadow-md p-6">
                <div className="flex justify-between items-start mb-4">
                  <div>
                    <h3 className="text-xl font-semibold text-gray-900">Executive Leadership Summary</h3>
                    <p className="text-xs text-gray-500 mt-1 italic">For Executive Leadership Team & Board of Directors</p>
                  </div>
                  {aiToolsData.insights?.executiveSummary && (
                    <button
                      onClick={() => {
                        const content = aiToolsData.insights.executiveSummary;
                        const blob = new Blob([content], { type: 'text/markdown' });
                        const url = URL.createObjectURL(blob);
                        const a = document.createElement('a');
                        a.href = url;
                        a.download = 'executive-leadership-summary.md';
                        document.body.appendChild(a);
                        a.click();
                        document.body.removeChild(a);
                        URL.revokeObjectURL(url);
                      }}
                      className="flex items-center gap-2 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors text-sm"
                    >
                      <Download className="h-4 w-4" />
                      Download as Markdown
                    </button>
                  )}
                </div>
                <div className="prose prose-lg max-w-none">
                  {aiToolsData.insights?.executiveSummary ? (
                    <ReactMarkdown
                      components={{
                        h1: ({node, ...props}) => <h2 className="text-2xl font-bold text-gray-900 mt-8 mb-4 pb-2 border-b-2 border-blue-500" {...props} />,
                        h2: ({node, ...props}) => <h3 className="text-xl font-bold text-gray-900 mt-6 mb-3" {...props} />,
                        h3: ({node, ...props}) => <h4 className="text-lg font-semibold text-gray-800 mt-4 mb-2" {...props} />,
                        p: ({node, ...props}) => <p className="text-base text-gray-700 leading-relaxed mb-4" {...props} />,
                        ul: ({node, ...props}) => <ul className="list-disc list-outside ml-6 text-base text-gray-700 space-y-2 mb-4" {...props} />,
                        ol: ({node, ...props}) => <ol className="list-decimal list-outside ml-6 text-base text-gray-700 space-y-2 mb-4" {...props} />,
                        li: ({node, ...props}) => <li className="pl-2" {...props} />,
                        strong: ({node, ...props}) => <strong className="font-bold text-gray-900 bg-yellow-50 px-1" {...props} />,
                        em: ({node, ...props}) => <em className="italic text-gray-600" {...props} />,
                        code: ({node, ...props}) => <code className="bg-gray-100 text-blue-600 px-2 py-0.5 rounded text-sm font-mono" {...props} />
                      }}
                    >
                      {aiToolsData.insights.executiveSummary}
                    </ReactMarkdown>
                  ) : (
                    <p className="text-gray-500 italic">Executive summary will be generated when data is parsed.</p>
                  )}
                </div>
              </div>
            </div>
          )}

          {/* PHASE 1D: Briefing - Organization-wide Summary Tab */}
          {activeTab === 'briefing-org' && (
            <div className="space-y-6">
              <div className="bg-gradient-to-r from-blue-50 to-indigo-50 rounded-lg shadow-md p-6 border-l-4 border-blue-500">
                <div className="flex justify-between items-start mb-4">
                  <div>
                    <h3 className="text-xl font-semibold text-gray-900">Company-wide Summary</h3>
                    <p className="text-xs text-gray-500 mt-1 italic">For Monthly All Hands Meetings and All Company internal communications (3 slides max)</p>
                  </div>
                  {aiToolsData.insights?.allHandsMessage && (
                    <button
                      onClick={() => {
                        const content = aiToolsData.insights.allHandsMessage;
                        const blob = new Blob([content], { type: 'text/markdown' });
                        const url = URL.createObjectURL(blob);
                        const a = document.createElement('a');
                        a.href = url;
                        a.download = 'company-wide-summary.md';
                        document.body.appendChild(a);
                        a.click();
                        document.body.removeChild(a);
                        URL.revokeObjectURL(url);
                      }}
                      className="flex items-center gap-2 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors text-sm"
                    >
                      <Download className="h-4 w-4" />
                      Download as Markdown
                    </button>
                  )}
                </div>
                <div className="prose prose-lg max-w-none">
                  {aiToolsData.insights?.allHandsMessage ? (
                    (() => {
                      // Parse the slide deck format manually for better control
                      const message = aiToolsData.insights.allHandsMessage;
                      const slides = message.split(/(?=SLIDE \d+:)/g).filter(s => s.trim());

                      return slides.map((slide, slideIdx) => {
                        const lines = slide.split('\n');
                        let currentSection = null;
                        const sections = {};

                        lines.forEach(line => {
                          const trimmed = line.trim();
                          if (trimmed.startsWith('SLIDE')) {
                            sections.slideNumber = trimmed;
                          } else if (trimmed.startsWith('TITLE:')) {
                            currentSection = 'title';
                            sections.title = trimmed.replace('TITLE:', '').trim();
                          } else if (trimmed.startsWith('SUBTITLE:')) {
                            currentSection = 'subtitle';
                            sections.subtitle = trimmed.replace('SUBTITLE:', '').trim();
                          } else if (trimmed.startsWith('CONTENT:')) {
                            currentSection = 'content';
                            sections.content = [];
                          } else if (trimmed.startsWith('PRESENTER NOTES:')) {
                            currentSection = 'notes';
                            sections.notes = trimmed.replace('PRESENTER NOTES:', '').trim();
                          } else if (trimmed && currentSection === 'content') {
                            sections.content.push(trimmed);
                          } else if (trimmed && currentSection === 'notes') {
                            sections.notes += ' ' + trimmed;
                          }
                        });

                        return (
                          <div key={slideIdx} className={slideIdx > 0 ? "mt-12 pt-8 border-t-4 border-blue-500" : ""}>
                            {/* Slide Number */}
                            {sections.slideNumber && (
                              <h2 className="text-3xl font-bold text-blue-900 mb-4">{sections.slideNumber}</h2>
                            )}

                            {/* Title */}
                            {sections.title && (
                              <div className="mb-4">
                                <h4 className="text-xs font-bold text-blue-600 uppercase tracking-wide mb-1">TITLE</h4>
                                <h3 className="text-2xl font-bold text-gray-900 bg-gradient-to-r from-blue-100 to-indigo-100 p-4 rounded-lg">
                                  {sections.title}
                                </h3>
                              </div>
                            )}

                            {/* Subtitle */}
                            {sections.subtitle && (
                              <div className="mb-4">
                                <h4 className="text-xs font-bold text-blue-600 uppercase tracking-wide mb-1">SUBTITLE</h4>
                                <p className="text-lg text-gray-700 italic pl-4 border-l-4 border-blue-400">
                                  {sections.subtitle}
                                </p>
                              </div>
                            )}

                            {/* Content */}
                            {sections.content && sections.content.length > 0 && (
                              <div className="mb-4">
                                <h4 className="text-xs font-bold text-blue-600 uppercase tracking-wide mb-2">CONTENT</h4>
                                <ul className="list-none space-y-3 bg-white p-4 rounded-lg border-l-4 border-blue-400">
                                  {sections.content.map((item, idx) => (
                                    <li key={idx} className="flex items-start text-gray-800">
                                      <span className="text-blue-500 mr-3 text-xl flex-shrink-0">‚Ä¢</span>
                                      <span className="text-base">{item.replace(/^[‚Ä¢¬∑-]\s*/, '')}</span>
                                    </li>
                                  ))}
                                </ul>
                              </div>
                            )}

                            {/* Presenter Notes */}
                            {sections.notes && (
                              <div className="mb-4">
                                <h4 className="text-xs font-bold text-blue-600 uppercase tracking-wide mb-2">PRESENTER NOTES</h4>
                                <div className="bg-gray-50 p-4 rounded-lg border border-gray-200">
                                  <p className="text-sm text-gray-700 leading-relaxed italic">
                                    {sections.notes}
                                  </p>
                                </div>
                              </div>
                            )}
                          </div>
                        );
                      });
                    })()
                  ) : (
                    <p className="text-gray-500 italic">All Hands message will be generated when data is parsed.</p>
                  )}
                </div>
              </div>
            </div>
          )}

        {/* PHASE 1D: Perceived Value Tab - Moved from nested position */}
          {/* Perceived Value Tab */}
          {activeTab === 'perceived-value' && (
            <div className="space-y-6">
              <div>
                <h2 className="text-2xl font-bold text-gray-900 mb-2">Perceived Value & Sentiment Analysis</h2>
                <p className="text-gray-600 mb-6">Employee feedback from Slack, Confluence, surveys, and interviews analyzed with Claude API</p>
              </div>

              {/* Overview Cards for All Tools */}
              <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
                {Object.entries(perceivedValueData.perceivedValue).map(([toolName, data]) => {
                  const getScoreColor = (score) => {
                    if (score >= 85) return 'text-green-600';
                    if (score >= 70) return 'text-blue-600';
                    if (score >= 60) return 'text-yellow-600';
                    return 'text-orange-600';
                  };

                  const getScoreBg = (score) => {
                    if (score >= 85) return 'bg-green-50';
                    if (score >= 70) return 'bg-blue-50';
                    if (score >= 60) return 'bg-yellow-50';
                    return 'bg-orange-50';
                  };

                  return (
                    <div key={toolName} className={`${getScoreBg(data.score)} rounded-lg shadow-md p-6 border border-gray-200`}>
                      <div className="flex items-center justify-between mb-4">
                        <Heart className={`h-6 w-6 ${getScoreColor(data.score)}`} />
                        <span className={`text-sm font-medium ${getScoreColor(data.score)}`}>
                          {data.totalFeedback} responses
                        </span>
                      </div>
                      <h3 className="text-sm font-medium text-gray-600 mb-1">{toolName}</h3>
                      <div className={`text-4xl font-bold ${getScoreColor(data.score)} mb-2`}>
                        {data.score}
                      </div>
                      <p className="text-xs text-gray-500">Perceived Value Score</p>
                      <div className="mt-4 flex gap-2 text-xs">
                        <span className="flex items-center gap-1 text-green-600">
                          <ThumbsUp className="h-3 w-3" /> {data.sentimentBreakdown.positive}
                        </span>
                        <span className="flex items-center gap-1 text-orange-600">
                          <ThumbsDown className="h-3 w-3" /> {data.sentimentBreakdown.negative}
                        </span>
                      </div>
                    </div>
                  );
                })}
              </div>

              {/* Tool-by-Tool Deep Dive */}
              {Object.entries(perceivedValueData.perceivedValue).map(([toolName, toolData]) => (
                <div key={toolName} className="bg-white rounded-lg shadow-md p-6 border border-gray-100">
                  <h3 className="text-xl font-semibold text-gray-900 mb-6 flex items-center gap-2">
                    <Heart className="h-6 w-6 text-blue-600" />
                    {toolName} - Detailed Sentiment Analysis
                  </h3>

                  {/* Sentiment Breakdown */}
                  <div className="mb-8">
                    <h4 className="text-lg font-medium text-gray-900 mb-4">Sentiment Distribution</h4>
                    <div className="grid grid-cols-3 gap-4">
                      <div className="bg-green-50 rounded-lg p-4 border border-green-200">
                        <div className="text-3xl font-bold text-green-600">{toolData.sentimentBreakdown.positive}</div>
                        <div className="text-sm text-gray-600 mt-1">Positive</div>
                      </div>
                      <div className="bg-gray-50 rounded-lg p-4 border border-gray-200">
                        <div className="text-3xl font-bold text-gray-600">{toolData.sentimentBreakdown.neutral}</div>
                        <div className="text-sm text-gray-600 mt-1">Neutral</div>
                      </div>
                      <div className="bg-orange-50 rounded-lg p-4 border border-orange-200">
                        <div className="text-3xl font-bold text-orange-600">{toolData.sentimentBreakdown.negative}</div>
                        <div className="text-sm text-gray-600 mt-1">Negative</div>
                      </div>
                    </div>
                  </div>

                  {/* Top Impacts */}
                  {toolData.topImpacts && toolData.topImpacts.length > 0 && (
                    <div className="mb-8">
                      <h4 className="text-lg font-medium text-gray-900 mb-4 flex items-center gap-2">
                        <TrendingUp className="h-5 w-5 text-blue-600" />
                        Quantified Impact
                      </h4>
                      <div className="space-y-3">
                        {toolData.topImpacts.map((impact, idx) => (
                          <div key={idx} className="border border-gray-200 rounded-lg p-4 bg-blue-50">
                            <div className="flex items-center justify-between">
                              <div>
                                <span className="text-lg font-semibold text-gray-900 capitalize">{impact.task.replace(/_/g, ' ')}</span>
                                <span className="text-sm text-gray-600 ml-2">by {impact.source}</span>
                              </div>
                              <div className="text-2xl font-bold text-blue-600">{impact.reduction}</div>
                            </div>
                          </div>
                        ))}
                      </div>
                    </div>
                  )}

                  {/* Top Themes */}
                  {toolData.themes && toolData.themes.length > 0 && (
                    <div className="mb-8">
                      <h4 className="text-lg font-medium text-gray-900 mb-4 flex items-center gap-2">
                        <Tag className="h-5 w-5 text-blue-600" />
                        Top Themes
                      </h4>
                      <div className="flex flex-wrap gap-2">
                        {toolData.themes.slice(0, 10).map((theme, idx) => (
                          <span key={idx} className="px-3 py-2 bg-blue-100 text-blue-800 rounded-lg text-sm font-medium capitalize">
                            {theme.replace(/_/g, ' ')}
                          </span>
                        ))}
                      </div>
                    </div>
                  )}

                  {/* Representative Quotes */}
                  {toolData.quotes && toolData.quotes.length > 0 && (
                    <div className="mb-8">
                      <h4 className="text-lg font-medium text-gray-900 mb-4 flex items-center gap-2">
                        <Quote className="h-5 w-5 text-blue-600" />
                        Representative Quotes
                      </h4>
                      <div className="space-y-4">
                        {toolData.quotes.map((quote, idx) => {
                          const isChallenge = quote.type === 'challenge';
                          const borderColor = isChallenge ? 'border-orange-500 bg-orange-50' : 'border-blue-500 bg-blue-50';

                          return (
                            <div key={idx} className={`border-l-4 ${borderColor} rounded-lg p-4`}>
                              <p className="text-gray-900 italic mb-3">"{quote.text}"</p>
                              <div className="flex items-center justify-between text-sm">
                                <div className="flex items-center gap-3">
                                  <span className="font-medium text-gray-900">{quote.author}</span>
                                  <span className="px-2 py-1 bg-white rounded text-xs text-gray-600 border border-gray-200 capitalize">
                                    {quote.context ? quote.context.replace(/_/g, ' ') : 'feedback'}
                                  </span>
                                  {quote.impact && (
                                    <span className="px-2 py-1 bg-green-100 text-green-800 rounded text-xs font-medium">
                                      {quote.impact.reduction} time saved
                                    </span>
                                  )}
                                </div>
                              </div>
                            </div>
                          );
                        })}
                      </div>
                    </div>
                  )}

                  {/* Challenges */}
                  {toolData.challenges && toolData.challenges.length > 0 && (
                    <div className="mb-8">
                      <h4 className="text-lg font-medium text-gray-900 mb-4 flex items-center gap-2">
                        <AlertCircle className="h-5 w-5 text-orange-600" />
                        Challenges & Areas for Improvement
                      </h4>
                      <div className="space-y-3">
                        {toolData.challenges.map((challenge, idx) => (
                          <div key={idx} className="border border-orange-200 rounded-lg p-4 bg-orange-50">
                            <p className="text-sm text-gray-700">{challenge}</p>
                          </div>
                        ))}
                      </div>
                    </div>
                  )}

                  {/* Department Sentiment Breakdown */}
                  {toolData.departmentSentiment && toolData.departmentSentiment.length > 0 && (
                    <div>
                      <h4 className="text-lg font-medium text-gray-900 mb-4">Sentiment by Department</h4>
                      <div className="space-y-3">
                        {toolData.departmentSentiment.map((dept, idx) => {
                          const scorePercent = ((dept.score + 1) / 2) * 100;
                          const scoreColor = dept.score > 0.6 ? 'bg-green-500' : dept.score > 0.3 ? 'bg-blue-500' : dept.score > 0 ? 'bg-yellow-500' : 'bg-red-500';

                          return (
                            <div key={idx} className="flex items-center gap-4">
                              <div className="w-40 text-sm font-medium text-gray-700">{dept.department}</div>
                              <div className="flex-1">
                                <div className="w-full bg-gray-200 rounded-full h-6 relative">
                                  <div className={`h-6 rounded-full ${scoreColor} flex items-center justify-end pr-2`} style={{ width: `${scorePercent}%` }}>
                                    <span className="text-xs font-medium text-white">{dept.score.toFixed(2)}</span>
                                  </div>
                                </div>
                              </div>
                              <div className="w-20 text-right text-sm text-gray-500">{dept.count} responses</div>
                            </div>
                          );
                        })}
                      </div>
                    </div>
                  )}
                </div>
              ))}

              {/* Summary Stats */}
              <div className="bg-gradient-to-r from-blue-50 to-indigo-50 rounded-lg shadow-md p-6 border border-blue-200">
                <h3 className="text-xl font-semibold text-gray-900 mb-4">Data Summary</h3>
                <div className="grid grid-cols-2 md:grid-cols-4 gap-6">
                  <div>
                    <p className="text-sm text-gray-600 mb-1">Unique Messages</p>
                    <p className="text-3xl font-bold text-blue-600">{perceivedValueData.summary.uniqueMessages || perceivedValueData.summary.sourceBreakdown.slack}</p>
                    <p className="text-xs text-gray-500 mt-1">Original feedback items</p>
                  </div>
                  <div>
                    <p className="text-sm text-gray-600 mb-1">Tool-Specific Feedback</p>
                    <p className="text-3xl font-bold text-blue-600">{perceivedValueData.summary.totalFeedbackAnalyzed}</p>
                    <p className="text-xs text-gray-500 mt-1">After multi-tool analysis</p>
                  </div>
                  <div>
                    <p className="text-sm text-gray-600 mb-1">Multi-Tool Messages</p>
                    <p className="text-3xl font-bold text-indigo-600">{perceivedValueData.summary.multiToolMessages || (perceivedValueData.summary.totalFeedbackAnalyzed - perceivedValueData.summary.sourceBreakdown.slack)}</p>
                    <p className="text-xs text-gray-500 mt-1">Comparative statements</p>
                  </div>
                  <div>
                    <p className="text-sm text-gray-600 mb-1">Confluence Surveys</p>
                    <p className="text-3xl font-bold text-blue-600">{perceivedValueData.summary.sourceBreakdown.confluence}</p>
                    <p className="text-xs text-gray-500 mt-1">Engineering teams</p>
                  </div>
                </div>
                {perceivedValueData.summary.explanation && (
                  <div className="mt-4 p-3 bg-white rounded border border-blue-200">
                    <p className="text-sm text-gray-700">
                      <span className="font-medium text-blue-600">Note:</span> {perceivedValueData.summary.explanation}
                    </p>
                  </div>
                )}
                <p className="text-xs text-gray-500 mt-4">
                  Last updated: {new Date(perceivedValueData.lastUpdated).toLocaleString()}
                </p>
              </div>
            </div>
          )}

          {activeTab === 'portfolio' && (
            <div className="space-y-6">
              {selectedProject ? (
                // RENDER PROJECT DETAIL VIEW
                <ProjectDetail project={projectDetailsData[selectedProject]} />
              ) : (
                // RENDER PORTFOLIO TABLE (existing content)
                <>
                  <div>
                    <h2 className="text-2xl font-bold text-gray-900 mb-2">AI Projects Portfolio - Priority & Scoring</h2>
                    <p className="text-gray-600 mb-6">
                      11 AI projects ranked by hybrid scoring algorithm (70% Multi-Factor + 30% ROI).
                      Data-driven prioritization based on financial impact, strategic alignment, execution feasibility, and time to value.
                    </p>
                  </div>

                  {/* Portfolio Summary Cards */}
                  <div className="grid grid-cols-1 md:grid-cols-4 gap-6 mb-6">
                <div className="bg-gradient-to-br from-blue-50 to-blue-100 rounded-lg shadow-md p-6 border border-blue-200">
                  <div className="flex items-center justify-between mb-2">
                    <Target className="h-8 w-8 text-blue-600" />
                    <span className="text-sm font-medium text-blue-700">Total Projects</span>
                  </div>
                  <div className="text-4xl font-bold text-blue-900 mb-1">11</div>
                  <p className="text-xs text-blue-700">6 Foundation ‚Ä¢ 3 Revenue ‚Ä¢ 2 Retention</p>
                </div>

                <div className="bg-gradient-to-br from-green-50 to-green-100 rounded-lg shadow-md p-6 border border-green-200">
                  <div className="flex items-center justify-between mb-2">
                    <DollarSign className="h-8 w-8 text-green-600" />
                    <span className="text-sm font-medium text-green-700">Total Value</span>
                  </div>
                  <div className="text-4xl font-bold text-green-900 mb-1">$22.4M</div>
                  <p className="text-xs text-green-700">Annual value potential</p>
                </div>

                <div className="bg-gradient-to-br from-indigo-50 to-indigo-100 rounded-lg shadow-md p-6 border border-indigo-200">
                  <div className="flex items-center justify-between mb-2">
                    <TrendingUp className="h-8 w-8 text-indigo-600" />
                    <span className="text-sm font-medium text-indigo-700">Portfolio ROI</span>
                  </div>
                  <div className="text-4xl font-bold text-indigo-900 mb-1">428%</div>
                  <p className="text-xs text-indigo-700">Blended 3-year ROI</p>
                </div>

                <div className="bg-gradient-to-br from-orange-50 to-orange-100 rounded-lg shadow-md p-6 border border-orange-200">
                  <div className="flex items-center justify-between mb-2">
                    <Activity className="h-8 w-8 text-orange-600" />
                    <span className="text-sm font-medium text-orange-700">Q1 Committed</span>
                  </div>
                  <div className="text-4xl font-bold text-orange-900 mb-1">6</div>
                  <p className="text-xs text-orange-700">Foundation projects launching Q1</p>
                </div>
              </div>

                  {/* Portfolio Table */}
                  <div className="bg-white rounded-lg shadow-md border border-gray-200" style={{height: '600px'}}>
                    <div className="p-6 h-full">
                      <PortfolioTable
                        projects={portfolioData.projects}
                        methodology={portfolioData.methodology}
                        showMethodology={true}
                        showLegend={true}
                        onProjectClick={(projectId) => setSelectedProject(projectId)}
                      />
                    </div>
                  </div>

              {/* Strategic Context */}
              <div className="bg-gradient-to-r from-blue-50 to-indigo-50 rounded-lg shadow-md p-6 border border-blue-200">
                <h3 className="text-xl font-semibold text-gray-900 mb-4">Strategic Context & Quarterly Reviews</h3>
                <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                  <div>
                    <h4 className="text-sm font-semibold text-blue-900 mb-2">Scoring Methodology</h4>
                    <p className="text-sm text-gray-700 mb-3">
                      Projects scored using adaptive hybrid formula: 70% Multi-Factor (Financial Impact, Strategic Alignment,
                      Execution Feasibility, Time to Value) + 30% ROI for Q1-Q2. Weight shifts to 60/40 in Q3-Q4 as ROI data improves.
                    </p>
                    <p className="text-xs text-gray-600">
                      <strong>Source:</strong> /docs/strategic-planning/working-data/PROJECT_SCORES.md
                    </p>
                  </div>
                  <div>
                    <h4 className="text-sm font-semibold text-blue-900 mb-2">Quarterly Review Gates</h4>
                    <ul className="space-y-2 text-sm text-gray-700">
                      <li className="flex items-start">
                        <span className="text-green-600 mr-2">‚úì</span>
                        <span><strong>Q1 Review (Mar 31):</strong> Re-prioritize Q2-Q4 based on Q1 results</span>
                      </li>
                      <li className="flex items-start">
                        <span className="text-blue-600 mr-2">‚Üí</span>
                        <span><strong>Q2 Review (Jun 30):</strong> Adjust Q3-Q4 plan, validate champion model</span>
                      </li>
                      <li className="flex items-start">
                        <span className="text-blue-600 mr-2">‚Üí</span>
                        <span><strong>Q3 Review (Sep 30):</strong> Finalize Q4 commitments, assess ROI accuracy</span>
                      </li>
                    </ul>
                  </div>
                </div>
              </div>

              {/* Link to Full Presentation */}
              <div className="bg-white rounded-lg shadow-md p-6 border border-gray-200">
                <div className="flex items-center justify-between">
                  <div>
                    <h3 className="text-lg font-semibold text-gray-900 mb-2">2026 Annual Plan Presentation</h3>
                    <p className="text-sm text-gray-600">
                      View the complete strategic plan with quarterly roadmap, resource requirements, and KPIs
                    </p>
                  </div>
                  <button
                    onClick={() => setActiveTab('2026-plan')}
                    className="flex items-center gap-2 bg-blue-600 text-white px-6 py-3 rounded-lg hover:bg-blue-700 transition-colors font-medium"
                  >
                    <Presentation className="h-5 w-5" />
                    View Full Plan
                  </button>
                </div>
              </div>
                </>
              )}
            </div>
          )}

              </div>
            </div>
          </main>
        </div>
    </div>
  );
};


export default Dashboard;
