# Data Architecture

**Last Updated**: January 26, 2026
**Status**: Current Architecture with Planned Evolution

---

## Overview

The AI Dashboard uses a **batch-processed data pipeline** that transforms raw source data into optimized JSON files consumed by the Next.js application at runtime.

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                           DATA FLOW ARCHITECTURE                            │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│  SOURCE DATA (/data/)              PIPELINE (scripts/)        RUNTIME (app/)│
│  ─────────────────────────         ───────────────────        ─────────────│
│                                                                             │
│  ┌─────────────────────┐                                                    │
│  │ M365 Copilot CSVs   │──┐                                                 │
│  │ (14 files, ~1MB)    │  │                                                 │
│  └─────────────────────┘  │                                                 │
│                           │      ┌──────────────────┐    ┌────────────────┐ │
│  ┌─────────────────────┐  │      │                  │    │                │ │
│  │ GitHub Copilot      │──┼─────▶│  npm run refresh │───▶│ ai-tools-      │ │
│  │ NDJSONs (7 files)   │  │      │                  │    │ data.json      │ │
│  └─────────────────────┘  │      │  Pipeline:       │    │ (728KB)        │ │
│                           │      │  - Ingestors     │    │                │ │
│  ┌─────────────────────┐  │      │  - Processors    │    └────────────────┘ │
│  │ Claude Enterprise   │──┤      │  - Aggregators   │                       │
│  │ ZIPs (gitignored)   │  │      │  - AI Insights   │    ┌────────────────┐ │
│  └─────────────────────┘  │      │                  │    │ ai-projects-   │ │
│                           │      └──────────────────┘    │ *.json         │ │
│  ┌─────────────────────┐  │                              │ (40KB)         │ │
│  │ Claude Code CSVs    │──┤                              └────────────────┘ │
│  │ (3 files)           │  │                                                 │
│  └─────────────────────┘  │                                                 │
│                           │                                                 │
│  ┌─────────────────────┐  │                                                 │
│  │ Org Chart JSON      │──┤                                                 │
│  │ License Config CSV  │──┘                                                 │
│  └─────────────────────┘                                                    │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘
```

---

## File Categories

### 1. Runtime Files (app/*.json) - REQUIRED IN REPO

These files are **imported by the Next.js application** and must be committed to the repository.

| File | Size | Purpose | Generated By |
|------|------|---------|--------------|
| `ai-tools-data.json` | 728KB | Main dashboard data for all 15 tabs | `pipeline-orchestrator.js` |
| `ai-projects-details.json` | 20KB | Project detail views | `parse-project-details.js` |
| `ai-projects-portfolio.json` | 4KB | Portfolio table data | `annual-plan-orchestrator.js` |
| `ai-projects-presentation.json` | 16KB | Annual plan slides | `annual-plan-orchestrator.js` |
| `claude-editorial-content.json` | 4KB | Editorial content | Manual |
| `claude-enablement-plan.json` | 4KB | Enablement plan | Manual |

**Total Runtime Data**: ~776KB

### 2. Configuration Files (data/) - KEEP IN REPO

Small configuration files that define business rules and organizational structure.

| File | Size | Purpose | Why Keep |
|------|------|---------|----------|
| `license_config.csv` | 1KB | License counts, pricing | Defines business rules |
| `techco_org_chart.json` | 388KB | Org structure, 258 employees | Required for department mapping |
| `claude_enterprise_seats.json` | 19KB | User seat assignments | Required for user mapping |
| `roi_config.json` | 1KB | ROI calculation parameters | Business rules |

### 3. Reference Documentation (data/ai-projects/) - KEEP IN REPO

Project documentation used to generate annual plan data.

| Pattern | Count | Purpose |
|---------|-------|---------|
| `OP-*.md` | ~15 | Project analysis documents |
| `*.csv` | 2 | Financial data |
| `*.pdf` | 4 | PRDs and analysis |

### 4. Source Export Files - DO NOT COMMIT (Gitignored)

Large export files downloaded from external systems. These should be kept locally but not committed.

| Source | Pattern | Typical Size | Download From |
|--------|---------|--------------|---------------|
| M365 Copilot | `365 Copilot*.csv` | 30-40KB each | Microsoft 365 Admin |
| GitHub Copilot | `github-copilot-*.ndjson` | 100KB-1MB each | GitHub Enterprise |
| Claude Enterprise | `claude-ent-data-*.zip` | 10-90MB each | Claude Enterprise Admin |
| Claude Code | `claude_code_team_*.csv` | 1KB each | Anthropic Admin |

### 5. Historical/Archived Files - REMOVE FROM REPO

| Directory | Purpose | Action |
|-----------|---------|--------|
| `data/old/` | Superseded files | Remove |
| `data/temp/` | Temporary processing | Remove |
| Duplicate snapshots | Redundant history | Consolidate |

---

## Data Refresh Process

### Prerequisites

Before running a data refresh, ensure you have the latest source files locally:

1. **M365 Copilot**: Download from Microsoft 365 Admin Center → Reports → Usage
2. **GitHub Copilot**: Download from GitHub Enterprise → Settings → Copilot → Usage
3. **Claude Enterprise**: Download from Claude Enterprise Admin → Exports
4. **Claude Code**: Download from Anthropic Admin Console

### Running a Refresh

```bash
# Interactive workflow (recommended)
/refresh-data

# Direct command
npm run refresh

# What happens:
# 1. Reads source files from /data/
# 2. Runs pipeline: ingestors → processors → aggregators
# 3. Generates AI insights via Claude API (~$0.10 cost)
# 4. Writes output to app/*.json
# 5. Dashboard automatically uses new data
```

### Pipeline Architecture

```
scripts/modules/
├── ingestors/           # Read and parse source files
│   ├── claude-enterprise-ingestor.js
│   ├── claude-code-ingestor.js
│   ├── connectors-ingestor.js
│   ├── github-copilot-ingestor.js
│   ├── m365-copilot-ingestor.js
│   └── ...
├── processors/          # Transform and enrich data
│   ├── adoption-scorer.js
│   ├── connectors-processor.js
│   ├── projects-processor.js
│   └── ...
├── aggregators/         # Prepare dashboard-ready structures
│   ├── overview-aggregator.js
│   ├── connectors-aggregator.js
│   ├── projects-aggregator.js
│   └── ...
└── pipeline-orchestrator.js  # Main orchestrator
```

---

## Repository Structure

### What's Committed vs Local-Only

```
as-ai-dashboard/
├── app/
│   ├── *.json              # ✅ COMMITTED - Runtime data
│   └── components/         # ✅ COMMITTED - React components
├── data/
│   ├── license_config.csv           # ✅ COMMITTED - Config
│   ├── techco_org_chart.json   # ✅ COMMITTED - Config
│   ├── claude_enterprise_seats.json # ✅ COMMITTED - Config
│   ├── ai-projects/                 # ✅ COMMITTED - Project docs
│   ├── 365 Copilot*.csv             # ❌ GITIGNORED - Source exports
│   ├── github-copilot-*.ndjson      # ❌ GITIGNORED - Source exports
│   ├── claude-ent-data-*.zip        # ❌ GITIGNORED - Source exports
│   └── claude_code_team_*.csv       # ❌ GITIGNORED - Source exports
├── docs/
│   └── architecture/       # ✅ COMMITTED - Documentation
└── scripts/
    └── modules/            # ✅ COMMITTED - Pipeline code
```

### .gitignore Patterns for Data Files

```gitignore
# Large Claude Enterprise exports
data/*.zip
data/claude-ent-data-*/
data/**/conversations.json
data/claude-monthly-data/

# M365 Copilot exports (download fresh from admin)
data/365 Copilot*.csv
data/365 CopilotActivity*.csv

# GitHub Copilot exports (download fresh from admin)
data/github-copilot-*.ndjson

# Claude Code exports (download fresh from admin)
data/claude_code_team_*.csv

# ChatGPT/ZScaler exports
data/ChatGPT*.csv
data/*AI*.csv

# Historical/temp files
data/old/
data/temp/
```

---

## Future Architecture (Roadmap)

### Current State: Batch Processing

- Manual data export downloads
- `npm run refresh` to regenerate
- Static JSON files in repo
- Monthly update cycle

### Tier 4 (Q2 2026): Database Layer

```
┌─────────────────────────────────────────────────────────────────┐
│                    PLANNED: DATABASE ARCHITECTURE               │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  External APIs              Database              Dashboard     │
│  ─────────────              ────────              ─────────     │
│                                                                 │
│  ┌─────────────┐         ┌─────────────┐      ┌─────────────┐  │
│  │ Anthropic   │────────▶│             │      │             │  │
│  │ Compliance  │         │  Supabase/  │─────▶│  Next.js    │  │
│  │ API         │         │  PostgreSQL │      │  Dashboard  │  │
│  └─────────────┘         │             │      │             │  │
│                          │  - Users    │      └─────────────┘  │
│  ┌─────────────┐         │  - Usage    │                       │
│  │ Microsoft   │────────▶│  - History  │                       │
│  │ Graph API   │         │  - Projects │                       │
│  └─────────────┘         │             │                       │
│                          └─────────────┘                       │
│  ┌─────────────┐                │                              │
│  │ GitHub      │────────────────┘                              │
│  │ API         │                                               │
│  └─────────────┘                                               │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

**Benefits**:
- Real-time data (no manual exports)
- Historical trend analysis
- User-level customization
- Automated daily/weekly refresh

### Tier 5 (Q3-Q4 2026): Full Automation

- Slack API for automated sentiment collection
- Scheduled refresh jobs (Vercel Cron)
- Anomaly detection and alerts
- Predictive analytics

### Phase 4 Research: Compliance API

**Current Gap**: Claude Code skills/plugins usage is NOT available in Claude Enterprise exports.

**Research Items**:
1. Anthropic Compliance API - Check if audit logs include skill invocations
2. Local instrumentation - Hook into Claude Code CLI
3. Survey-based tracking - Manual fallback

---

## Developer Guide

### Setting Up Data Files Locally

1. **Clone the repository** (runtime files included)
2. **Download source exports** (if you need to refresh):
   ```bash
   # Create local data directory structure
   mkdir -p data

   # Download from respective admin consoles:
   # - M365 Copilot CSVs → data/
   # - GitHub Copilot NDJSONs → data/
   # - Claude Enterprise ZIPs → data/
   # - Claude Code CSVs → data/
   ```

3. **Run data refresh**:
   ```bash
   npm run refresh
   ```

### Adding New Data Sources

1. Create ingestor in `scripts/modules/ingestors/`
2. Create processor in `scripts/modules/processors/`
3. Create aggregator in `scripts/modules/aggregators/`
4. Wire into `pipeline-orchestrator.js`
5. Update `.gitignore` for new source file patterns
6. Document in this file

### Troubleshooting

| Issue | Solution |
|-------|----------|
| Missing source files | Download from admin console |
| Pipeline errors | Check file patterns match expected |
| Large file memory issues | Use jq streaming (see connectors-ingestor.js) |
| Stale data | Re-download exports and run refresh |

---

## Related Documentation

- [ADR-001: Dashboard Architecture](./ADR-001-dashboard-architecture.md)
- [Data Refresh Guide](../guides/DATA_REFRESH.md)
- [Pipeline Orchestrator](../../scripts/modules/pipeline-orchestrator.js)
- [Roadmap](./.claude/ROADMAP.md)
