# Annual Plan Output Schemas

This document defines the JSON schemas for the two new output files generated by the Annual Plan pipeline.

## Overview

The Annual Plan pipeline generates 7 JSON files. This document covers the 2 new files added for AI-driven presentation generation:

1. **ai-projects-progress.json** - 3-tier progress tracking for all projects
2. **ai-projects-context.json** - Temporal analysis, narrative determination, gaps, and recommendations

## Schema: ai-projects-progress.json

### Root Object

```typescript
{
  reports: ProgressReport[],      // Array of progress reports for all projects
  metadata: Metadata              // Generation metadata
}
```

### ProgressReport

```typescript
{
  projectId: string,              // Project identifier (e.g., "OP-000")
  projectName: string,            // Full project name/title
  overallProgress: number,        // 0-100 percentage (weighted average of tiers)
  progressBreakdown: {
    phases: PhaseProgress,        // Tier 1: Phase completion markers
    behavioral: BehavioralProgress, // Tier 2: Dashboard behavioral signals
    repo: RepoProgress | null     // Tier 3: GitHub repository analysis
  },
  status: string,                 // "proposed" | "committed" | "in-progress" | "completed" | "deferred"
  plannedQuarter: string,         // Quarter format "Q1" | "Q2" | "Q3" | "Q4"
  currentQuarter: string,         // Current quarter "Q1" | "Q2" | "Q3" | "Q4"
  actualProgress: string,         // "on-track" | "at-risk" | "ahead" | "behind"
  blockers: string[],             // Array of blocker descriptions (empty if none)
  velocity: string,               // "unknown" | "slow" | "steady" | "fast"
  lastAnalyzed: string,           // ISO 8601 timestamp
  metadata: ProgressMetadata      // Tier availability and confidence
}
```

### PhaseProgress (Tier 1)

```typescript
{
  progress: number,               // 0-100 percentage from phase completion
  completedPhases: number,        // Count of phases marked with ✓ COMPLETE
  totalPhases: number,            // Total phases found in project markdown
  onTrack: boolean | null,        // null if no phases, true if on schedule
  confidence: string              // "none" | "low" | "medium" | "high"
}
```

### BehavioralProgress (Tier 2)

```typescript
{
  progress: number,               // 0-100 percentage from behavioral signals
  signals: {                      // Key-value pairs of detected signals
    [key: string]: any            // e.g., { "claude_code_users": 12, "adoption_rate": 86 }
  },
  confidence: string              // "none" | "low" | "medium" | "high"
}
```

### RepoProgress (Tier 3)

```typescript
{
  progress: number,               // 0-100 percentage from GitHub analysis
  activity: {
    commitCount: number,          // Total commits since project start
    prCount: number,              // Total pull requests
    issueCount: number,           // Total issues
    releaseCount: number,         // Total releases
    lastCommitDate: string | null, // ISO 8601 timestamp of last commit
    weeklyCommitAvg: number       // Average commits per week
  },
  roadmapProgress: {              // Analysis of roadmap files
    tasksTotal: number,           // Total tasks found
    tasksCompleted: number,       // Tasks marked as complete
    tasksInProgress: number       // Tasks marked as in progress
  },
  velocity: string,               // "slow" | "steady" | "fast"
  confidence: string              // "low" | "medium" | "high"
} | null                          // null if no repo or analysis skipped
```

### ProgressMetadata

```typescript
{
  tier1Available: boolean,        // True if phase markers found
  tier2Available: boolean,        // True if behavioral signals mapped
  tier3Available: boolean,        // True if GitHub analysis completed
  confidence: string              // Overall confidence: "none" | "low" | "medium" | "high"
}
```

### Metadata

```typescript
{
  generatedAt: string,            // ISO 8601 timestamp
  quarter: string,                // "Q1" | "Q2" | "Q3" | "Q4"
  projectCount: number,           // Total projects analyzed
  version: string,                // Format: "YYYY-QN" (e.g., "2026-Q1")
  narrativeType: string           // See NarrativeType enum below
}
```

## Schema: ai-projects-context.json

### Root Object

```typescript
{
  temporal: TemporalContext,      // Fiscal year position and timing
  projectStatus: ProjectStatus,   // Aggregated project health metrics
  narrative: Narrative,           // Presentation narrative determination
  gaps: Gaps,                     // Identified execution/strategic gaps
  changes: Changes,               // Changes from previous plan (if available)
  recommendations: Recommendation[], // Prioritized action items
  metadata: Metadata              // Generation metadata
}
```

### TemporalContext

```typescript
{
  currentDate: string,            // ISO 8601 date (YYYY-MM-DD)
  currentQuarter: string,         // "Q1" | "Q2" | "Q3" | "Q4"
  fiscalYear: number,             // Calendar year (e.g., 2026)
  percentYearComplete: number,    // 0-100 percentage through fiscal year
  elapsedDays: number,            // Days elapsed since Jan 1
  remainingDays: number,          // Days remaining until Dec 31
  timePhase: string,              // "beginning" | "early" | "mid" | "late"
  daysUntilNextQuarter: number,   // Days until next quarter starts
  isBeginningOfYear: boolean,     // True if < 15% through year
  isMidYear: boolean,             // True if 40-60% through year
  isEndOfYear: boolean            // True if > 85% through year
}
```

**timePhase Logic**:
- `beginning`: 0-15% through year (Jan 1 - ~Feb 15)
- `early`: 15-40% through year (~Feb 15 - ~May 24)
- `mid`: 40-60% through year (~May 24 - ~Aug 8)
- `late`: 60-100% through year (~Aug 8 - Dec 31)

### ProjectStatus

```typescript
{
  committed: {
    total: number,                // Count of committed projects
    onTrack: number,              // Projects with actualProgress "on-track"
    behind: number,               // Projects with actualProgress "at-risk" | "behind"
    ahead: number,                // Projects with actualProgress "ahead"
    completed: number             // Projects with status "completed"
  },
  potential: {
    total: number,                // Count of potential projects
    started: number,              // Potential projects with progress > 0
    notStarted: number,           // Potential projects with progress = 0
    deferred: number              // Projects with status "deferred"
  },
  overall: {
    avgProgress: number,          // Average progress across all projects (0-100)
    projectsAtRisk: RiskProject[], // Projects at risk
    projectsExceeding: RiskProject[] // Projects ahead of schedule
  }
}
```

### RiskProject

```typescript
{
  id: string,                     // Project ID (e.g., "OP-000")
  progress: number,               // 0-100 percentage
  blockers: string[],             // Array of blocker descriptions
  velocity: string                // "unknown" | "slow" | "steady" | "fast"
}
```

### Narrative

```typescript
{
  narrativeType: NarrativeType,   // Enum: See below
  focus: string,                  // "forward-looking" | "retrospective" | "corrective" | "balanced"
  slideEmphasis: string[],        // Array of emphasis areas (e.g., ["strategy", "roadmap"])
  tone: string,                   // "ambitious" | "realistic" | "cautious" | "celebratory"
  message: string                 // Short narrative message (1-2 sentences)
}
```

**NarrativeType Enum**:
- `NEW_PLAN`: Beginning of year, setting vision
- `PROGRESS_UPDATE`: Early in year, showing execution
- `COURSE_CORRECTION`: Mid-year with projects behind
- `MID_YEAR_CHECKPOINT`: Mid-year with projects on track
- `YEAR_END_SUMMARY`: Late in year, retrospective

**slideEmphasis Values**:
- `strategy`: Strategic vision and objectives
- `roadmap`: Quarterly project schedule
- `resources`: Resource allocation and capacity
- `commitment`: Q1 committed projects
- `progress`: Progress metrics and achievements
- `challenges`: Blockers and risks
- `adjustments`: Course corrections and pivots
- `wins`: Completed projects and successes
- `learnings`: Retrospective insights

### Gaps

```typescript
{
  execution: ExecutionGap[],      // Projects behind schedule
  strategic: StrategicGap[],      // High-priority projects not scheduled
  dependency: DependencyGap[],    // Blocked projects
  resource: ResourceGap[]         // Over/under allocated quarters
}
```

### ExecutionGap

```typescript
{
  projectId: string,              // Project ID
  plannedQuarter: string,         // Planned quarter "Q1"-"Q4"
  currentQuarter: string,         // Current quarter "Q1"-"Q4"
  progress: number,               // 0-100 percentage
  blockers: string[],             // Array of blocker descriptions
  impact: number                  // Project priority score (0-100)
}
```

### StrategicGap

```typescript
{
  projectId: string,              // High-priority project ID
  score: number,                  // Priority score (0-100)
  status: string,                 // Project status
  reason: string                  // Why it's a gap (e.g., "not scheduled")
}
```

### DependencyGap

```typescript
{
  projectId: string,              // Blocked project ID
  blockedBy: string[],            // Array of blocking project IDs
  impact: string                  // "low" | "medium" | "high"
}
```

### ResourceGap

```typescript
{
  quarter: string,                // Quarter with gap "Q1"-"Q4"
  issue: string,                  // "over-allocated" | "under-allocated"
  allocated: number,              // Total days allocated
  capacity: number,               // Available capacity days
  buffer: number                  // Remaining buffer (capacity - allocated)
}
```

### Changes

```typescript
{
  hasChanges: boolean,            // True if previous plan exists and differs
  changes: Change[],              // Array of detected changes
  changeCount: number             // Total count of changes
}
```

### Change

```typescript
{
  type: string,                   // "project_added" | "project_removed" | "reschedule" | "status_change" | "scope_change"
  projectId: string,              // Affected project ID
  description: string,            // Human-readable change description
  impact: string                  // "low" | "medium" | "high"
}
```

### Recommendation

```typescript
{
  type: string,                   // "immediate" | "near-term" | "long-term"
  priority: string,               // "high" | "medium" | "low"
  action: string,                 // Recommended action (imperative)
  owner: string,                  // Suggested owner role
  timeline: string,               // When to act (e.g., "This week", "Q2")
  reason: string                  // Justification for recommendation
}
```

## Confidence Levels

All confidence strings use this enum:

- `none`: No data available
- `low`: Minimal data (1 signal)
- `medium`: Some data (2-3 signals)
- `high`: Strong data (4+ signals)

## Example Usage in UI Components

### Consuming Progress Data

```javascript
// Load progress reports
const progressData = await fetch('/ai-projects-progress.json').then(r => r.json());

// Find specific project
const project = progressData.reports.find(r => r.projectId === 'OP-011');

// Display progress with confidence
if (project.metadata.confidence === 'high') {
  console.log(`${project.projectName}: ${project.overallProgress}% complete`);
}

// Show tier breakdown
if (project.metadata.tier3Available) {
  console.log(`GitHub: ${project.progressBreakdown.repo.activity.commitCount} commits`);
}
```

### Consuming Context Data

```javascript
// Load context analysis
const contextData = await fetch('/ai-projects-context.json').then(r => r.json());

// Determine presentation narrative
const { narrativeType, message } = contextData.narrative;
console.log(`Narrative: ${narrativeType} - ${message}`);

// Show temporal position
const { percentYearComplete, timePhase } = contextData.temporal;
console.log(`${percentYearComplete}% through year (${timePhase} phase)`);

// Display recommendations
contextData.recommendations
  .filter(r => r.priority === 'high')
  .forEach(rec => {
    console.log(`${rec.action} (${rec.owner}, ${rec.timeline})`);
  });
```

## Validation Rules

### Progress Reports
- `overallProgress`: Must be 0-100
- `plannedQuarter`, `currentQuarter`: Must be "Q1", "Q2", "Q3", or "Q4"
- `status`: Must be one of defined status values
- `velocity`: Must be one of defined velocity values
- At least one tier must have data (tier1, tier2, or tier3)

### Context Analysis
- `temporal.percentYearComplete`: Must be 0-100
- `temporal.currentQuarter`: Must match calculated quarter from currentDate
- `narrative.narrativeType`: Must be one of 5 defined types
- `gaps`: All arrays can be empty but must be present
- `recommendations`: Can be empty but must be sorted by priority (high → medium → low)

## Version History

- **2026-Q1**: Initial schema version with 3-tier progress tracking and 5 narrative types
